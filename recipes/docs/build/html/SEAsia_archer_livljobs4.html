<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Setting up a SE Asia NEMO v4 configuration &#8212; NEMO-RELOC 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="NEMO-RELOC 0.1 documentation" href="index.html" />
    <link rel="next" title="Setting up a SW Pacific NEMO v4 configuration" href="SWPacific_archer_livljobs4.html" />
    <link rel="prev" title="Liverpool Bay 180m NEMO configuration" href="LBay_180m.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="setting-up-a-se-asia-nemo-v4-configuration">
<h1>Setting up a SE Asia NEMO v4 configuration<a class="headerlink" href="#setting-up-a-se-asia-nemo-v4-configuration" title="Permalink to this headline">¶</a></h1>
<p>Machines: livljobs4, ARCHER</p>
<p>URL:: <em>to add</em>
<em>Actually I&#8217;ve taken this off readthedocs as it is internal. However writing in</em>
<em>ReStrucTed text means it is trivial to deploy anywhere with whatever style</em></p>
<ul class="simple">
<li>Build notes with:: ~/GitLab/NEMO-RELOC/docs$ make html</li>
</ul>
<dl class="docutils">
<dt>Builds a SE Asia regional tide-only model using GEBCO bathymetry, TPXO(later FES?)</dt>
<dd>tidal boundaries.</dd>
</dl>
<p>Build on a combination of livljobs4 and ARCHER.</p>
<p>Uses a prerelease of NEMO v4 (&#64;r8395)</p>
<p>The summary procedure:
#. ARCHER: Get code. Build tools. Generate coordinates, bathymetry, domain_cfg.nc
#. ARCHER: Generate initial conditions and atmospheric forcings
#. LIVLJOBS4: Generate boundary conditions with NRCT/PyNEMO
#. ARCHER: Run simulation</p>
<p>It is a tide only run.</p>
<div class="section" id="issues-that-arose">
<h2>Issues that arose<a class="headerlink" href="#issues-that-arose" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The THREDDS server to access ORCA0083 data is broken and the JASMIN server</li>
</ul>
<blockquote>
<div><dl class="docutils">
<dt>hosting it is not a thredds server. Therefore PyNEMO needs to run on local</dt>
<dd>copies of the parent data.</dd>
</dl>
</div></blockquote>
</div>
<hr class="docutils" />
<div class="section" id="recipe-notes">
<h2>Recipe Notes<a class="headerlink" href="#recipe-notes" title="Permalink to this headline">¶</a></h2>
<p>In the following I build most stuff on ARCHER but the PyNEMO bits are done on livljobs4.
(There was a problem with some java bits working on ARCHER)
Starting on ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ssh login.archer.ac.uk

export CONFIG=SEAsia
export WORK=/work/n01/n01
export WDIR=$WORK/$USER/$CONFIG
export INPUTS=$WDIR/INPUTS
export START_FILES=$WDIR/START_FILES
export CDIR=$WDIR/trunk_NEMOGCM_r8395/CONFIG
export TDIR=$WDIR/trunk_NEMOGCM_r8395/TOOLS
export OLD_TDIR=$WORK/$USER/LBay/dev_r4621_NOC4_BDY_VERT_INTERP/NEMOGCM/TOOLS/
export EXP=$CDIR/$CONFIG/EXP00

module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel cray-hdf5-parallel
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="collect-essential-files">
<h2>Collect essential files<a class="headerlink" href="#collect-essential-files" title="Permalink to this headline">¶</a></h2>
<p>Note you might have to mkdir the odd directory or two...:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mkdir $WDIR
mkdir $INPUTS
mkdir $START_FILES

cp $WDIR/../LBay/START_FILES/dommsk.F90 $START_FILES/.
cp $WDIR/../LBay/START_FILES/bdyini.F90 $START_FILES/.
cp $WDIR/../LBay/START_FILES/coordinates_ORCA_R12.nc $START_FILES/.
cp $WDIR/../LBay/INPUTS/namelist_reshape_bilin_gebco $START_FILES/.
cp $WDIR/../SWPacific/START_FILES/usrdef_istate.F90 $START_FILES/.
cp $WDIR/../SWPacific/START_FILES/usrdef_sbc.F90    $START_FILES/.

cp /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ORCHESTRA/MY_SRC/par_oce.F90 $START_FILES/.
cp /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ORCHESTRA/MY_SRC/dtatsd.F90 $START_FILES/.

cp /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/diaharmana.F90 $START_FILES/.
cp /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/step_oce.F90 $CSTART_FILES/.
cp /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/step.F90 $START_FILES/.
cp /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/bdytides.F90 $START_FILES/.
</pre></div>
</div>
<p>Checkout and build NEMO (ORCHESTRA) trunk &#64; r8395 <a href="#id1"><span class="problematic" id="id2">`build_opa_orchestra.html`_</span></a>.
Or just build (if it is already downloaded). Note here we use user defined</p>
<blockquote>
<div><p>functions for the initial state (constant T and S) and surface forcing (zero forcing):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR
cp $START_FILES/usrdef_istate.F90 $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/usrdef_sbc.F90    $CDIR/$CONFIG/MY_SRC/.
./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
</div></blockquote>
<p>&#8212;</p>
<p>Checkout and build XIOS2 &#64; r1080 <a href="#id3"><span class="problematic" id="id4">`build_XIOS2.html`_</span></a>:</p>
<p>Or just link XIOS executable to the EXP directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s  /work/n01/n01/$USER/xios-2.0_r1080/bin/xios_server.exe $EXP/xios_server.exe
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="build-tools">
<h2>Build TOOLS<a class="headerlink" href="#build-tools" title="Permalink to this headline">¶</a></h2>
<p>To generate domain coords and rebuild tools we first need
to compile some of the NEMO TOOLS.</p>
<p>First build DOMAINcfg (which is relatively new and in NEMOv4). Use my XIOS1 file
(see userid and path in variable <code class="docutils literal"><span class="pre">%XIOS_HOME</span></code>). Copy from ARCH <em>store</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $WORK/$USER/ARCH/arch-XC_ARCHER_INTEL_XIOS1.fcm $CDIR/../ARCH/.
cd $TDIR

./maketools -m XC_ARCHER_INTEL_XIOS1 -n DOMAINcfg
./maketools -m XC_ARCHER_INTEL_XIOS1 -n REBUILD_NEMO
</pre></div>
</div>
<p>For the generation of bathymetry and met forcing weights files we need to patch
the code (to allow direct passing of arguments. NB this code has not been
updated in 7 years.):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/WEIGHTS/src
patch -b &lt; $START_FILES/scripinterp_mod.patch
patch -b &lt; $START_FILES/scripinterp.patch
patch -b &lt; $START_FILES/scrip.patch
patch -b &lt; $START_FILES/scripshape.patch
patch -b &lt; $START_FILES/scripgrid.patch

cd $TDIR
./maketools -m XC_ARCHER_INTEL_XIOS1 -n WEIGHTS
</pre></div>
</div>
<div class="section" id="generate-new-coordinates-file">
<h3>1. Generate new coordinates file<a class="headerlink" href="#generate-new-coordinates-file" title="Permalink to this headline">¶</a></h3>
<p>Generate a <code class="docutils literal"><span class="pre">coordinates.nc</span></code> file from a parent NEMO grid at some resolution.
<strong>Plan:</strong> Use tool <code class="docutils literal"><span class="pre">agrif_create_coordinates.exe</span></code> which reads cutting indices and
parent grid location from <code class="docutils literal"><span class="pre">namelist.input</span></code> and outputs a new files with new
resolution grid elements.</p>
</div>
</div>
<div class="section" id="a-choose-domain">
<h2>1a. Choose domain<a class="headerlink" href="#a-choose-domain" title="Permalink to this headline">¶</a></h2>
<p>First we need to figure out the indices for the new domain, from the parent grid.
Move parent grid into INPUTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/coordinates_ORCA_R12.nc $INPUTS/.
</pre></div>
</div>
<p>Inspect this parent coordinates file to define the boundary indices for the new config.</p>
<p>Note, I used FERRET locally:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$livljobs2$ scp $USER@login.archer.ac.uk:/work/n01/n01/$USER/LBay/INPUTS/coordinates_ORCA_R12.nc ~/Desktop/.
ferret etc
shade/i=3385:3392/j=2251:2266 NAV_LAT
shade/i=3385:3392/j=2251:2266 NAV_LON
</pre></div>
</div>
<p><strong>Use indices  i=50:730 j=1250:1800</strong></p>
<p>&#8212;</p>
<p><strong>Longer version</strong></p>
<p>Inspect this parent coordinates file to define the boundary indices for the new config.</p>
<p>Note, I used FERRET on livljobs4.</p>
<p><em>(27 Sept 2017)</em></p>
</div>
<div class="section" id="decide-coordinates-for-new-se-asia-configuration-at-1-12-degree-r12">
<h2>Decide coordinates for new SE Asia configuration at 1/12 degree, R12<a class="headerlink" href="#decide-coordinates-for-new-se-asia-configuration-at-1-12-degree-r12" title="Permalink to this headline">¶</a></h2>
<p>Inspect TPXO harmonic amplitudes to find a good cut off location for boundaries:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4$ cd /work/jelt/tpxo7.2
ferret
go plot_SEAsia_harmonics.jnl
</pre></div>
</div>
<p>... note:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>! plot_SEAsia_harmonics.jnl
! Plot tpxo harmonics for the SE Asia region.
! Want to build a NEMO config without significant amphidromes on the boundary

use h_tpxo7.2.nc

set win 1
set viewport ul
shade/k=1/j=300:700/i=250:500/levels=(0,1,0.1)/title=&quot;M2&quot; HA, lon_z, lat_z; go fland
set viewport ur
shade/k=2/j=300:700/i=250:500/levels=(0,1,0.1)/title=&quot;S2&quot; HA, lon_z, lat_z; go fland
set viewport ll
shade/k=3/j=300:700/i=250:500/levels=(0,1,0.1)/title=&quot;N2&quot; HA, lon_z, lat_z; go fland
set viewport lr
shade/k=4/j=300:700/i=250:500/levels=(0,1,0.1)/title=&quot;K2&quot; HA, lon_z, lat_z; go fland

set win 2
set viewport ul
shade/k=5/j=300:700/i=250:500/levels=(0,1,0.1)/title=&quot;K1&quot; HA, lon_z, lat_z; go fland
set viewport ur
shade/k=6/j=300:700/i=250:500/levels=(0,1,0.1)/title=&quot;O1&quot; HA, lon_z, lat_z; go fland
set viewport ll
shade/k=7/j=300:700/i=250:500/levels=(0,1,0.1)/title=&quot;P1&quot; HA, lon_z, lat_z; go fland
set viewport lr
shade/k=8/j=300:700/i=250:500/levels=(0,1,0.1)/title=&quot;Q1&quot; HA, lon_z, lat_z; go fland
</pre></div>
</div>
<p>Conclusion. Plot the proposed domain:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$livljobs2$ scp $USER@login.archer.ac.uk:/work/n01/n01/$USER/LBay/INPUTS/coordinates_ORCA_R12.nc ~/Desktop/.

ferret
use coordinates_ORCA_R12.nc
set win 1; shade/X=50:730/Y=1250:1800 E2T, nav_lon, nav_lat ; go fland
set win 2; set viewport upper; shade/i=50:730/j=1250:1800 NAV_LAT
set win 2; set viewport lower; shade/i=50:730/j=1250:1800 NAV_LON
</pre></div>
</div>
<p>Use indices  <strong>i=50:730 j=1250:1800</strong></p>
<p>&#8212;</p>
<p>Edit namelist:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/NESTING
vi namelist.input

&amp;input_output
    iom_activated = true
/
&amp;coarse_grid_files
    parent_coordinate_file = &#39;coordinates_ORCA_R12.nc&#39;
/
&amp;bathymetry
/
&amp;nesting
    imin = 50
    imax = 730
    jmin = 1250
    jmax = 1800
    rho  = 1
    rhot = 1
    bathy_update = false
/
&amp;vertical_grid
/
&amp;partial_cells
/
&amp;nemo_coarse_grid
/
&amp;forcing_files
/
&amp;interp
/
&amp;restart
/
&amp;restart_trc
/
</pre></div>
</div>
<p>Build and execute agrif version of create_coordinates.exe.
See <a href="#id5"><span class="problematic" id="id6">`build_and_create_coordinates.rst`_</span></a></p>
<p>Or just execute tool:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">agrif_create_coordinates</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
<p>This creates a new coordinates file with contents, which is now copied to
INPUTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp 1_coordinates_ORCA_R12.nc $INPUTS/coordinates.nc
</pre></div>
</div>
<p>Now we need to generate a bathymetry on this new grid.</p>
<div class="section" id="generate-bathymetry-file">
<h3>2. Generate bathymetry file<a class="headerlink" href="#generate-bathymetry-file" title="Permalink to this headline">¶</a></h3>
<p>Take GEBCO bathymetry. For a domain as large as SE Asia, the 30-minute GEBCO
data is too large to process and needs some spatial filtering. BODC also host a</p>
<blockquote>
<div><dl class="docutils">
<dt>1-minute data set (2008) which should work without pre-processing but is not</dt>
<dd>updated.</dd>
</dl>
</div></blockquote>
<p>Download some GEBCO 2014 and 2008 data (75E,-21N,134E,25N) and copy to $INPUTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>scp GRIDONE_2008_2D_74.0_-21.0_134.0_25.0.nc $USER@login.archer.ac.uk:/work/n01/n01/$USER/SEAsia/INPUTS/.
</pre></div>
</div>
<p><strong>In the following I use the 2008 data</strong>
Copy namelist for reshaping GEBCO data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/namelist_reshape_bilin_gebco $INPUTS/.
</pre></div>
</div>
<dl class="docutils">
<dt>Edit namelist to point to correct input file. Edit lat and lon variable names to</dt>
<dd>make sure they match the nc file content (used e.g.</dd>
</dl>
<p><code class="docutils literal"><span class="pre">ncdump</span> <span class="pre">-h</span> <span class="pre">GRIDONE_2008_2D_74.0_-21.0_134.0_25.0.nc</span></code> to get input
variable names):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $INPUTS/namelist_reshape_bilin_gebco
...
&amp;grid_inputs
  input_file = &#39;gebco_in.nc&#39;
  nemo_file = &#39;coordinates.nc&#39;
  ...
  input_lon = &#39;lon&#39;
  input_lat = &#39;lat&#39;
  nemo_lon = &#39;glamt&#39;
  nemo_lat = &#39;gphit&#39;
  ...

  &amp;interp_inputs
  input_file = &quot;gebco_in.nc&quot;
  ...
  input_name = &quot;elevation&quot;
</pre></div>
</div>
<p>Do some things to 1) flatten out land elevations, 2) make depths positive.
Have to swap around with the modules to get nco working <em>(James
noted a problem with the default nco module)</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS

module unload cray-netcdf-hdf5parallel cray-hdf5-parallel
module load cray-netcdf cray-hdf5

module load nco/4.5.0
ncap2 -s &#39;where(elevation &gt; 0) elevation=0&#39; GRIDONE_2008_2D_74.0_-21.0_134.0_25.0.nc tmp.nc
ncflint --fix_rec_crd -w -1.0,0.0 tmp.nc tmp.nc gebco_in.nc
rm tmp.nc
</pre></div>
</div>
<p>Restore the original parallel modules:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">unload</span> <span class="n">nco</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span><span class="o">-</span><span class="n">hdf5parallel</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span>
</pre></div>
</div>
<p>Execute first scrip thing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">remap_nemo_grid_gebco</span><span class="o">.</span><span class="n">nc</span>
<span class="n">remap_data_grid_gebco</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Execute second scip thing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">data_nemo_bilin_gebco</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Execute third scip thing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scripinterp.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bathy_meter</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
</div>
<div class="section" id="generate-river-forcing">
<h3>2.5 Generate River forcing<a class="headerlink" href="#generate-river-forcing" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="Generate_river_forcing.rst">Matlab script to generate river forcing</a></p>
<p>Link the river forcing output into <code class="docutils literal"><span class="pre">$INPUTS</span></code> e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>scp river_test.nc $USER@login.archer.ac.uk:$INPUTS/$CONFIG_rivers.nc
</pre></div>
</div>
</div>
</div>
<div class="section" id="generate-a-domain-configuration-file">
<h2>3. Generate a domain configuration file<a class="headerlink" href="#generate-a-domain-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>The general idea is that you have to copy the <code class="docutils literal"><span class="pre">namelist_cfg</span></code> file into the <code class="docutils literal"><span class="pre">DOMAINcfg</span></code>
directory along with all the inputs files that would have previously been needed
get v3.6 running. The reason being that all the non-time stepping stuff, like
grid generating, has been abstracted from the core OPA code and is now done as
a pre-processing step, and output into an important file <code class="docutils literal"><span class="pre">domain_cfg.nc</span></code>.</p>
<p>Copy essential files into DOMAINcfg directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s $INPUTS/coordinates.nc $TDIR/DOMAINcfg/.
ln -s $INPUTS/bathy_meter.nc $TDIR/DOMAINcfg/.
</pre></div>
</div>
<p>Edit the template <code class="docutils literal"><span class="pre">namelist_cfg</span></code> with only the essenetial domain building stuff.
Get the size of the new domain from <code class="docutils literal"><span class="pre">ncdump</span> <span class="pre">-h</span> <span class="pre">bathy_meter.nc</span></code>.</p>
<p>Follow recipe of hybrid z-s coordinates in <a href="#id7"><span class="problematic" id="id8">`build_domain_cfg_file.rst`_</span></a></p>
<dl class="docutils">
<dt>Copy domain_cfg.nc to the EXP directory (also copy it to the INPUTS directory, which stores</dt>
<dd><p class="first">the bits and bobs for a rebuild):</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>rsync -utv $TDIR/DOMAINcfg/domain_cfg.nc $EXP/.
rsync -utv $TDIR/DOMAINcfg/domain_cfg.nc $INPUTS/.
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="generate-initial-conditions">
<h2>4. Generate initial conditions<a class="headerlink" href="#generate-initial-conditions" title="Permalink to this headline">¶</a></h2>
<p>For a new configuration you probably want to start with idealised, or homogenous
initial conditions. This is done with user defined initial conditions <code class="docutils literal"><span class="pre">ln_usr=T</span></code>
with the expression being compiled into the executable. (In <code class="docutils literal"><span class="pre">$CDIR/$CONFIG/MY_SRC</span></code>:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">usrdef_sbc.F90</span></code>  and <code class="docutils literal"><span class="pre">usrdef_istate.F90</span></code>).</div></blockquote>
<p>To use initial conditions from an existing T,S field you might need to do a bit
of interpolation. It is advisable to let NEMO do the heavy lifting for vertical
interpolation (rquiring some FORTRAN modifictions), though SOSIE tools can be user
to do simple horizontal interpolation. See notes in</p>
<p><a class="reference external" href="generate_initial_conditions.rst">generate_initial_conditions.rst</a></p>
<p>This will generates files typically called <code class="docutils literal"><span class="pre">initcd_votemper.nc</span></code>
and <code class="docutils literal"><span class="pre">initcd_vosaline.nc</span></code>, and corresponding mask and depth variables files</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">initcd_mask.nc</span></code> and <code class="docutils literal"><span class="pre">initcd_depth.nc</span></code>.</div></blockquote>
<div class="section" id="generate-weights-for-atm-forcing">
<h3>5. Generate weights for atm forcing<a class="headerlink" href="#generate-weights-for-atm-forcing" title="Permalink to this headline">¶</a></h3>
<p>Initially use zero atm forcing. Specified in usr defined functions in MY_SRC.</p>
<p>Second time around add in met forcing.</p>
<p>Generate cut down drowned precip file (note that the nco tools don&#8217;t like the
parallel modules). <strong>HEALTH WARNING</strong> <em>Cut out files with only one index in that lat direction broke NEMO</em></p>
<p><strong>NOTE THAT I&#8217;VE LABELLED THE CUTDOWN FILES AS y1979 WHEN THEY ARE 2000. THIS IS TO GET THINGS MOVING AS BCS ARE 1979</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module unload cray-netcdf-hdf5parallel cray-hdf5-parallel
module load cray-netcdf cray-hdf5
module load nco/4.5.0
ncks -d lon,70.,140. -d lat,-21.,25. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_precip_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_precip_DFS5.1.1_y1979.nc
ncks -d lon0,70.,140. -d lat0,-21.,25. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_u10_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_u10_DFS5.1.1_y1979.nc
ncks -d lon0,70.,140. -d lat0,-21.,25. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_v10_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_v10_DFS5.1.1_y1979.nc
ncks -d lon0,70.,140. -d lat0,-21.,25. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_radsw_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_radsw_DFS5.1.1_y1979.nc
ncks -d lon0,70.,140. -d lat0,-21.,25. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_radlw_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_radlw_DFS5.1.1_y1979.nc
ncks -d lon0,70.,140. -d lat0,-21.,25. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_t2_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_t2_DFS5.1.1_y1979.nc
ncks -d lon0,70.,140. -d lat0,-21.,25. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_q2_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_q2_DFS5.1.1_y1979.nc
ncks -d lon0,70.,140. -d lat0,-21.,25. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_snow_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_snow_DFS5.1.1_y1979.nc

module unload nco/4.5.0
module unload cray-netcdf cray-hdf5
module load cray-netcdf-hdf5parallel cray-hdf5-parallel
</pre></div>
</div>
<p>Obtain namelist files and data file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/namelist_reshape_bilin_atmos $INPUTS/.
cp $START_FILES/namelist_reshape_bicubic_atmos $INPUTS/.
</pre></div>
</div>
<p>Edit namelist to reflect source filenames (just a year change):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $WDIR/INPUTS/namelist_reshape_bilin_atmos
...
&amp;grid_inputs
    input_file = &#39;cutdown_drowned_precip_DFS5.1.1_y1979.nc&#39;

vi $WDIR/INPUTS/namelist_reshape_bicubic_atmos
...
&amp;grid_inputs
  input_file = &#39;cutdown_drowned_precip_DFS5.1.1_y1979.nc&#39;
</pre></div>
</div>
<p>Setup weights files for the atmospheric forcing. Use the pre-compiled tools:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>export OLD_TDIR=$WORK/jelt/lighthousereef/dev_r4621_NOC4_BDY_VERT_INTERP/NEMOGCM/TOOLS
</pre></div>
</div>
<p>Setup weights files for the atmospheric forcing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
$OLD_TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_atmos
</pre></div>
</div>
<p>Generate  remap files <code class="docutils literal"><span class="pre">remap_nemo_grid_atmos.nc</span></code> and <code class="docutils literal"><span class="pre">remap_data_grid_atmos.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_atmos
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">data_nemo_bilin_atmos.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scripshape.exe namelist_reshape_bilin_atmos
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">weights_bilinear_atmos.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scrip.exe namelist_reshape_bicubic_atmos
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">data_nemo_bicubic_atmos.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scripshape.exe namelist_reshape_bicubic_atmos
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">weights_bicubic_atmos.nc</span></code>.</p>
<p><em>(27 Apr 2018)</em>
If all the files are ready to go jump straight to <a href="#id9"><span class="problematic" id="id10">`7. Generate boundary conditions with PyNEMO: Run PyNEMO`_</span></a></p>
</div>
</div>
<div class="section" id="statement-about-external-forcing">
<h2>Statement about external forcing<a class="headerlink" href="#statement-about-external-forcing" title="Permalink to this headline">¶</a></h2>
<p>Uses ORCA 1/12 via a thredds server.
I have the mesh and mask files <code class="docutils literal"><span class="pre">mask_src.nc</span>&#160; <span class="pre">mesh_hgr_src.nc</span>&#160; <span class="pre">mesh_zgr_src.nc</span></code></p>
<blockquote>
<div><p>stored locally (from the lighthouse reef experiment).</p>
<p>Copy necessary files into INPUTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/mask_src.nc     $INPUTS/.
cp $START_FILES/mesh_hgr_src.nc $INPUTS/.
cp $START_FILES/mesh_zgr_src.nc $INPUTS/.

ls -lh $INPUTS/bathy_meter.nc
ls -lh $INPUTS/coordinates.nc
ls -lh $INPUTS/domain_cfg.nc
</pre></div>
</div>
</div></blockquote>
<p>Need to generate 3 more files: A <code class="docutils literal"><span class="pre">thredds_namelist.bdy</span></code> which drives PyNEMO and which
has two input files: <code class="docutils literal"><span class="pre">thredds_inputs_src.ncml</span></code> which points to the data source and
<code class="docutils literal"><span class="pre">inputs_dst.ncml</span></code> which remaps some variable names in the destination files.</p>
<div class="section" id="generate-boundary-conditions-with-nrct-pynemo-create-netcdf-abstraction-wrapper">
<h3>6. Generate boundary conditions with NRCT/PyNEMO: Create netcdf abstraction wrapper<a class="headerlink" href="#generate-boundary-conditions-with-nrct-pynemo-create-netcdf-abstraction-wrapper" title="Permalink to this headline">¶</a></h3>
<p>First install PyNEMO <a href="#id11"><span class="problematic" id="id12">`install_nrct`_</span></a> if not already done so.</p>
</div>
<div class="section" id="a-generate-ncml-file-that-points-to-the-external-data">
<h3>6a. Generate ncml file that points to the external data<a class="headerlink" href="#a-generate-ncml-file-that-points-to-the-external-data" title="Permalink to this headline">¶</a></h3>
<p>This can be done with the automatic generator (<em>pynemo_ncml_generator</em>) or manually</p>
<p>Here the object is to generate a ncml file that is read in by PyNEMO as the <code class="docutils literal"><span class="pre">sn_src_dir</span></code>
(in the <code class="docutils literal"><span class="pre">namelist.bdy</span></code> file)</p>
<dl class="docutils">
<dt>Note need to set the time variables and new <code class="docutils literal"><span class="pre">sn_src_dir</span></code> in namelist.bdy.</dt>
<dd>(Time variables correspond to simulation window and the time_origin for the time</dd>
</dl>
<p>axis of these data). Actually upated the following with all the Nov 1979 files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
vi thredds_inputs_src.ncml

&lt;ns0:netcdf xmlns:ns0=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot; title=&quot;NEMO aggregation&quot;&gt;
&lt;ns0:aggregation type=&quot;union&quot;&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;temperature&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791201d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791126d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791121d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791116d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791111d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791106d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791101d05T.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;salinity&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791201d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791126d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791121d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791116d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791111d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791106d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791101d05T.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;zonal_velocity&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05U.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791201d05U.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791126d05U.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791121d05U.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791116d05U.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791111d05U.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791106d05U.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791101d05U.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;meridian_velocity&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05V.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791201d05V.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791126d05V.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791121d05V.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791116d05V.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791111d05V.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791106d05V.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791101d05V.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;sea_surface_height&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791201d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791126d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791121d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791116d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791111d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791106d05T.nc&quot; /&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791101d05T.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
&lt;/ns0:aggregation&gt;
&lt;/ns0:netcdf&gt;
</pre></div>
</div>
</div>
<div class="section" id="b-generate-the-namelist-bdy-file-for-pynemo-nrct">
<h3>6b. Generate the namelist.bdy file for PyNEMO / NRCT<a class="headerlink" href="#b-generate-the-namelist-bdy-file-for-pynemo-nrct" title="Permalink to this headline">¶</a></h3>
<p>Copy the NRCT template namelist.bdy from the START_FILES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
cp $START_FILES/thredds_namelist.bdy $INPUTS/.
</pre></div>
</div>
<p>Edit namelist.bdy to for the configuration name and <code class="docutils literal"><span class="pre">ncml</span></code> file name:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi thredds_namelist.bdy
sn_src_dir = &#39;./thredds_inputs_src.ncml&#39;       ! src_files/&#39;
sn_dst_dir = &#39;/work/n01/n01/jelt/SEAsia/INPUTS/&#39;
sn_fn      = &#39;SEAsia&#39;                 ! prefix for output files
...
</pre></div>
</div>
<p>Make sure the timestamps correspond to the input data in <code class="docutils literal"><span class="pre">*_inputs_src.ncml</span></code>.
Turn off as many things as possible to help it along.
Turned off <code class="docutils literal"><span class="pre">ln_mask_file</span></code>. James said it was for outputting a new mask file
but it might have given me trouble. <em>Actually I also turn off all the ORCA inputs</em>.</p>
<dl class="docutils">
<dt>Point to the correct source and destination mesh and mask files/variables.</dt>
<dd><div class="first last highlight-default"><div class="highlight"><pre><span></span>vi thredds_namelist.bdy

!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!! NEMO/OPA  : namelist for BDY generation tool
!!
!!             User inputs for generating open boundary conditions
!!             employed by the BDY module in NEMO. Boundary data
!!             can be set up for v3.2 NEMO and above.
!!
!!             More info here.....
!!
!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

!-----------------------------------------------------------------------
!   vertical coordinate
!-----------------------------------------------------------------------
   ln_zco      = .false.   !  z-coordinate - full    steps   (T/F)
   ln_zps      = .true.    !  z-coordinate - partial steps   (T/F)
   ln_sco      = .false.   !  s- or hybrid z-s-coordinate    (T/F)
   rn_hmin     =   -10     !  min depth of the ocean (&gt;0) or
                           !  min number of ocean level (&lt;0)

!-----------------------------------------------------------------------
!   s-coordinate or hybrid z-s-coordinate
!-----------------------------------------------------------------------
   rn_sbot_min =   10.     !  minimum depth of s-bottom surface (&gt;0) (m)
   rn_sbot_max = 7000.     !  maximum depth of s-bottom surface
                           !  (= ocean depth) (&gt;0) (m)
   ln_s_sigma  = .true.   !  hybrid s-sigma coordinates
   rn_hc       =  150.0    !  critical depth with s-sigma

!-----------------------------------------------------------------------
!  grid information
!-----------------------------------------------------------------------
   sn_src_hgr = &#39;./mesh_hgr_src.nc&#39;   !  /grid/
   sn_src_zgr = &#39;./mesh_zgr_src.nc&#39;
   sn_dst_hgr = &#39;./domain_cfg.nc&#39;
   sn_dst_zgr = &#39;./inputs_dst.ncml&#39; ! rename output variables
   sn_src_msk = &#39;./mask_src.nc&#39;
   sn_bathy   = &#39;./bathy_meter.nc&#39;

!-----------------------------------------------------------------------
!  I/O
!-----------------------------------------------------------------------
   sn_src_dir = &#39;./thredds_inputs_src.ncml&#39;       ! src_files/&#39;
   sn_dst_dir = &#39;/work/jelt/NEMO/SEAsia/INPUTS/&#39;
   sn_fn      = &#39;SEAsia&#39;                 ! prefix for output files
   nn_fv      = -1e20                     !  set fill value for output files
   nn_src_time_adj = 0                                    ! src time adjustment
   sn_dst_metainfo = &#39;metadata info: jelt&#39;

 !-----------------------------------------------------------------------
 !  unstructured open boundaries
 !-----------------------------------------------------------------------
     ln_coords_file = .true.               !  =T : produce bdy coordinates files
     cn_coords_file = &#39;coordinates.bdy.nc&#39; !  name of bdy coordinates files (if ln_coords_file=.TRUE.)
     ln_mask_file   = .false.              !  =T : read mask from file
     cn_mask_file   = &#39;./bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
</pre></div>
</div>
</dd>
</dl>
<p>Originally, for barotropic forcing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln_dyn2d       = .false.               !  boundary conditions for barotropic fields
ln_dyn3d       = .false.               !  boundary conditions for baroclinic velocities
ln_tra         = .false.               !  boundary conditions for T and S
ln_ice         = .false.               !  ice boundary condition
nn_rimwidth    = 1                     !  width of the relaxation zone
</pre></div>
</div>
<p>Change for baroclinic forcing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln_dyn2d       = .true.               !  boundary conditions for barotropic fields
ln_dyn3d       = .true.               !  boundary conditions for baroclinic velocities
ln_tra         = .true.               !  boundary conditions for T and S
ln_ice         = .false.               !  ice boundary condition
nn_rimwidth    = 9                    !  width of the relaxation zone
</pre></div>
</div>
<p>Continuing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
!  unstructured open boundaries tidal parameters
!-----------------------------------------------------------------------
    ln_tide        = .true.               !  =T : produce bdy tidal conditions
    clname(1) =  &#39;M2&#39;
    clname(2) =  &#39;S2&#39;
    clname(3) =  &#39;N2&#39;
    clname(4) =  &#39;K2&#39;
    clname(5) =  &#39;K1&#39;
    clname(6) =  &#39;O1&#39;
    clname(7) =  &#39;P1&#39;
    clname(8) =  &#39;Q1&#39;
    clname(9) =  &#39;M4&#39;
    ln_trans       = .false.
    sn_tide_h     = &#39;/work/jelt/tpxo7.2/h_tpxo7.2.nc&#39;
    sn_tide_u     = &#39;/work/jelt/tpxo7.2/u_tpxo7.2.nc&#39;

!-----------------------------------------------------------------------
!  Time information
!-----------------------------------------------------------------------
    nn_year_000     = 1979        !  year start
    nn_year_end     = 1979        !  year end
    nn_month_000    = 11          !  month start (default = 1 is years&gt;1)
    nn_month_end    = 11          !  month end (default = 12 is years&gt;1)
    sn_dst_calendar = &#39;gregorian&#39; !  output calendar format
    nn_base_year    = 1978        !  base year for time counter
    sn_tide_grid    = &#39;/work/jelt/tpxo7.2/grid_tpxo7.2.nc&#39;

!-----------------------------------------------------------------------
!  Additional parameters
!-----------------------------------------------------------------------
    nn_wei  = 1                   !  smoothing filter weights
    rn_r0   = 0.041666666         !  decorrelation distance use in gauss
                                  !  smoothing onto dst points. Need to
                                  !  make this a funct. of dlon
    sn_history  = &#39;bdy files produced by jelt from ORCA0083-N01&#39;
                                  !  history for netcdf file
    ln_nemo3p4  = .true.          !  else presume v3.2 or v3.3
    nn_alpha    = 0               !  Euler rotation angle
    nn_beta     = 0               !  Euler rotation angle
    nn_gamma    = 0               !  Euler rotation angle
    rn_mask_max_depth = 300.0     !  Maximum depth to be ignored for the mask
    rn_mask_shelfbreak_dist = 60    !  Distance from the shelf break
</pre></div>
</div>
<dl class="docutils">
<dt>Also had to check/create <code class="docutils literal"><span class="pre">inputs_dst.ncml</span></code>, that it has the correct file name within:</dt>
<dd><dl class="first last docutils">
<dt><em>Now domain_cfg.nc, formerly mesh_zgr.nc</em>. Note also that some variables in</dt>
<dd><p class="first">domain_cfg.nc have different names e.g. <code class="docutils literal"><span class="pre">mbathy</span></code> &#8211;&gt; <code class="docutils literal"><span class="pre">bottom_level</span></code>. Check the mapping
in <code class="docutils literal"><span class="pre">inputs_dst.ncml</span></code>:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">inputs_dst</span><span class="o">.</span><span class="n">ncml</span>

 <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">ns0</span><span class="o">=</span><span class="s2">&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;NEMO aggregation&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;union&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:domain_cfg.nc&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mbathy&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;bottom_level&quot;</span> <span class="o">/&gt;</span>
     <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e3u&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;e3u_0&quot;</span> <span class="o">/&gt;</span>
     <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e3v&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;e3v_0&quot;</span> <span class="o">/&gt;</span>
     <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e3t&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;e3t_0&quot;</span> <span class="o">/&gt;</span>
     <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e3w&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;e3w_0&quot;</span> <span class="o">/&gt;</span>
     <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="run-pynemo-nrct-to-generate-boundary-conditions">
<h3>Run PyNEMO / NRCT to generate boundary conditions<a class="headerlink" href="#run-pynemo-nrct-to-generate-boundary-conditions" title="Permalink to this headline">¶</a></h3>
<p>First install PyNEMO <a href="#id13"><span class="problematic" id="id14">`install_nrct`_</span></a> if not already done so.</p>
<p>Generate the boundary conditions with PyNEMO</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module load anaconda/2.1.0  # Want python2
source activate nrct_env
cd $INPUTS
export LD_LIBRARY_PATH=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64/lib/amd64/server:$LD_LIBRARY_PATH

pynemo -s namelist.bdy
</pre></div>
</div>
<dl class="docutils">
<dt>This generates::</dt>
<dd><p class="first">ls -1 $INPUTS</p>
<p class="last">coordinates.bdy.nc
SEAsia_bdytide_rotT_M2_grid_T.nc
SEAsia_bdytide_rotT_N2_grid_T.nc
SEAsia_bdytide_rotT_S2_grid_T.nc
SEAsia_bdytide_rotT_K1_grid_T.nc
SEAsia_bdytide_rotT_K2_grid_T.nc
SEAsia_bdytide_rotT_P1_grid_T.nc
SEAsia_bdytide_rotT_O1_grid_T.nc
SEAsia_bdytide_rotT_M4_grid_T.nc
SEAsia_bdytide_rotT_Q1_grid_T.nc
SEAsia_bdytide_rotT_M2_grid_U.nc
SEAsia_bdytide_rotT_N2_grid_U.nc
SEAsia_bdytide_rotT_S2_grid_U.nc
SEAsia_bdytide_rotT_K1_grid_U.nc
SEAsia_bdytide_rotT_K2_grid_U.nc
SEAsia_bdytide_rotT_P1_grid_U.nc
SEAsia_bdytide_rotT_O1_grid_U.nc
SEAsia_bdytide_rotT_M4_grid_U.nc
SEAsia_bdytide_rotT_Q1_grid_U.nc
SEAsia_bdytide_rotT_M2_grid_V.nc
SEAsia_bdytide_rotT_N2_grid_V.nc
SEAsia_bdytide_rotT_S2_grid_V.nc
SEAsia_bdytide_rotT_K1_grid_V.nc
SEAsia_bdytide_rotT_K2_grid_V.nc
SEAsia_bdytide_rotT_P1_grid_V.nc
SEAsia_bdytide_rotT_O1_grid_V.nc
SEAsia_bdytide_rotT_M4_grid_V.nc
SEAsia_bdytide_rotT_Q1_grid_V.nc</p>
</dd>
</dl>
<p>Copy the new files back onto ARCHER</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4$
cd $INPUTS
rsync -utv coordinates.bdy.nc $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/coordinates.bdy.nc
for file in $CONFIG*nc; do rsync -utv $file $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/$file ; done
</pre></div>
</div>
</div>
<div class="section" id="run-the-configuration-on-archer-turn-on-the-tides">
<h3>8. Run the configuration ON ARCHER. Turn on the tides<a class="headerlink" href="#run-the-configuration-on-archer-turn-on-the-tides" title="Permalink to this headline">¶</a></h3>
<p>Get set up:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">archer</span>
<span class="o">.</span> <span class="o">~/</span><span class="n">temporary_path_names_for_NEMO_build</span>
</pre></div>
</div>
<p>Get important files into EXP directory. Should already have <code class="docutils literal"><span class="pre">domain_cfg.nc</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP
rsync -tuv $INPUTS/bathy_meter.nc $EXP/.
rsync -tuv $INPUTS/coordinates.nc $EXP/.
rsync -tuv $INPUTS/coordinates.bdy.nc $EXP/.
rsync -tuv $START_FILES/namelist_cfg $EXP/.
</pre></div>
</div>
<p>Create symbolic links from EXP directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s $INPUTS $EXP/bdydta
</pre></div>
</div>
<p>Edit the output to have 1hrly SSH, and harmonic output:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi file_def_nemo.xml
...
&lt;file_group id=&quot;1h&quot; output_freq=&quot;1h&quot;  output_level=&quot;10&quot; enabled=&quot;.TRUE.&quot;&gt; &lt;!-- 1h files --&gt;
 &lt;file id=&quot;file19&quot; name_suffix=&quot;_SSH&quot; description=&quot;ocean T grid variables&quot; &gt;
   &lt;field field_ref=&quot;ssh&quot;          name=&quot;zos&quot;   /&gt;
 &lt;/file&gt;
&lt;/file_group&gt;
...
&lt;file_group id=&quot;5d&quot; output_freq=&quot;5d&quot;  output_level=&quot;10&quot; enabled=&quot;.TRUE.&quot;&gt;  &lt;!-- 5d files --&gt;
  &lt;file id=&quot;file8&quot; name_suffix=&quot;_D2_Tides&quot; description=&quot;tidal harmonics&quot; &gt;
    &lt;field field_ref=&quot;M2x&quot;          name=&quot;M2x&quot;      long_name=&quot;M2 Elevation harmonic real part&quot;                       /&gt;
    &lt;field field_ref=&quot;M2y&quot;          name=&quot;M2y&quot;      long_name=&quot;M2 Elevation harmonic imaginary part&quot;                  /&gt;
    &lt;field field_ref=&quot;M2x_u&quot;        name=&quot;M2x_u&quot;    long_name=&quot;M2 current barotropic along i-axis harmonic real part &quot;       /&gt;
    &lt;field field_ref=&quot;M2y_u&quot;        name=&quot;M2y_u&quot;    long_name=&quot;M2 current barotropic along i-axis harmonic imaginary part &quot;  /&gt;
    &lt;field field_ref=&quot;M2x_v&quot;        name=&quot;M2x_v&quot;    long_name=&quot;M2 current barotropic along j-axis harmonic real part &quot;       /&gt;
    &lt;field field_ref=&quot;M2y_v&quot;        name=&quot;M2y_v&quot;    long_name=&quot;M2 current barotropic along j-axis harmonic imaginary part &quot;  /&gt;
    ...
  &lt;/file&gt;
&lt;/file_group&gt;
</pre></div>
</div>
<p>&#8212;</p>
<p>Create a short queue runscript (Note: PBS -N jobname, PBS -m email):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi runscript_short

#!/bin/bash
#PBS -N SEAsia
#PBS -l select=5
#PBS -l walltime=00:20:00
#PBS -A n01-NOCL
# mail alert at (b)eginning, (e)nd and (a)bortion of execution
#PBS -m bea
#PBS -M jelt@noc.ac.uk
#PBS -q short

module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel
module load cray-hdf5-parallel

export PBS_O_WORKDIR=$(readlink -f $PBS_O_WORKDIR)
#  echo $(readlink -f $PBS_O_WORKDIR)
# export OMP_NUM_THREADS=1

cd $PBS_O_WORKDIR
#
  echo &quot; &quot;;
  OCEANCORES=88
  XIOSCORES=4
ulimit -c unlimited
ulimit -s unlimited

rm -f core
aprun -b -n $XIOSCORES -N 4 ./xios_server.exe : -n $OCEANCORES -N 24 ./opa

exit
</pre></div>
</div>
<p>Change the notification email to your own address:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;s/xxx@noc/$USER@noc/g&quot;</span> <span class="n">runscript</span>
</pre></div>
</div>
<p>Might also want to change the account name. E.g. <code class="docutils literal"><span class="pre">n01-ACCORD</span></code></p>
<p>&#8212;</p>
<p>Edit <code class="docutils literal"><span class="pre">namelist_cfg</span></code> to make sure it is OK</p>
<p>&#8212;
<em>IT WORKS. IF IT WORKS, ARCHIVE namelist_cfg too*</em></p>
<p>&#8212;
<em>(17 Nov 17)</em> build new 75 level hybrid z-s coordinates. Submitted cold start</p>
<blockquote>
<div>20 min job.</div></blockquote>
<p>DID IT WORK? Yes. (Just completed the 1440 steps in 20mins)</p>
<p><em>(18 Nov 17)</em> Add in lots of TPXO harmonics. Run again with 40mins. Completed in 21mins.
With rn_rdt=60 this is only 1 day of simulation.
Try increasing the timestep.</p>
<p>rn_rdt = 360 and resubmit. Completes in 20min 30days.
<strong>But fills with NaNs from NE Boundary</strong></p>
<p>&#8212;
<em>(23 Jan 18)</em> rn_rdt = 120. 7200 steps. 20 mins. Ran 1278 steps in 20mins (~42hrs). STABLE.</p>
</div>
<div class="section" id="update-tides-code-with-nico-s-version">
<h3>Update tides code with Nico&#8217;s version.<a class="headerlink" href="#update-tides-code-with-nico-s-version" title="Permalink to this headline">¶</a></h3>
<p>Add the POLCOMS harmonic analysis to the executable (as in now in)
<a class="reference external" href="build_opa_orchestra.rst">build_opa_orchestra.rst</a>
This requires some changes to the standard <code class="docutils literal"><span class="pre">namelist_cfg</span></code></p>
<p>Add the final (extra) three variables in your namelist_cfg / nambdy_tide</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $EXP/namelist_cfg
...
!-----------------------------------------------------------------------
&amp;nambdy_tide   !  tidal forcing at open boundaries
!-----------------------------------------------------------------------
   filtide      = &#39;bdydta/SEAsia_bdytide_rotT_&#39;         !  file name root of tidal forcing files
   ln_bdytide_2ddta = .false.                   !
   ln_bdytide_conj  = .false.                    !
                                                                ! Harmonic analysis with restart from polcom
   ln_harm_ana_compute=.true.          ! Compute the harmonic analysis at the last time step
   ln_harm_ana_store=.true.                 ! Store the harmonic analysis at the last time step for restart
   ln_harmana_read=.false.                    ! Read haronic analyisis from a restart
/
</pre></div>
</div>
<p>Edit xml files to output harmonics as amplitudes and phases (e.g.):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi file_def_nemo.xml
...
&lt;file_group id=&quot;tidal_harmonics&quot; output_freq=&quot;1h&quot;  output_level=&quot;10&quot; enabled=&quot;.TRUE.&quot;&gt; &lt;!-- 1d files --&gt;
  &lt;file id=&quot;tidalanalysis.grid_T&quot; name=&quot;harmonic_grid_T&quot; description=&quot;ocean T grid variables&quot;  enabled=&quot;.TRUE.&quot;&gt;

    &lt;field field_ref=&quot;O1amp&quot;         name=&quot;O1amp&quot;       operation=&quot;instant&quot; enabled=&quot;.TRUE.&quot; /&gt;
    &lt;field field_ref=&quot;O1phase&quot;       name=&quot;O1phase&quot;     operation=&quot;instant&quot; enabled=&quot;.TRUE.&quot; /&gt;


vi field_def_nemo-opa.xml
...
    &lt;field_group id=&quot;Tides_T&quot; grid_ref=&quot;grid_T_2D&quot; operation=&quot;once&quot; &gt;
    &lt;!-- tidal composante --&gt;
    ...
    &lt;field id=&quot;Q1amp&quot;        long_name=&quot;Q1 Elevation harmonic Amplitude&quot;                              unit=&quot;m&quot;        /&gt;
    &lt;field id=&quot;Q1phase&quot;      long_name=&quot;Q1 Elevation harmonic Phase&quot;                                  unit=&quot;degree&quot;   /&gt;
</pre></div>
</div>
<dl class="docutils">
<dt><em>Recall there are elevation, u-vel and v-vel harmonics</em>. Also editted suffixes</dt>
<dd>in velocity fields, adding <code class="docutils literal"><span class="pre">_2D</span></code>.</dd>
</dl>
<ul class="simple">
<li>As before the constituents you want to analyse are set-up in <code class="docutils literal"><span class="pre">nam_diaharm</span></code></li>
</ul>
<blockquote>
<div>namelist.</div></blockquote>
<ul class="simple">
<li>The harmonic analysis is done at the end only as well as the restart dumping</li>
</ul>
<dl class="docutils">
<dt>so you can only restart from the last time step so make sure you output the full</dt>
<dd><dl class="first last docutils">
<dt>restart at the end. To restart, you just need to turn on the <code class="docutils literal"><span class="pre">ln_harmana_read</span></code></dt>
<dd><dl class="first docutils">
<dt>and to map the files to something like <code class="docutils literal"><span class="pre">restart_harm_ana_*</span></code>  as this bit as</dt>
<dd><dl class="first last docutils">
<dt>not been developed with a prefix to load the files. You can look at this</dt>
<dd>python script if needed:</dd>
</dl>
</dd>
</dl>
<p class="last"><code class="docutils literal"><span class="pre">/work/n01/n01/nibrun/RUNS/SWPacific/SIMU/01_harm_links.py</span></code></p>
</dd>
</dl>
</dd>
</dl>
<p>Resubmit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP
qsub -q short runscript_short
</pre></div>
</div>
<p>Ran for 20mins. Simulated 45hrs (though I guess it hit the wall limit before
doing the harmonic analysis)</p>
<hr class="docutils" />
<p><em>(This short section was done with the old tides routine)</em></p>
<p>No met (missing slp) <code class="docutils literal"><span class="pre">ln_usr=T</span></code>. rn_rdt=60s. Output more harmonics (20-30days).
Run for 30 days:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP
qsub -q short runscript
</pre></div>
</div>
<p><strong>IT WORKS!</strong> Hit wall time of 20mins after ~2 hours</p>
<p>Submit a big job on 2k processors to get through the spin up <em>(Need to do this efficiently)</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi runscript
#PBS -N SEAsia
#PBS -l select=92
#PBS -l walltime=00:20:00
…
  echo &quot; &quot;;
  OCEANCORES=200
  XIOSCORES=40
…
aprun -b -n $XIOSCORES -N 5 ./xios_server.exe : -n $OCEANCORES -N 24 ./opa
</pre></div>
</div>
<p>Ran for 60 hrs before hitting 20 min wall time. (NB 51 levels)
use python script to plot SSH animation (NB need to put the python script somewhere better!):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">python</span> <span class="n">SEAsia_SSH_anim</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Creates an animation of hours 35 - 60 in SSH.</p>
<p>&#8212;</p>
</div>
<div class="section" id="mpp-decomposition-for-land-suppression">
<h3>MPP decomposition for land suppression<a class="headerlink" href="#mpp-decomposition-for-land-suppression" title="Permalink to this headline">¶</a></h3>
<p><a href="#id15"><span class="problematic" id="id16">`MPP_decomp_lanf_suppression.rst`_</span></a></p>
<dl class="docutils">
<dt>Before doing long runs it is important to optimise MPP decompositoin by invoking</dt>
<dd>land supression to save redundant ocean processors.</dd>
<dt>Resulting decomposition (with notes for both standard or short queue</dt>
<dd><p class="first">configurations):</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg
...
!-----------------------------------------------------------------------
&amp;nammpp        !   Massively Parallel Processing                        (&quot;key_mpp_mpi)
!-----------------------------------------------------------------------
   cn_mpi_send =  &#39;I&#39;      !  mpi send/recieve type   =&#39;S&#39;, &#39;B&#39;, or &#39;I&#39; for standard send,
                           !  buffer blocking send or immediate non-blocking sends, resp.
   nn_buffer   =   0       !  size in bytes of exported buffer (&#39;B&#39; case), 0 no exportation
   ln_nnogather=  .false.  !  activate code to avoid mpi_allgather use at the northfold
   jpni        =  12    ! standardqueue:12 ! shortqueue:11      !  jpni   number of processors following i (set automatically if &lt; 1)
   jpnj        =  8     !  jpnj   number of processors following j (set automatically if &lt; 1)
   jpnij       =  92    ! standardqueue:92 ! shortqueue:88 !  jpnij  number of local domains (set automatically if &lt; 1)
</pre></div>
</div>
</dd>
</dl>
<p>Inspect <code class="docutils literal"><span class="pre">ocean_output</span></code> to find <code class="docutils literal"><span class="pre">jpnij</span></code>. In my simulation <code class="docutils literal"><span class="pre">jpni=12,</span> <span class="pre">jpnj=8</span> <span class="pre">--&gt;</span> <span class="pre">jpnij</span> <span class="pre">=</span> <span class="pre">92</span></code>
Update OCEANCORES in runscript (make sure the <code class="docutils literal"><span class="pre">aprun</span></code> statement is as expected too):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">runscript</span>
<span class="o">...</span>
<span class="n">OCEANCORES</span><span class="o">=</span><span class="mi">92</span>
</pre></div>
</div>
<p>And submit again.</p>
<hr class="docutils" />
<p>2074 timesteps ~ 34 hours with dt=1 min</p>
<p>Not much point using more processors as the tiles are already quite small. Instead
need more walltime.</p>
<p>With dt=60, 1 day = 1440 steps. Run one day on the short queue to see what is
happening with SSH etc.</p>
<p>Do I need to a run with constant T, S? <strong>YES</strong></p>
</div>
</div>
<div class="section" id="horizontally-constant-t-and-s-initial-condition">
<h2>Horizontally constant T and S initial condition<a class="headerlink" href="#horizontally-constant-t-and-s-initial-condition" title="Permalink to this headline">¶</a></h2>
<p>Emulate James ORCHESTRA method (first moved usrdef_istate.F90 to usrdef_istate.F90_constTS for safe keeping):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR/$CONFIG/MY_SRC
cp /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ORCHESTRA/MY_SRC/usrdef_istate.F90 .
cp /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ORCHESTRA/MY_SRC/lapack.F90 .
cp /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ORCHESTRA/MY_SRC/splines.F90 .
cp /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ORCHESTRA/MY_SRC/types.F90 .
cp /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ORCHESTRA/MY_SRC/utils.F90 .
</pre></div>
</div>
<p>Edit usrdef_istate.F90 to put in profile
Data from Hamburg WOCE Climatology Live Access Server at (-2N, 95E).
With constant variable padding below 4000m to make it up to 75 levels:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">zdep</span><span class="p">(:)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>     <span class="mi">0</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>    <span class="mi">20</span><span class="p">,</span>    <span class="mi">30</span><span class="p">,</span>    <span class="mi">40</span><span class="p">,</span>    <span class="mi">50</span><span class="p">,</span>   <span class="mi">75</span><span class="p">,</span>    <span class="mi">100</span><span class="p">,</span>   <span class="mi">125</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>    <span class="mi">150</span><span class="p">,</span>   <span class="mi">175</span><span class="p">,</span>   <span class="mi">200</span><span class="p">,</span>   <span class="mi">250</span><span class="p">,</span>   <span class="mi">300</span><span class="p">,</span>   <span class="mi">350</span><span class="p">,</span>  <span class="mi">400</span><span class="p">,</span>    <span class="mi">500</span><span class="p">,</span>   <span class="mi">600</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>    <span class="mi">700</span><span class="p">,</span>   <span class="mi">800</span><span class="p">,</span>   <span class="mi">900</span><span class="p">,</span>  <span class="mi">1000</span><span class="p">,</span>  <span class="mi">1100</span><span class="p">,</span>  <span class="mi">1200</span><span class="p">,</span>  <span class="mi">1300</span><span class="p">,</span>  <span class="mi">1400</span><span class="p">,</span>  <span class="mi">1500</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mi">1750</span><span class="p">,</span>  <span class="mi">2000</span><span class="p">,</span>  <span class="mi">2250</span><span class="p">,</span>  <span class="mi">2500</span><span class="p">,</span>  <span class="mi">2750</span><span class="p">,</span>  <span class="mi">3000</span><span class="p">,</span>  <span class="mi">3250</span><span class="p">,</span>  <span class="mi">3500</span><span class="p">,</span>  <span class="mi">3750</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mi">4000</span><span class="p">,</span>  <span class="mi">4100</span><span class="p">,</span>  <span class="mi">4200</span><span class="p">,</span>  <span class="mi">4300</span><span class="p">,</span>  <span class="mi">4400</span><span class="p">,</span>  <span class="mi">4500</span><span class="p">,</span>  <span class="mi">4550</span><span class="p">,</span>  <span class="mi">4600</span><span class="p">,</span>  <span class="mi">4700</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mi">4800</span><span class="p">,</span>  <span class="mi">4900</span><span class="p">,</span>  <span class="mi">5000</span><span class="p">,</span>  <span class="mi">5100</span><span class="p">,</span>  <span class="mi">5200</span><span class="p">,</span>  <span class="mi">5300</span><span class="p">,</span>  <span class="mi">5400</span><span class="p">,</span>  <span class="mi">5500</span><span class="p">,</span>  <span class="mi">5600</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mi">5700</span><span class="p">,</span>  <span class="mi">5800</span><span class="p">,</span>  <span class="mi">5900</span><span class="p">,</span>  <span class="mi">6000</span><span class="p">,</span>  <span class="mi">6100</span><span class="p">,</span>  <span class="mi">6200</span><span class="p">,</span>  <span class="mi">6300</span><span class="p">,</span>  <span class="mi">6400</span><span class="p">,</span>  <span class="mi">6500</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mi">6600</span><span class="p">,</span>  <span class="mi">6700</span><span class="p">,</span>  <span class="mi">6800</span><span class="p">,</span>  <span class="mi">6900</span><span class="p">,</span>  <span class="mi">7000</span><span class="p">,</span>  <span class="mi">7100</span><span class="p">,</span>  <span class="mi">7200</span><span class="p">,</span>  <span class="mi">7300</span><span class="p">,</span>  <span class="mi">7400</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mi">7500</span><span class="p">,</span>  <span class="mi">7600</span><span class="p">,</span>  <span class="mi">7700</span> <span class="o">/</span><span class="p">)</span>

<span class="n">zsal</span><span class="p">(:)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">34.05</span><span class="p">,</span> <span class="mf">34.05</span><span class="p">,</span> <span class="mf">34.10</span><span class="p">,</span> <span class="mf">34.13</span><span class="p">,</span> <span class="mf">34.25</span><span class="p">,</span> <span class="mf">34.42</span><span class="p">,</span> <span class="mf">34.88</span><span class="p">,</span> <span class="mf">35.08</span><span class="p">,</span> <span class="mf">35.13</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>  <span class="mf">35.08</span><span class="p">,</span> <span class="mf">35.07</span><span class="p">,</span> <span class="mf">35.06</span><span class="p">,</span> <span class="mf">35.06</span><span class="p">,</span> <span class="mf">35.03</span><span class="p">,</span> <span class="mf">35.01</span><span class="p">,</span> <span class="mf">34.99</span><span class="p">,</span> <span class="mf">34.96</span><span class="p">,</span> <span class="mf">34.97</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>  <span class="mf">34.97</span><span class="p">,</span> <span class="mf">34.95</span><span class="p">,</span> <span class="mf">34.92</span><span class="p">,</span> <span class="mf">34.91</span><span class="p">,</span> <span class="mf">34.88</span><span class="p">,</span> <span class="mf">34.87</span><span class="p">,</span> <span class="mf">34.85</span><span class="p">,</span> <span class="mf">34.83</span><span class="p">,</span> <span class="mf">34.82</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>  <span class="mf">34.80</span><span class="p">,</span> <span class="mf">34.77</span><span class="p">,</span> <span class="mf">34.76</span><span class="p">,</span> <span class="mf">34.75</span><span class="p">,</span> <span class="mf">34.74</span><span class="p">,</span> <span class="mf">34.73</span><span class="p">,</span> <span class="mf">34.73</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>  <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>  <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>  <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>  <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>  <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span><span class="p">,</span> <span class="mf">34.72</span> <span class="o">/</span><span class="p">)</span>

<span class="n">ztmp</span><span class="p">(:)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">28.87</span><span class="p">,</span> <span class="mf">28.87</span><span class="p">,</span> <span class="mf">28.87</span><span class="p">,</span> <span class="mf">28.74</span><span class="p">,</span> <span class="mf">28.33</span><span class="p">,</span> <span class="mf">28.01</span><span class="p">,</span> <span class="mf">25.21</span><span class="p">,</span> <span class="mf">21.99</span><span class="p">,</span> <span class="mf">18.51</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>  <span class="mf">15.55</span><span class="p">,</span> <span class="mf">14.39</span><span class="p">,</span> <span class="mf">13.43</span><span class="p">,</span> <span class="mf">12.27</span><span class="p">,</span> <span class="mf">11.48</span><span class="p">,</span> <span class="mf">11.02</span><span class="p">,</span> <span class="mf">10.51</span><span class="p">,</span>  <span class="mf">9.58</span><span class="p">,</span>  <span class="mf">8.95</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mf">8.35</span><span class="p">,</span>  <span class="mf">7.78</span><span class="p">,</span>  <span class="mf">7.16</span><span class="p">,</span>  <span class="mf">6.52</span><span class="p">,</span>  <span class="mf">5.88</span><span class="p">,</span>  <span class="mf">5.44</span><span class="p">,</span>  <span class="mf">5.02</span><span class="p">,</span>  <span class="mf">4.57</span><span class="p">,</span>  <span class="mf">4.14</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mf">3.34</span><span class="p">,</span>  <span class="mf">2.64</span><span class="p">,</span>  <span class="mf">2.31</span><span class="p">,</span>  <span class="mf">2.05</span><span class="p">,</span>  <span class="mf">1.86</span><span class="p">,</span>  <span class="mf">1.69</span><span class="p">,</span>  <span class="mf">1.58</span><span class="p">,</span>  <span class="mf">1.41</span><span class="p">,</span>  <span class="mf">1.23</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>   <span class="o">&amp;</span>
          <span class="o">&amp;</span>   <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span><span class="p">,</span>  <span class="mf">1.15</span>  <span class="o">/</span><span class="p">)</span>
</pre></div>
</div>
<p>I fixed the top two layers to be constant salinity and temperature to avoid possible cabling.
The raw data had inversions at 10m</p>
<p>NB avoding mistakes: namely a duplicate depth in the input depth funciton &#8211;&gt; spline failure</p>
</div>
<div class="section" id="turn-off-tidal-forcing">
<h2>Turn off tidal forcing<a class="headerlink" href="#turn-off-tidal-forcing" title="Permalink to this headline">¶</a></h2>
<p>Need to turn off tidal forcing. See <code class="docutils literal"><span class="pre">&amp;nam_tide</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln_tide     = .false.
ln_tide_pot = .false.    !  use tidal potential forcing
</pre></div>
</div>
<p>Comment out tidal analysis line</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">../</span><span class="n">cpp_SEAsia</span><span class="o">.</span><span class="n">fcm</span>
  <span class="n">bld</span><span class="p">::</span><span class="n">tool</span><span class="p">::</span><span class="n">fppkeys</span> <span class="n">key_zdfgls</span>        \
<span class="o">//</span><span class="n">REMOVE</span><span class="o">//</span>                 <span class="n">key_harm_ana</span>       \
                 <span class="n">key_mpp_mpi</span>       \
                 <span class="n">key_iomput</span>        \
                 <span class="n">key_nosignedzero</span>
</pre></div>
</div>
<p>Will have to recompile.</p>
<div class="section" id="set-boudaries-to-initial-condition">
<h3>Set boudaries to initial condition<a class="headerlink" href="#set-boudaries-to-initial-condition" title="Permalink to this headline">¶</a></h3>
<p>(nn_dyn2d_dta was 2):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;nambdy        !  unstructured open boundaries
!-----------------------------------------------------------------------
    ln_bdy         = .false.              !  Use unstructured open boundaries
    nb_bdy         = 1                    !  number of open boundary sets
    ln_coords_file = .true.               !  =T : read bdy coordinates from file
    cn_coords_file = &#39;coordinates.bdy.nc&#39; !  bdy coordinates files
    ln_mask_file   = .false.              !  =T : read mask from file
    cn_mask_file   = &#39;bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
    cn_dyn2d       = &#39;flather&#39;               !
    nn_dyn2d_dta   =  0                   !  = 0, bdy data are equal to the initial state
</pre></div>
</div>
<p>Recompile the code.
Resubmit with dt=60s and nt = 60 (ie, 1 hr):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR
./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
<p>Move the executable to a special name:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mv $CONFIG/BLD/bin/nemo.exe $CONFIG/BLD/bin/nemo_notide_TSprofile.exe
</pre></div>
</div>
<p>Move to experiment dir and link executable file in:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP/../EXP-hpg_err
ln -s $CDIR/$CONFIG/BLD/bin/nemo_notide_TSprofile.exe opa
</pre></div>
</div>
<p>James spotted that I didn&#8217;t have lateral diffusion of momentum. Made some changes (following ORCHESTRA namelist_cfg)
Submitted run (EXP01) to test timestep. rn_rdt=360 ran 1304 in 20mins ==&gt; 5.4 days</p>
<p>There an SSH instability in the NE corner when using:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cn_dyn3d</span>      <span class="o">=</span>  <span class="s1">&#39;neumann&#39;</span>
</pre></div>
</div>
<p>Switch to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cn_dyn3d</span>      <span class="o">=</span>  <span class="s1">&#39;zerograd&#39;</span>
</pre></div>
</div>
<p>NB Tried masking, using mask_bdy.nc, but this didn&#8217;t work.</p>
<p>Cold start run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namrun        !   parameters of the run
!-----------------------------------------------------------------------
   cn_exp      =    &quot;SEAsia&quot;  !  experience name
   nn_it000    =  01   !  first time step
   nn_itend    =  7200 ! 30day=7200   !  last  time step (std 5475)
   nn_date0    =  20000102   !  date at nit_0000 (format yyyymmdd) used if ln_rstart=F or (ln_rstart=T and nn_rstctl=0 or 1)
   nn_time0    =       0   !  initial time of day in hhmm
   nn_leapy    =       1   !  Leap year calendar (1) or not (0)
   ln_rstart   = .false.   !  start from rest (F) or from a restart file (T)
</pre></div>
</div>
<p>Run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="n">runscript</span>
</pre></div>
</div>
<p>Yes. That works.</p>
<p>Though the SSS min decreases by 0.017 over 30 days. A bit odd? Perhaps it is
the non conservative nature of the advective schemes...</p>
<p>NB The effect is coastal. There is no problem around the boundaries.
<em>(26 March 2018)</em></p>
<p>&#8212;</p>
<p>Performance note:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">With</span> <span class="n">tides</span> <span class="n">turned</span> <span class="n">off</span><span class="o">.</span> <span class="n">Initial</span> <span class="n">conditions</span><span class="p">:</span> <span class="n">T</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="n">S</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="n">profiles</span> <span class="ow">and</span> <span class="n">u</span><span class="o">=</span><span class="n">v</span><span class="o">=</span><span class="n">w</span><span class="o">=</span><span class="mf">0.</span>

<span class="n">Submit</span> <span class="k">for</span> <span class="mi">10</span> <span class="n">days</span> <span class="n">dt</span><span class="o">=</span><span class="mi">60</span><span class="n">s</span><span class="o">.</span> <span class="n">nt</span><span class="o">=</span><span class="mi">14400</span>
<span class="n">Try</span> <span class="mi">20</span><span class="n">mins</span> <span class="n">queue</span><span class="o">.</span> <span class="o">--&gt;</span> <span class="mi">1128</span> <span class="n">steps</span><span class="o">.</span>

<span class="n">Try</span> <span class="mi">30</span><span class="n">mins</span> <span class="k">with</span> <span class="mi">5</span><span class="n">day</span> <span class="n">mean</span> <span class="n">output</span><span class="o">.</span>

<span class="n">Ran</span> <span class="mi">10</span><span class="n">days</span> <span class="n">simulation</span> <span class="ow">in</span> <span class="mi">2</span><span class="n">hrs</span> <span class="mi">24</span><span class="n">mins</span> <span class="p">(</span><span class="n">rn_rdt</span><span class="o">=</span><span class="mi">60</span><span class="n">s</span><span class="p">,</span> <span class="n">nt</span><span class="o">=</span><span class="mi">14400</span><span class="p">,</span> <span class="n">on</span> <span class="mi">92</span> <span class="n">ocean</span> <span class="n">cores</span><span class="p">,</span> <span class="mi">120</span> <span class="n">cpus</span><span class="p">(</span><span class="n">total</span><span class="p">))</span><span class="o">.</span>
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="hpg-errors">
<h3>HPG errors<a class="headerlink" href="#hpg-errors" title="Permalink to this headline">¶</a></h3>
<p>Submit a 30 day simulation, from rest, with depth varying spatially homogeneous
temperature and salinity profiles, with no forcing, boundary conditions off:
<code class="docutils literal"><span class="pre">ln_bdy</span> <span class="pre">=</span> <span class="pre">F</span></code></p>
<p>Edit runscript: 2hrs walltime. It took 1h 50mins</p>
<p>Edit namelist_cfg
360s, nt=7200 &#8211;&gt; 30 days:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln_tide     = .false.
ln_tide_pot = .false.    !  use tidal potential forcing
</pre></div>
</div>
<p>cd $EXP/../EXP_hpg_err</p>
<p>Scrape <code class="docutils literal"><span class="pre">umax</span></code> from <code class="docutils literal"><span class="pre">solver.state</span></code> using plot_solver_stat.py</p>
<p>Some along rim currents started but these are small compared to interior currents.
Restart for another 30 days.
After 30 days umax is still growing. Restart run and continue:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mv</span> <span class="n">solver</span><span class="o">.</span><span class="n">stat</span> <span class="n">solver</span><span class="o">.</span><span class="n">stat_part1</span>
</pre></div>
</div>
<p>Check progress with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">hpg_error_plotNEMO</span><span class="o">.</span><span class="n">py</span>
<span class="n">plot_solver_stat</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Edit namelist_cfg for restarting:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg

!-----------------------------------------------------------------------
&amp;namrun        !   parameters of the run
!-----------------------------------------------------------------------
   cn_exp      =    &quot;SEAsia&quot;  !  experience name
   nn_it000    =  7201   !  first time step
   nn_itend    =  14400 ! 30day=7200   !  last  time step (std 5475)
   nn_date0    =  20000102   !  date at nit_0000 (format yyyymmdd) used if ln_rstart=F or (ln_rstart=T and nn_rstctl=0 or 1)
   nn_time0    =       0   !  initial time of day in hhmm
   nn_leapy    =       1   !  Leap year calendar (1) or not (0)
   ln_rstart   = .true.   !  start from rest (F) or from a restart file (T)
      nn_euler    =    1            !  = 0 : start with forward time step if ln_rstart=T
      nn_rstctl   =    2            !  restart control ==&gt; activated only if ln_rstart=T
      cn_ocerst_in    = &quot;SEAsia_00007200_restart&quot;   !  suffix of ocean restart name (input)
</pre></div>
</div>
<p>Resubmit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="n">runscript</span>
</pre></div>
</div>
<p>Ran in 1hr 46</p>
<p>Joing the solver.stat files together:</p>
<p>cp solver.stat solver.stat_part2
cp solver.stat_part1 solver.stat
cat solver.stat_part2 &gt;&gt; solver.stat</p>
<p>module load anaconda
python plot_solver_stat.py</p>
<p>..note:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">the</span> <span class="n">end</span> <span class="n">I</span> <span class="n">didn</span><span class="s1">&#39;t do the restart for the last run I did.</span>
</pre></div>
</div>
</div>
<div class="section" id="internal-tide-with-idealised-stratification">
<h3>Internal tide with idealised stratification<a class="headerlink" href="#internal-tide-with-idealised-stratification" title="Permalink to this headline">¶</a></h3>
<p>Try with tides turned on.
(Recompile a tide and no tide version. Save in $CONFIG/BLD/bin as nemo_tide.exe
and nemo_notide.exe, then link as appropriate):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd EXP00
ls -s /work/n01/n01/jelt/SEAsia/trunk_NEMOGCM_r8395/CONFIG/SEAsia/BLD/bin/nemo_tide.exe opa

&lt;    ln_tide     = .true.
&lt;    ln_tide_pot = .true.    !  use tidal potential forcing
...
&lt;     nn_dyn2d_dta   =  2                   !  = 0, bdy data are equal to the initial state

qsub -q short runscript
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="tide-only-simulation">
<h3>Tide only simulation<a class="headerlink" href="#tide-only-simulation" title="Permalink to this headline">¶</a></h3>
<p>directory <code class="docutils literal"><span class="pre">EXP_tideonly</span></code></p>
<p>Only tidal forcing. constant T and S
Include: key_harm_ana
EXEC: nemo_tideonyl_TSconst.exe</p>
<p>Recompile the code.
Resubmit with dt=60s and nt = 60 (ie, 1 hr):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR
cp $CONFIG/MY_SRC/usrdef_istate.F90_horizTS $CONFIG/MY_SRC/usrdef_istate.F90

./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
<p>Move executable to something permanent:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR/$CONFIG/BLD/bin
mv nemo.exe nemo_tideonly_TSconst.exe

cd $CDIR/$CONFIG/EXP_tideonly
ln -s /work/n01/n01/jelt/SEAsia/trunk_NEMOGCM_r8395/CONFIG/SEAsia/BLD/bin/nemo_tideonly_TSconst.exe opa
</pre></div>
</div>
<p>Edit namelist_cfg:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>nn_itend = 14400
ln_rstart = .false.
...
ln_tide     = .true.
ln_tide_pot = .true.    !  use tidal potential forcing
...
!-----------------------------------------------------------------------
&amp;nambdy        !  unstructured open boundaries
!-----------------------------------------------------------------------
    ln_bdy         = .true.              !  Use unstructured open boundaries
    nb_bdy         = 1                    !  number of open boundary sets
    ln_coords_file = .true.               !  =T : read bdy coordinates from file
    cn_coords_file = &#39;coordinates.bdy.nc&#39; !  bdy coordinates files
    ln_mask_file   = .false.              !  =T : read mask from file
    cn_mask_file   = &#39;bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
    cn_dyn2d       = &#39;flather&#39;               !
    nn_dyn2d_dta   =  2                   !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
                                          !  = 2, use tidal harmonic forcing data from files
                                          !  = 3, use external data AND tidal harmonic forcing
    cn_dyn3d      =  &#39;zerograd&#39;               !
    nn_dyn3d_dta  =  0                    !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
    cn_tra        =  &#39;frs&#39;               !
    nn_tra_dta    =  0                    !  = 0, bdy data are equal to the initial state
</pre></div>
</div>
<p>Didn&#8217;t bother with the tidal harmonics. It will run but I am spinning up.</p>
<p>Run for 4 hours. nt = 14400, dt =360, 60 days. Completed in 3hr 31.</p>
<p>Edit XML output to produce 5d output.
Resubmit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="n">runscript</span>
</pre></div>
</div>
<p><em>(23 Mar 2018)</em>
Turn on 19 harmonics using the POLCOMS harmonic analysis (Nico&#8217;s instructions and edits)
Run for another 60 days with harmonic analysis restarting capbability.</p>
<p>Works. Did tidal analysis plots</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">GitLab</span><span class="o">/</span><span class="n">JMMP_tools</span>
<span class="n">python</span> <span class="n">Tidal_analysis_amplitude</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">verbose</span>
<span class="n">python</span> <span class="n">Tidal_analysis_plot</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<p>Need to continue run</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>namelist_cfg

...
!-----------------------------------------------------------------------
&amp;namrun        !   parameters of the run
!-----------------------------------------------------------------------
   cn_exp      =    &quot;SEAsia&quot;  !  experience name
   nn_it000    =  28801   !  first time step
   nn_itend    =  43200 ! 10day=14400   !  last  time step (std 5475)
   nn_date0    =  20000102   !  date at nit_0000 (format yyyymmdd) used if ln_rstart=F or (ln_rstart=T and nn_rstctl=0 or 1)
   nn_time0    =       0   !  initial time of day in hhmm
   nn_leapy    =       1   !  Leap year calendar (1) or not (0)
   ln_rstart   = .true.   !  start from rest (F) or from a restart file (T)
      nn_euler    =    1            !  = 0 : start with forward time step if ln_rstart=T
      nn_rstctl   =    2            !  restart control ==&gt; activated only if ln_rstart=T
      !                             !    = 0 nn_date0 read in namelist ; nn_it000 : read in namelist
      !                             !    = 1 nn_date0 read in namelist ; nn_it000 : check consistancy between namelist and restart
      !                             !    = 2 nn_date0 read in restart  ; nn_it000 : check consistancy between namelist and restart
      cn_ocerst_in    = &quot;SEAsia_00028800_restart&quot;   !  suffix of ocean restart name (input)

!-----------------------------------------------------------------------
&amp;nambdy_tide   !  tidal forcing at open boundaries
!-----------------------------------------------------------------------
   filtide      = &#39;bdydta/SEAsia_bdytide_rotT_&#39;         !  file name root of tidal forcing files
   ln_bdytide_2ddta = .false.                   !
   ln_bdytide_conj  = .false.                   !
                                                ! Harmonic analysis with restart from polcom
   ln_harm_ana_compute=.true.                   ! Compute the harmonic analysis at the last time step
   ln_harm_ana_store=.true.                     ! Store the harmonic analysis at the last time step for restart
   ln_harmana_read=.true.                      ! Read haronic analyisis from a restart



 !-----------------------------------------------------------------------
 &amp;nam_diaharm   !   Harmonic analysis of tidal constituents               (&quot;key_diaharm&quot;)
 !-----------------------------------------------------------------------
     nit000_han = 28801         ! First time step used for harmonic analysis
     nitend_han = 43200 ! 1440 !      ! Last time step used for harmonic analysis
</pre></div>
</div>
<p>Submit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="n">runscript</span>
</pre></div>
</div>
<p>Took 3:36 mins. The tidal analysis (<a class="reference external" href="https://www.evernote.com/shard/s652/nl/85824826/674115d9-29be-480a-ba71-6814de98df4b/">https://www.evernote.com/shard/s652/nl/85824826/674115d9-29be-480a-ba71-6814de98df4b/</a>) doesn&#8217;t show significant improvement</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">GitLab</span><span class="o">/</span><span class="n">JMMP_tools</span>
<span class="n">python</span> <span class="n">Tidal_analysis_amplitude</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">verbose</span>
<span class="n">python</span> <span class="n">Tidal_analysis_plot</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<p>But 4 months of simulation might still be on the short side. Run for another two months.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg
...
!-----------------------------------------------------------------------
&amp;namrun        !   parameters of the run
!-----------------------------------------------------------------------
   cn_exp      =    &quot;SEAsia&quot;  !  experience name
   nn_it000    =  43201   !  first time step
   nn_itend    =  57600 ! 10day=14400   !  last  time step (std 5475)
   nn_date0    =  20000102   !  date at nit_0000 (format yyyymmdd) used if ln_rstart=F or (ln_rstart=T and nn_rstctl=0 or 1)
   nn_time0    =       0   !  initial time of day in hhmm
   nn_leapy    =       1   !  Leap year calendar (1) or not (0)
   ln_rstart   = .true.   !  start from rest (F) or from a restart file (T)
      nn_euler    =    1            !  = 0 : start with forward time step if ln_rstart=T
      nn_rstctl   =    2            !  restart control ==&gt; activated only if ln_rstart=T
      !                             !    = 0 nn_date0 read in namelist ; nn_it000 : read in namelist
      !                             !    = 1 nn_date0 read in namelist ; nn_it000 : check consistancy between namelist and restart
      !                             !    = 2 nn_date0 read in restart  ; nn_it000 : check consistancy between namelist and restart
      cn_ocerst_in    = &quot;SEAsia_00043200_restart&quot;   !  suffix of ocean restart name (input)




 !-----------------------------------------------------------------------
 &amp;nam_diaharm   !   Harmonic analysis of tidal constituents               (&quot;key_diaharm&quot;)
 !-----------------------------------------------------------------------
     nit000_han = 43201         ! First time step used for harmonic analysis
     nitend_han = 57600 ! 1440 !      ! Last time step used for harmonic analysis
</pre></div>
</div>
<p>Submit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="n">runscript</span>
</pre></div>
</div>
<p>Ran with minor change to statistcs.</p>
</div>
<div class="section" id="tide-with-idealised-stratification-and-rivers">
<h3>Tide with idealised stratification and rivers<a class="headerlink" href="#tide-with-idealised-stratification-and-rivers" title="Permalink to this headline">¶</a></h3>
<p>directory <code class="docutils literal"><span class="pre">EXP_tide_TSprofile_river</span></code></p>
<p>Only tidal forcing. profile of T and S
Include: key_harm_ana
EXEC: nemo_tide_TSprofile_nomet.exe</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp EXP_tideonly/* EXP_tide_TSprofile_river/.
ln -s $INPUTS bdydta
</pre></div>
</div>
<p>Recompile the code.
Resubmit with dt=60s and nt = 60 (ie, 1 hr):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR
cp $CONFIG/MY_SRC/usrdef_istate.F90_horizTS $CONFIG/MY_SRC/usrdef_istate.F90

./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
<p>Move executable to something permanent:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR/$CONFIG/BLD/bin
mv nemo.exe nemo_tide_TSprofile_nomet.exe

cd $CDIR/$CONFIG/EXP_tide_TSprofile_river
ln -s /work/n01/n01/jelt/SEAsia/trunk_NEMOGCM_r8395/CONFIG/SEAsia/BLD/bin/nemo_tide_TSprofile_nomet.exe opa
</pre></div>
</div>
<p>Edit namelist_cfg:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namrun        !   parameters of the run
!-----------------------------------------------------------------------
   cn_exp      =    &quot;SEAsia&quot;  !  experience name
   nn_it000    =  57601   !  first time step
   nn_itend    =  58560 ! 10day=14400   !  last  time step (std 5475)
   nn_date0    =  20000102   !  date at nit_0000 (format yyyymmdd) used if ln_rstart=F or (ln_rstart=T and nn_rstctl=0 or 1)
   nn_time0    =       0   !  initial time of day in hhmm
   nn_leapy    =       1   !  Leap year calendar (1) or not (0)
   ln_rstart   = .true.   !  start from rest (F) or from a restart file (T)
      nn_euler    =    1            !  = 0 : start with forward time step if ln_rstart=T
      nn_rstctl   =    2            !  restart control ==&gt; activated only if ln_rstart=T
      !                             !    = 0 nn_date0 read in namelist ; nn_it000 : read in namelist
      !                             !    = 1 nn_date0 read in namelist ; nn_it000 : check consistancy between namelist and restart
      !                             !    = 2 nn_date0 read in restart  ; nn_it000 : check consistancy between namelist and restart
      cn_ocerst_in    = &quot;SEAsia_00057600_restart&quot;   !  suffix of ocean restart name (input)

...

!-----------------------------------------------------------------------
&amp;nam_tide      !   tide parameters
!-----------------------------------------------------------------------
   ln_tide     = .true.
   ln_tide_pot = .true.    !  use tidal potential forcing
...

!-----------------------------------------------------------------------
&amp;nambdy        !  unstructured open boundaries
!-----------------------------------------------------------------------
    ln_bdy         = .true.              !  Use unstructured open boundaries
    nb_bdy         = 1                    !  number of open boundary sets
    ln_coords_file = .true.               !  =T : read bdy coordinates from file
    cn_coords_file = &#39;coordinates.bdy.nc&#39; !  bdy coordinates files
    ln_mask_file   = .false.              !  =T : read mask from file
    cn_mask_file   = &#39;bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
    cn_dyn2d       = &#39;flather&#39;               !
    nn_dyn2d_dta   =  2                   !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
                                          !  = 2, use tidal harmonic forcing data from files
                                          !  = 3, use external data AND tidal harmonic forcing
    cn_dyn3d      =  &#39;zerograd&#39;               !
    nn_dyn3d_dta  =  0                    !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
    cn_tra        =  &#39;frs&#39;               !
    nn_tra_dta    =  0                    !  = 0, bdy data are equal to the initial state
    ...

!-----------------------------------------------------------------------
&amp;nambdy_tide   !  tidal forcing at open boundaries
!-----------------------------------------------------------------------
   filtide      = &#39;bdydta/SEAsia_bdytide_rotT_&#39;         !  file name root of tidal forcing files
   ln_bdytide_2ddta = .false.                   !
   ln_bdytide_conj  = .false.                   !
                                                ! Harmonic analysis with restart from polcom
   ln_harm_ana_compute=.true.                   ! Compute the harmonic analysis at the last time step
   ln_harm_ana_store=.true.                     ! Store the harmonic analysis at the last time step for restart
   ln_harmana_read=.true.                      ! Read haronic analyisis from a restart

...
!-----------------------------------------------------------------------
&amp;nam_diaharm   !   Harmonic analysis of tidal constituents               (&quot;key_diaharm&quot;)
!-----------------------------------------------------------------------
    nit000_han = 57601         ! First time step used for harmonic analysis
    nitend_han = 58560 ! 1440 !      ! Last time step used for harmonic analysis
</pre></div>
</div>
<p>Finally turn rivers on:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namsbc        !   Surface Boundary Condition (surface module)
!-----------------------------------------------------------------------
ln_rnf      = .true.    !  runoffs                                   (T =&gt; fill namsbc_rnf)
...
!-----------------------------------------------------------------------
&amp;namsbc_rnf    !   runoffs namelist surface boundary condition          (ln_rnf=T)
!-----------------------------------------------------------------------
!              !  file name           ! frequency (hours) ! variable  ! time interp. !  clim  ! &#39;yearly&#39;/ ! weights  ! rotation ! land/sea mask !
!              !                      !  (if &lt;0  months)  !   name    !   (logical)  !  (T/F) ! &#39;monthly&#39; ! filename ! pairing  ! filename      !
   sn_rnf      = &#39;SEAsia_rivers&#39;,        -1         , &#39;rorunoff&#39;,   .true.     , .true. , &#39;yearly&#39;  , &#39;&#39;       , &#39;&#39;       , &#39;&#39;
   sn_cnf      = &#39;SEAsia_rivers&#39;,         0         , &#39;socoefr0&#39;,   .false.    , .true. , &#39;yearly&#39;  , &#39;&#39;       , &#39;&#39;       , &#39;&#39;
   ...
   cn_dir      = &#39;bdydta/&#39;      !  root directory for the location of the runoff files
   ln_rnf_mouth= .false.    !  specific treatment at rivers mouths
</pre></div>
</div>
<p>Edit runscript:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">runscript</span>
<span class="c1">#PBS -l walltime=00:30:00</span>
</pre></div>
</div>
<p>Resubmit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="n">runscript</span>
</pre></div>
</div>
<p><strong>PENDING</strong>
<em>(27 Apr 2018)</em></p>
<p>/work/n01/n01/jelt/SEAsia/trunk_NEMOGCM_r8395/CONFIG/SEAsia/EXP_tide_TSprofile_river</p>
<p>Run for 30 mins. nt = 960, dt =360, 4 days. Completed in  15 mins 06s.</p>
<p>CHECK OUTPUT - This works, but 4 days is not very exciting.</p>
</div>
<div class="section" id="initial-conditions">
<h3>Initial conditions<a class="headerlink" href="#initial-conditions" title="Permalink to this headline">¶</a></h3>
<p>directory: EXP_hpg_initcd</p>
<p>Switch in initial conditions from the existing (working) tide only homogeneous run.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">EXP_hpg_initcd</span>
</pre></div>
</div>
<p>Copy files from ??? to EXP_hpg_initcd <strong>ADDING IN -K keeps symlinks. I THINK</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>rsync -aPvt --exclude=*restart*nc --exclude=*_?d_*grid_?.nc EXP_tideonly/* EXP_hpg_initcd/
</pre></div>
</div>
<p>Try from rest.</p>
<p>Rerun the last successful tidal only simulation but with initial conditions.
Switch off bcs and tides run for 60 days:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg

...
cn_exp      =    &quot;SEAsia&quot;  !  experience name
nn_it000    =  1   !  first time step
nn_itend    =  7200 ! 30day=7200; dt=360  !  last  time step (std 5475)

ln_restart = .false.
</pre></div>
</div>
<p>Turn off open boundaries:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;nambdy        !  unstructured open boundaries
!-----------------------------------------------------------------------
    ln_bdy         = .false.              !  Use unstructured open boundaries
    nb_bdy         = 1                    !  number of open boundary sets
    ln_coords_file = .true.               !  =T : read bdy coordinates from file
    cn_coords_file = &#39;coordinates.bdy.nc&#39; !  bdy coordinates files
    ln_mask_file   = .false.              !  =T : read mask from file
    cn_mask_file   = &#39;bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
    cn_dyn2d       = &#39;flather&#39;               !
    nn_dyn2d_dta   =  0                   !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
                                          !  = 2, use tidal harmonic forcing data from files
                                          !  = 3, use external data AND tidal harmonic forcing
    cn_dyn3d      =  &#39;zerograd&#39;               !
    nn_dyn3d_dta  =  0                    !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
    cn_tra        =  &#39;frs&#39;               !
    nn_tra_dta    =  0                    !  = 0, bdy data are equal to the initial state
</pre></div>
</div>
<p>Turn off tides:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;nam_tide      !   tide parameters
!-----------------------------------------------------------------------
   ln_tide     = .false.
   ln_tide_pot = .false.    !  use tidal potential forcing
</pre></div>
</div>
<p>Make sure the harmonic restart is also off (not so important yet since ln_tide=F):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln_harmana_read=.false.                      ! Read haronic analyisis from a restart
...
!-----------------------------------------------------------------------
&amp;nam_diaharm   !   Harmonic analysis of tidal constituents               (&quot;key_diaharm&quot;)
!-----------------------------------------------------------------------
    nit000_han = 1         ! First time step used for harmonic analysis
    nitend_han = 2400 ! 1440 !      ! Last time step used for harmonic analysis
</pre></div>
</div>
<p>Turn on intial conditions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namtsd        !   data : Temperature  &amp; Salinity
!-----------------------------------------------------------------------
!              !  file name                 ! frequency (hours) ! variable ! time interp.!  clim  ! &#39;yearly&#39;/ ! weights  ! rotation ! land/sea mask !
!              !                            !  (if &lt;0  months)  !   name   !  (logical)  !  (T/F) ! &#39;monthly&#39; ! filename ! pairing  ! filename      !
sn_tem  = &#39;votemper_ORCA0083-N01-SEAsia_1978.nc&#39;,         -12        ,&#39;votemper&#39; ,  .false.   , .true. , &#39;yearly&#39;   , &#39;&#39;   ,   &#39;&#39;    ,    &#39;&#39;
sn_sal  = &#39;vosaline_ORCA0083-N01-SEAsia_1978.nc&#39;,         -12        ,&#39;vosaline&#39; ,  .false.   , .true. , &#39;yearly&#39;   , &#39;&#39;   ,   &#39;&#39;    ,    &#39;&#39;
sn_dep  = &#39;initcd_depth.nc&#39;   ,         -12        ,&#39;gdept_4D&#39;,   .false.   , .true. , &#39;yearly&#39;   , &#39;&#39;  ,    &#39;&#39;    ,      &#39;&#39;
sn_msk  = &#39;initcd_mask.nc&#39;    ,         -12        ,&#39;mask&#39;,       .false.   , .true. , &#39;yearly&#39;   , &#39;&#39;  ,    &#39;&#39;    ,      &#39;&#39;

  !
   cn_dir        = &#39;../../../../INPUTS/&#39;     !  root directory for the location of the runoff files
   ln_tsd_init   = .true.   !  Initialisation of ocean T &amp; S with T &amp;S input data (T) or not (F)
   ln_tsd_interp = .true.    !  Interpolation of T &amp; S in the verticalinput data (T) or not (F)
   ln_tsd_tradmp = .false.   !  damping of ocean T &amp; S toward T &amp;S input data (T) or not (F)
</pre></div>
</div>
<p>Add some daily output:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi file_def_nemo.xml

  &lt;file_group id=&quot;1d&quot; output_freq=&quot;1d&quot;  output_level=&quot;10&quot; enabled=&quot;.TRUE.&quot;&gt;  &lt;!-- 1d files --&gt;
  &lt;file id=&quot;file19&quot; name_suffix=&quot;_SS&quot; description=&quot;ocean T grid variables&quot; &gt;
   &lt;field field_ref=&quot;ssh&quot;          name=&quot;zos&quot;   /&gt;
   &lt;field field_ref=&quot;sss&quot;          name=&quot;sss&quot;   /&gt;
  &lt;/file&gt;
&lt;/file_group&gt;
</pre></div>
</div>
<p>Link in missing sybolic link files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="n">opa</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">../</span><span class="n">BLD</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">nemo_tide_nomet</span><span class="o">.</span><span class="n">exe</span> <span class="n">opa</span>
</pre></div>
</div>
<p>I also fudged the dates on the boundary conditions files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
ln -s SEAsia_bdyT_y1979m11.nc SEAsia_bdyT_y2000m01.nc
ln -s SEAsia_bdyU_y1979m11.nc SEAsia_bdyU_y2000m01.nc
ln -s SEAsia_bdyV_y1979m11.nc SEAsia_bdyV_y2000m01.nc
ln -s SEAsia_bt_bdyT_y1979m11.nc SEAsia_bt_bdyT_y2000m01.nc
</pre></div>
</div>
<p>Run on short queue:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">SEAsia</span><span class="o">/</span><span class="n">EXP_tide_initcd</span>
<span class="n">qsub</span> <span class="n">runscript_short</span>
</pre></div>
</div>
<p>Later in evening run on standard queue (2hrs):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">SEAsia</span><span class="o">/</span><span class="n">EXP_tide_initcd</span>
<span class="n">qsub</span> <span class="n">runscript</span>
</pre></div>
</div>
<p><strong>THIS WORKS</strong> 13 May 2018</p>
<div class="section" id="initial-conditions-tides">
<h4>Initial conditions + tides<a class="headerlink" href="#initial-conditions-tides" title="Permalink to this headline">¶</a></h4>
<p>directory: EXP_tide_initcd</p>
<p>EXEC: <code class="docutils literal"><span class="pre">nemo_tide_nomet.exe</span></code></p>
<p>Switch in initial conditions from the existing (working) tide only homogeneous run.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">EXP_tide_initcd</span>
</pre></div>
</div>
<p>Copy files from ??? to EXP_tide_initcd <strong>ADDING IN -K keeps symlinks. I THINK</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>rsync -aPvt --exclude=*restart*nc --exclude=*_?d_*grid_?.nc EXP_hpg_initcd/* EXP_tide_initcd/
</pre></div>
</div>
<p>Try from rest.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg

...
cn_exp      =    &quot;SEAsia&quot;  !  experience name
nn_it000    =  1   !  first time step
nn_itend    =  7200 ! 30day=7200; dt=360  !  last  time step (std 5475)

ln_restart = .false.
</pre></div>
</div>
<p>Turn off open boundaries:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;nambdy        !  unstructured open boundaries
!-----------------------------------------------------------------------
    ln_bdy         = .false.              !  Use unstructured open boundaries
    nb_bdy         = 1                    !  number of open boundary sets
    ln_coords_file = .true.               !  =T : read bdy coordinates from file
    cn_coords_file = &#39;coordinates.bdy.nc&#39; !  bdy coordinates files
    ln_mask_file   = .false.              !  =T : read mask from file
    cn_mask_file   = &#39;bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
    cn_dyn2d       = &#39;flather&#39;               !
    nn_dyn2d_dta   =  0                   !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
                                          !  = 2, use tidal harmonic forcing data from files
                                          !  = 3, use external data AND tidal harmonic forcing
    cn_dyn3d      =  &#39;zerograd&#39;               !
    nn_dyn3d_dta  =  0                    !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
    cn_tra        =  &#39;frs&#39;               !
    nn_tra_dta    =  0                    !  = 0, bdy data are equal to the initial state
</pre></div>
</div>
<p>Turn on tides:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;nam_tide      !   tide parameters
!-----------------------------------------------------------------------
   ln_tide     = .true.
   ln_tide_pot = .true.    !  use tidal potential forcing
</pre></div>
</div>
<p>Make sure the harmonic restart is also off</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln_harmana_read=.false.                      ! Read haronic analyisis from a restart
...
!-----------------------------------------------------------------------
&amp;nam_diaharm   !   Harmonic analysis of tidal constituents               (&quot;key_diaharm&quot;)
!-----------------------------------------------------------------------
    nit000_han = 1         ! First time step used for harmonic analysis
    nitend_han = 2400 ! 1440 !      ! Last time step used for harmonic analysis
</pre></div>
</div>
<p>cd /work/n01/n01/jelt/SEAsia/trunk_NEMOGCM_r8395/CONFIG/SEAsia/EXP_tide_initcd</p>
<p><strong>PENDING</strong> 5324836.sdb
13 May 2018</p>
<p>completed 1hr 39</p>
</div>
</div>
<div class="section" id="try-lateral-boundary-conditions-t-s-u">
<h3>Try lateral boundary conditions T,S,u<a class="headerlink" href="#try-lateral-boundary-conditions-t-s-u" title="Permalink to this headline">¶</a></h3>
<p><strong>Next steps</strong></p>
<ul class="simple">
<li>lateral boundary conditions (T,S,u)</li>
<li>tides + lateral boundary conditions</li>
</ul>
<p>&#8212;</p>
<p><em>(24 Apr 2018)</em>
Build the 3D boundary conditions from ORCA0083-N01
==================================================</p>
<p>Use PyNEMO to generate 3D bcs on livljobs4:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ssh livljobs4

. ~/temporary_path_names_for_NEMO_build
cd $INPUTS
</pre></div>
</div>
<p>Edit the namelist.bdy for 3D fields. There are a few key things to note:</p>
<ul class="simple">
<li>Turn off the tides <code class="docutils literal"><span class="pre">ln_tide</span> <span class="pre">=.false.</span></code> and change <code class="docutils literal"><span class="pre">rimwidth</span></code>: 1 &#8211;&gt; 9</li>
</ul>
<p>(tides don&#8217;t work with rimwidth != 1 and baroclinc bcs don&#8217;t work with rimwidth=1)</p>
<ul class="simple">
<li>For the ORCA0083-N001 run there was a glitch with the model timestamp. It is</li>
</ul>
<blockquote>
<div>out by 36 days and 16 hours. This can be adjusted with a new namelist variable
<code class="docutils literal"><span class="pre">nn_src_time_adj</span></code>.</div></blockquote>
<ul class="simple">
<li>The parent files could not be accessed on the thredd server because it is broken.</li>
</ul>
<blockquote>
<div>For now I&#8217;ve copied Nov 1978 into <code class="docutils literal"><span class="pre">/projectsa/accord/ORCA0083</span></code>. This is reflected
in local_inputs_src.ncml</div></blockquote>
<ul class="simple">
<li>Make sure the namelist time variables (years and months) match the timestamps in the files you</li>
</ul>
<blockquote>
<div>load otherwise not much happens...</div></blockquote>
<ul class="simple">
<li>You might need to have the time data spanning a whole month, so that a month</li>
</ul>
<blockquote>
<div>can be extracted.</div></blockquote>
<ul class="simple">
<li>Finally, there may have been an issue with a pynemo datetime function that</li>
</ul>
<blockquote>
<div>determined the datetime for end of the month in profile.py</div></blockquote>
<dl class="docutils">
<dt>I  made change to the master branch to use datetime and timedelta instead of</dt>
<dd>netcdfdatime, or something. This only matters is pynemo breaks with an</dd>
</dl>
<p>associated datetime error. Then this is the fix.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist.bdy

!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!! NEMO/OPA  : namelist for BDY generation tool
!!
!!             User inputs for generating open boundary conditions
!!             employed by the BDY module in NEMO. Boundary data
!!             can be set up for v3.2 NEMO and above.
!!
!!             More info here.....
!!
!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

!-----------------------------------------------------------------------
!   vertical coordinate
!-----------------------------------------------------------------------
   ln_zco      = .false.   !  z-coordinate - full    steps   (T/F)
   ln_zps      = .true.    !  z-coordinate - partial steps   (T/F)
   ln_sco      = .false.   !  s- or hybrid z-s-coordinate    (T/F)
   rn_hmin     =   -10     !  min depth of the ocean (&gt;0) or
                           !  min number of ocean level (&lt;0)

!-----------------------------------------------------------------------
!   s-coordinate or hybrid z-s-coordinate
!-----------------------------------------------------------------------
   rn_sbot_min =   10.     !  minimum depth of s-bottom surface (&gt;0) (m)
   rn_sbot_max = 7000.     !  maximum depth of s-bottom surface
                           !  (= ocean depth) (&gt;0) (m)
   ln_s_sigma  = .true.   !  hybrid s-sigma coordinates
   rn_hc       =  150.0    !  critical depth with s-sigma

!-----------------------------------------------------------------------
!  grid information
!-----------------------------------------------------------------------
   sn_src_hgr = &#39;./mesh_hgr_src.nc&#39;   !  parent /grid/
   sn_src_zgr = &#39;./mesh_zgr_src.nc&#39;   !  parent
   sn_dst_hgr = &#39;./domain_cfg.nc&#39;
   sn_dst_zgr = &#39;./inputs_dst.ncml&#39; ! rename output variables
   sn_src_msk = &#39;./mask_src.nc&#39;       ! parent
   sn_bathy   = &#39;./bathy_meter.nc&#39;

!-----------------------------------------------------------------------
!  I/O
!-----------------------------------------------------------------------
   sn_src_dir = &#39;./local_inputs_src.ncml&#39;       ! src_files/&#39;
   sn_dst_dir = &#39;/work/jelt/NEMO/SEAsia/INPUTS/&#39;
   sn_fn      = &#39;SEAsia&#39;                 ! prefix for output files
   nn_fv      = -1e20                     !  set fill value for output files
   nn_src_time_adj = 0                                    ! src time adjustment
   sn_dst_metainfo = &#39;metadata info: jelt&#39;

!-----------------------------------------------------------------------
!  unstructured open boundaries
!-----------------------------------------------------------------------
    ln_coords_file = .true.               !  =T : produce bdy coordinates files
    cn_coords_file = &#39;coordinates.bdy.nc&#39; !  name of bdy coordinates files (if ln_coords_file=.TRUE.)
    ln_mask_file   = .false.              !  =T : read mask from file
    cn_mask_file   = &#39;./bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
    ln_dyn2d       = .true.               !  boundary conditions for barotropic fields
    ln_dyn3d       = .true.               !  boundary conditions for baroclinic velocities
    ln_tra         = .true.               !  boundary conditions for T and S
    ln_ice         = .false.               !  ice boundary condition
    nn_rimwidth    = 9                    !  width of the relaxation zone

!-----------------------------------------------------------------------
!  unstructured open boundaries tidal parameters
!-----------------------------------------------------------------------
    ln_tide        = .false.               !  =T : produce bdy tidal conditions
    clname(1) =  &#39;M2&#39;
    clname(2) =  &#39;S2&#39;
    clname(3) =  &#39;N2&#39;
    clname(4) =  &#39;K2&#39;
    clname(5) =  &#39;K1&#39;
    clname(6) =  &#39;O1&#39;
    clname(7) =  &#39;P1&#39;
    clname(8) =  &#39;Q1&#39;
    clname(9) =  &#39;M4&#39;
    ln_trans       = .false.
    sn_tide_h     = &#39;/work/jelt/tpxo7.2/h_tpxo7.2.nc&#39;
    sn_tide_u     = &#39;/work/jelt/tpxo7.2/u_tpxo7.2.nc&#39;

!-----------------------------------------------------------------------
!  Time information
!-----------------------------------------------------------------------
    nn_year_000     = 1979        !  year start
    nn_year_end     = 1979        !  year end
    nn_month_000    = 11          !  month start (default = 1 is years&gt;1)
    nn_month_end    = 11         !  month end (default = 12 is years&gt;1)
    sn_dst_calendar = &#39;gregorian&#39; !  output calendar format
    nn_base_year    = 1978        !  base year for time counter
    sn_tide_grid    = &#39;/work/jelt/tpxo7.2/grid_tpxo7.2.nc&#39;
    nn_src_time_adj    = -3254400  ! -3168000 - 86400 ! fix to align model time stamp
!-----------------------------------------------------------------------
!  Additional parameters
!-----------------------------------------------------------------------
    nn_wei  = 1                   !  smoothing filter weights
    rn_r0   = 0.041666666         !  decorrelation distance use in gauss
                                  !  smoothing onto dst points. Need to
                                  !  make this a funct. of dlon
    sn_history  = &#39;bdy files produced by jelt from ORCA0083-N01&#39;
                                  !  history for netcdf file
    ln_nemo3p4  = .true.          !  else presume v3.2 or v3.3
    nn_alpha    = 0               !  Euler rotation angle
    nn_beta     = 0               !  Euler rotation angle
    nn_gamma    = 0               !  Euler rotation angle
    rn_mask_max_depth = 300.0     !  Maximum depth to be ignored for the mask
    rn_mask_shelfbreak_dist = 60    !  Distance from the shelf break
</pre></div>
</div>
<p>The ORCA0083-N01 parent files. (This could be streamlined with some wildcards):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">local_inputs_src</span><span class="o">.</span><span class="n">ncml</span><span class="p">::</span>

<span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">ns0</span><span class="o">=</span><span class="s2">&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;NEMO aggregation&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;union&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span> <span class="n">dimName</span><span class="o">=</span><span class="s2">&quot;time_counter&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temperature&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;joinExisting&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791101d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791106d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791111d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791116d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791121d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791126d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791201d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791206d05T.nc&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span> <span class="n">dimName</span><span class="o">=</span><span class="s2">&quot;time_counter&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;salinity&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;joinExisting&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791101d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791106d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791111d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791116d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791121d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791126d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791201d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791206d05T.nc&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span> <span class="n">dimName</span><span class="o">=</span><span class="s2">&quot;time_counter&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;zonal_velocity&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;joinExisting&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791101d05U.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791106d05U.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791111d05U.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791116d05U.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791121d05U.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791126d05U.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791201d05U.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791206d05U.nc&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span> <span class="n">dimName</span><span class="o">=</span><span class="s2">&quot;time_counter&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;meridian_velocity&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;joinExisting&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791101d05V.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791106d05V.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791111d05V.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791116d05V.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791121d05V.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791126d05V.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791201d05V.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791206d05V.nc&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span> <span class="n">dimName</span><span class="o">=</span><span class="s2">&quot;time_counter&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sea_surface_height&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;joinExisting&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791101d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791106d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791111d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791116d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791121d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791126d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791201d05T.nc&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:/projectsa/accord/ORCA0083/ORCA0083-N01_19791206d05T.nc&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Run pynemo (on branch ORCA0083):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS

module load anaconda/2.1.0  # Want python2
source activate nrct_env
cd $INPUTS
export LD_LIBRARY_PATH=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64/lib/amd64/server:$LD_LIBRARY_PATH
pynemo -s namelist.bdy
</pre></div>
</div>
<p><em>(25 Apr 2018)</em></p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">nemo_bdy_extr_tm3.py</span></code> Editted ind_NAN variable and caught exception for</li>
</ul>
<p>empty index list. Resubmitted.</p>
<p>Outputs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">coordinates</span><span class="o">.</span><span class="n">bdy</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bdyT_y1979m11</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bt_bdyT_y1979m11</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bdyU_y1979m11</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bdyV_y1979m11</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>This took 2 hours! To produce a month of boundary conditions.</p>
<p>Copy files from SAN to ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4
cd $INPUTS
for file in  SEAsia_b*nc; do rsync -uvt $file $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/$file ; done
</pre></div>
</div>
</div>
<div class="section" id="tide-2d-forcing-simulation">
<h3>Tide + 2D forcing simulation<a class="headerlink" href="#tide-2d-forcing-simulation" title="Permalink to this headline">¶</a></h3>
<p>directory <code class="docutils literal"><span class="pre">EXP_openbcs</span></code></p>
<p>EXEC: <code class="docutils literal"><span class="pre">nemo_tide_nomet.exe</span></code></p>
<dl class="docutils">
<dt>Switch in initial conditions from the existing (working) tide only homogeneous</dt>
<dd><p class="first">run:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">EXP_openbcs</span>
<span class="n">cd</span> <span class="n">EXP_openbcs</span>
</pre></div>
</div>
</dd>
</dl>
<p>Copy files from ??? to EXP_tide_initcd <strong>ADDING IN -K keeps symlinks. I THINK</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>rsync -aPvt --exclude=*restart*nc --exclude=$CONFIG*.nc EXP_tide_initcd/* EXP_openbcs/
</pre></div>
</div>
<p>Link in missing sybolic link files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="n">opa</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">../</span><span class="n">BLD</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">nemo_tide_nomet</span><span class="o">.</span><span class="n">exe</span> <span class="n">opa</span>
</pre></div>
</div>
<p>Try from rest.
First try tides only with ln_bdy=T. <code class="docutils literal"><span class="pre">nn_dyn2d_dta</span>&#160;&#160; <span class="pre">=</span>&#160; <span class="pre">2</span></code>. Ran to 400 steps (40hrs) OK
Second try with 2D bcs not tides: <code class="docutils literal"><span class="pre">nn_dyn2d_dta</span>&#160;&#160; <span class="pre">=</span>&#160; <span class="pre">1</span></code>.</p>
<dl class="docutils">
<dt>===&gt;&gt;&gt;</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">E R R O R</span><dd><blockquote class="first last">
<div></div></blockquote>
</dd>
</dl>
<p>kt=     1 max abs(U):  1.0000E+20, i j k:   288    2    1</p>
<blockquote>
<div>output of last fields in numwso</div></blockquote>
<p>&#8212; <strong>PROBLEM WITH 2D BCS</strong></p>
<p>Third try with tides + tracers:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cn_dyn2d       = &#39;flather&#39;               !
nn_dyn2d_dta   =  2                   !  = 0, bdy data are equal to the initial state
cn_dyn3d      =  &#39;zerograd&#39;               !
nn_dyn3d_dta  =  0                    !  = 0, bdy data are equal to the initial state
cn_tra        =  &#39;frs&#39;               !
nn_tra_dta    =  1                    !  = 0, bdy data are equal to the initial state
</pre></div>
</div>
<p>Also blows immediately.</p>
<p>Revisit PyNEMO. Turn off tidal output and run.</p>
</div>
<hr class="docutils" />
<div class="section" id="trouble">
<h3>trouble<a class="headerlink" href="#trouble" title="Permalink to this headline">¶</a></h3>
<p>19 May 2018</p>
<p>Make a new mask file to only process the southern boundary.
Turn off vertical interpolation in PyNEMO so that it creates output on the parent
vertical grid.</p>
<p>livljobs4/6</p>
<p>The mask variable takes values (-1 mask, 1 wet/active domain, 0 land). Need to
only mask a single point around the edge since the rimwidth is considered to be
part of the active domain.</p>
<p>PyNEMO looks for the interface between -1 and 1 to generate boundary forcings. Get a
template from domain_cfg.nc and then modify as desired around the boundary.</p>
<p>Maked the entire boundary &#8220;land=0&#8221;, except for the wet bits along the southern boundary
which are &#8220;mask=-1&#8221;:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">nco</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">4.4</span><span class="o">.</span><span class="mf">2.</span><span class="n">ncwa</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">bdy_mask</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncks</span> <span class="o">-</span><span class="n">v</span> <span class="n">top_level</span> <span class="n">domain_cfg</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncrename</span> <span class="o">-</span><span class="n">h</span> <span class="o">-</span><span class="n">v</span> <span class="n">top_level</span><span class="p">,</span><span class="n">mask</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncwa</span> <span class="o">-</span><span class="n">a</span> <span class="n">t</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">nc</span> <span class="n">bdy_mask</span><span class="o">.</span><span class="n">nc</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>In ipython:</p>
<p>import netCDF4
import numpy as np
dset = netCDF4.Dataset(&#8216;bdy_mask2.nc&#8217;,&#8217;a&#8217;)
[ny,nx] = np.shape(dset.variables[&#8216;mask&#8217;][:])
for i in range(nx):</p>
<blockquote>
<div><dl class="docutils">
<dt>if dset.variables[&#8216;mask&#8217;][1,i] == 1:</dt>
<dd>dset.variables[&#8216;mask&#8217;][0,i] = -1</dd>
<dt>else:</dt>
<dd>dset.variables[&#8216;mask&#8217;][0,i] = 0</dd>
</dl>
</div></blockquote>
<p>dset.close()</p>
<p>Rebuld pynemo as necessary <a class="reference external" href="install_nrct.rst">install_nrct.rst</a> with any fixes.</p>
<p>Rebuild boundary conditions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module load anaconda/2.1.0  # Want python2
source activate nrct_env
cd $INPUTS
export LD_LIBRARY_PATH=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64/lib/amd64/server:$LD_LIBRARY_PATH

pynemo -s namelist.bdy
</pre></div>
</div>
<hr class="docutils" />
<p><strong>21 May 2018</strong></p>
<p>Get James&#8217; to generate open bcs and try them out.
Also created a new domain_cfg.nc file.
From /work/jdha/jelt copy to $INPUTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd /work/jdha/jelt/
rsync -uvat  SEAsia_full_bdyT_y1979m11.nc jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/.
rsync -uvat  SEAsia_full_bt_bdyT_y1979m11.nc jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/.
rsync -uvat  SEAsia_full_bdyU_y1979m11.nc jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/.
rsync -uvat  SEAsia_full_bdyV_y1979m11.nc jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/.
rsync -uvat  SEAsia_full_bdytide*nc jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/.
rsync -uvat  coordinates.bdy.nc jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/.
rsync -uvat  domain_cfg_jdha.nc jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/.
</pre></div>
</div>
<p>Also has a bdy_mask.nc and a domain_cfg.nc that were the same as mine.</p>
<p>Edit the namlist for accomdate new files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> cd $EXP/../EXP_openbcs
 vi namelist_cfg

 !-----------------------------------------------------------------------
 &amp;namcfg        !   parameters of the configuration
 !-----------------------------------------------------------------------
    ln_read_cfg = .true.   !  (=T) read the domain configuration file
       !                   !  (=F) user defined configuration  ==&gt;&gt;&gt;  see usrdef(_...) modules
       cn_domcfg = &quot;domain_cfg_jdha&quot;         ! domain configuration filename

 ...

 !-----------------------------------------------------------------------
 &amp;nambdy_dta    !  open boundaries - external data
 !-----------------------------------------------------------------------
 !              !  file name      ! frequency (hours) ! variable  ! time interp.!  clim   ! &#39;yearly&#39;/ ! weights  ! rotation ! land/sea mask !
 !              !                 !  (if &lt;0  months)  !   name    !  (logical)  !  (T/F ) ! &#39;monthly&#39; ! filename ! pairing  ! filename      !
    bn_ssh      = &#39;SEAsia_full_bt_bdyT&#39;, 24      , &#39;sossheig&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
    bn_u2d      = &#39;SEAsia_full_bdyU&#39;,  24        , &#39;vobtcrtx&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
    bn_v2d      = &#39;SEAsia_full_bdyV&#39;,  24        , &#39;vobtcrty&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
    bn_u3d      = &#39;SEAsia_full_bdyU&#39;   24        , &#39;vozocrtx&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
    bn_v3d      = &#39;SEAsia_full_bdyV&#39;   24        , &#39;vomecrty&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
    bn_tem      = &#39;SEAsia_full_bdyT&#39;   24        , &#39;votemper&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
    bn_sal      = &#39;SEAsia_full_bdyT&#39;   24        , &#39;vosaline&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;


!-----------------------------------------------------------------------
&amp;nambdy_tide   !  tidal forcing at open boundaries
!-----------------------------------------------------------------------
   filtide      = &#39;bdydta/SEAsia_full_bdytide_&#39;         !  file name root of tidal forcing files
</pre></div>
</div>
</div>
<div class="section" id="catch-up-with-james-edits">
<h3>Catch up with James&#8217; edits<a class="headerlink" href="#catch-up-with-james-edits" title="Permalink to this headline">¶</a></h3>
<p><em>4 June 2018</em></p>
<p>Add Git repo of MY_SRC and do a &#8220;sparse checkout&#8221; of the MY_SRC folder:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mv $CDIR/$CONFIG/MY_SRC $CDIR/$CONFIG/MY_SRC/MY_SRC_safe
cd $WORK/$USER/$CONFIG
mkdir git_repo
cd git_repo
git init
git remote add -f origin https://github.com/NOC-MSM/NEMO_cfgs.git  # Creates and empty repo without checking out the features
git config core.sparseCheckout true
</pre></div>
</div>
<p>Specify the folders I want:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>echo $CONFIG/MY_SRC &gt;&gt; .git/info/sparse-checkout
</pre></div>
</div>
<p>Last but not least, update your empty repo with the state from the remote. (And
set the upstream remote master):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">pull</span> <span class="n">origin</span> <span class="n">master</span>
<span class="n">git</span> <span class="n">push</span> <span class="o">--</span><span class="nb">set</span><span class="o">-</span><span class="n">upstream</span> <span class="n">origin</span> <span class="n">master</span>
</pre></div>
</div>
<p>Symbolic link to where MY_SRC actually sits:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s $WORK/$USER/$CONFIG/git_repo/$CONFIG/MY_SRC $CDIR/$CONFIG/MY_SRC
</pre></div>
</div>
<p>Rebuild opa (I removed the tidal analysis key from the cpp file, as we aren&#8217;t
using it yet) At this time also removed Nico&#8217;s harmonic analysis changes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR
./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
<p>Link in executable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP/../EXP_openbcs
rm opa
ln -s ../BLD/bin/nemo.exe opa
</pre></div>
</div>
<p>Edit namelist_cfg for boundary conditions. Use full velocities with FRS for tracers
and specified for 3d velcities:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg
...
!-----------------------------------------------------------------------
&amp;nambdy        !  unstructured open boundaries
!-----------------------------------------------------------------------
    ln_bdy         = .true.              !  Use unstructured open boundaries
    nb_bdy         = 1                    !  number of open boundary sets
    ln_coords_file = .true.               !  =T : read bdy coordinates from file
    cn_coords_file = &#39;coordinates.bdy.nc&#39; !  bdy coordinates files
    ln_mask_file   = .false.              !  =T : read mask from file
    cn_mask_file   = &#39;bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
    cn_dyn2d       = &#39;flather&#39;               !
    nn_dyn2d_dta   =  3                  !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
                                          !  = 2, use tidal harmonic forcing data from files
                                          !  = 3, use external data AND tidal harmonic forcing
    cn_dyn3d      =  &#39;specified&#39;               !
    nn_dyn3d_dta  =  1                    !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
    cn_tra        =  &#39;frs&#39;               !
    nn_tra_dta    =  1                    !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
    cn_ice_lim      =  &#39;none&#39;             !
    nn_ice_lim_dta  =  0                  !  = 0, bdy data are equal to the initial state
                                          !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
    rn_ice_tem      = 270.                !  lim3 only: arbitrary temperature of incoming sea ice
    rn_ice_sal      = 10.                 !  lim3 only:      --   salinity           --
    rn_ice_age      = 30.                 !  lim3 only:      --   age                --

    ln_tra_dmp    =.false.                !  open boudaries conditions for tracers
    ln_dyn3d_dmp  =.true.                !  open boundary condition for baroclinic velocities
    rn_time_dmp   =  1.                   ! Damping time scale in days
    rn_time_dmp_out =  150.                 ! Outflow damping time scale
    nn_rimwidth   = 9                    !  width of the relaxation zone
    ln_vol        = .false.               !  total volume correction (see nn_volctl parameter)
    nn_volctl     = 1                     !  = 0, the total water flux across open boundaries is zero
    nb_jpk_bdy    =  75                   ! number of levels in the bdy data (set &lt; 0 if consistent with planned run)
/
</pre></div>
</div>
<p>Presently need to use James&#8217; forcing files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>...
!-----------------------------------------------------------------------
&amp;nambdy_dta    !  open boundaries - external data
!-----------------------------------------------------------------------
!              !  file name      ! frequency (hours) ! variable  ! time interp.!  clim   ! &#39;yearly&#39;/ ! weights  ! rotation ! land/sea mask !
!              !                 !  (if &lt;0  months)  !   name    !  (logical)  !  (T/F ) ! &#39;monthly&#39; ! filename ! pairing  ! filename      !
   bn_ssh      = &#39;SEAsia_full_bt_bdyT&#39;, 24      , &#39;sossheig&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
   bn_u2d      = &#39;SEAsia_full2_bdyU&#39;,  24        , &#39;vozocrtx&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
   bn_v2d      = &#39;SEAsia_full2_bdyV&#39;,  24        , &#39;vomecrty&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
   bn_u3d      = &#39;SEAsia_full2_bdyU&#39;   24        , &#39;vozocrtx&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
   bn_v3d      = &#39;SEAsia_full2_bdyV&#39;   24        , &#39;vomecrty&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
   bn_tem      = &#39;SEAsia_full_bdyT&#39;   24        , &#39;votemper&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
   bn_sal      = &#39;SEAsia_full_bdyT&#39;   24        , &#39;vosaline&#39;,    .true.   , .false. ,  &#39;monthly&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
! for lim2
!   bn_frld    = &#39;amm12_bdyT_ice&#39;,         24        , &#39;ileadfra&#39;,    .true.   , .false. ,  &#39;daily&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
!   bn_hicif   = &#39;amm12_bdyT_ice&#39;,         24        , &#39;iicethic&#39;,    .true.   , .false. ,  &#39;daily&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
!   bn_hsnif   = &#39;amm12_bdyT_ice&#39;,         24        , &#39;isnowthi&#39;,    .true.   , .false. ,  &#39;daily&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
! for lim3
!   bn_a_i     = &#39;amm12_bdyT_ice&#39;,         24        , &#39;ileadfra&#39;,    .true.   , .false. ,  &#39;daily&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
!   bn_ht_i    = &#39;amm12_bdyT_ice&#39;,         24        , &#39;iicethic&#39;,    .true.   , .false. ,  &#39;daily&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;
!   bn_ht_s    = &#39;amm12_bdyT_ice&#39;,         24        , &#39;isnowthi&#39;,    .true.   , .false. ,  &#39;daily&#39;  ,    &#39;&#39;    ,   &#39;&#39;     ,     &#39;&#39;

   cn_dir      = &#39;bdydta/&#39; !  root directory for the location of the bulk files
   ln_full_vel = .true.   !
/
</pre></div>
</div>
<p>Submit for 3 hours (nt=7200; 30 days) and see what happens:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="n">runscript</span>
<span class="mf">5388562.</span><span class="n">sdb</span>
</pre></div>
</div>
<p><em>11 June 18</em> Got a lead from Andrew C about XIOS2. Sumbmitted and waiting
<strong>PENDING</strong>
It should output a sub domain...
Hmm it doesn&#8217;t seem to output anything.
Perhaps start again with fresh XML files.</p>
<p>&#8212;</p>
<p><em>19 June 2018</em></p>
<p>Check that my PyNEMO implementation matches James&#8217; output.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs6:
cd $INPUTS
vi namelist.bdy
...
ln_dyn2d       = .true.               !  boundary conditions for barotropic fields
ln_dyn3d       = .true.               !  boundary conditions for baroclinic velocities
ln_tra         = .true.               !  boundary conditions for T and S
...
ln_tide = .false.
</pre></div>
</div>
<p>Rebuild PyNEMO for 3d fields (branch ORCA0083).
run time 1729.83568501 = 28 mins</p>
<p>Output:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">coordinates</span><span class="o">.</span><span class="n">bdy</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bdyT_y1979m11</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bt_bdyT_y1979m11</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bdyU_y1979m11</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bdyV_y1979m11</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<dl class="docutils">
<dt>The rimwidth doesn&#8217;t get picked up for the u2d and u3d files. Though it does</dt>
<dd><p class="first">for the T,S. Try again using the master branch.
Execution Time: 1601.68916202:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">coordinates</span><span class="o">.</span><span class="n">bdy</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bdyT_y1979m11</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bt_bdyT_y1979m11</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bdyU_y1979m11</span><span class="o">.</span><span class="n">nc</span>
<span class="n">SEAsia_bdyV_y1979m11</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
</dd>
</dl>
<p>Not sure about the size of the velocity arrays. They don&#8217;t use rimwidth != 1 ..</p>
</div>
</div>
<div class="section" id="backup-to-repo-key-files">
<h2>Backup to repo key files<a class="headerlink" href="#backup-to-repo-key-files" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">GitLab</span><span class="o">/</span><span class="n">NEMO</span><span class="o">-</span><span class="n">RELOC</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">source</span>
<span class="c1"># DOMANcfg namelist_cfg for domain_cfg.nc (for hybrid z-s coordinates)</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">utv</span> <span class="n">jelt</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">SEAsia</span><span class="o">/</span><span class="n">trunk_NEMOGCM_r8395</span><span class="o">/</span><span class="n">TOOLS</span><span class="o">/</span><span class="n">DOMAINcfg</span><span class="o">/</span><span class="n">namelist_cfg</span> <span class="n">SEAsia_DOMAINcfg_namelist_cfg</span>

<span class="c1"># EXP namelist_cfg</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">uvt</span> <span class="n">jelt</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">SEAsia</span><span class="o">/</span><span class="n">trunk_NEMOGCM_r8395</span><span class="o">/</span><span class="n">CONFIG</span><span class="o">/</span><span class="n">SEAsia</span><span class="o">/</span><span class="n">EXP00</span><span class="o">/</span><span class="n">namelist_cfg</span> <span class="n">SEAsia_EXP_namelist_cfg</span>

<span class="c1"># PyNEMO namelist.bdy</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">utv</span> <span class="n">jelt</span><span class="nd">@livljobs4</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">NEMO</span><span class="o">/</span><span class="n">SEAsia</span><span class="o">/</span><span class="n">INPUTS</span><span class="o">/</span><span class="n">namelist</span><span class="o">.</span><span class="n">bdy</span> <span class="n">SEAsia_namelist</span><span class="o">.</span><span class="n">bdy</span>

<span class="c1"># Python quick plot of SSH in the output.abort.nc file</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">uvt</span> <span class="n">jelt</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">SEAsia</span><span class="o">/</span><span class="n">trunk_NEMOGCM_r8395</span><span class="o">/</span><span class="n">CONFIG</span><span class="o">/</span><span class="n">SEAsia</span><span class="o">/</span><span class="n">EXP00</span><span class="o">/</span><span class="n">quickplotNEMO</span><span class="o">.</span><span class="n">py</span> <span class="n">quickplotNEMO</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="note-about-timestep">
<h2>Note about timestep<a class="headerlink" href="#note-about-timestep" title="Permalink to this headline">¶</a></h2>
<p>This domain has some very deep water ~7km and large areas with 6km bathymetry.
This should limit the timestep quite considerably:
A deep water wave would travel across a 1/12 degree model cell in
<code class="docutils literal"><span class="pre">110000/12</span> <span class="pre">/</span> <span class="pre">sqrt(7000*9.8)</span> <span class="pre">~</span> <span class="pre">35</span> <span class="pre">seconds</span></code>...
Consequently a timestep of 1 minute might be as far as I can push it.
&#8212;</p>
<div class="section" id="rebuild-the-output-and-inspect-rebuild-and-inspect-nemo-output-rst">
<h3>Rebuild the output and inspect <a href="#id17"><span class="problematic" id="id18">`rebuild_and_inspect_NEMO_output.rst`_</span></a><a class="headerlink" href="#rebuild-the-output-and-inspect-rebuild-and-inspect-nemo-output-rst" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>::</dt>
<dd>qsub -q short rebuild.pbs</dd>
</dl>
<p>&#8212;</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Setting up a SE Asia NEMO v4 configuration</a><ul>
<li><a class="reference internal" href="#issues-that-arose">Issues that arose</a></li>
<li><a class="reference internal" href="#recipe-notes">Recipe Notes</a></li>
<li><a class="reference internal" href="#collect-essential-files">Collect essential files</a></li>
<li><a class="reference internal" href="#build-tools">Build TOOLS</a><ul>
<li><a class="reference internal" href="#generate-new-coordinates-file">1. Generate new coordinates file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-choose-domain">1a. Choose domain</a></li>
<li><a class="reference internal" href="#decide-coordinates-for-new-se-asia-configuration-at-1-12-degree-r12">Decide coordinates for new SE Asia configuration at 1/12 degree, R12</a><ul>
<li><a class="reference internal" href="#generate-bathymetry-file">2. Generate bathymetry file</a></li>
<li><a class="reference internal" href="#generate-river-forcing">2.5 Generate River forcing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generate-a-domain-configuration-file">3. Generate a domain configuration file</a></li>
<li><a class="reference internal" href="#generate-initial-conditions">4. Generate initial conditions</a><ul>
<li><a class="reference internal" href="#generate-weights-for-atm-forcing">5. Generate weights for atm forcing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statement-about-external-forcing">Statement about external forcing</a><ul>
<li><a class="reference internal" href="#generate-boundary-conditions-with-nrct-pynemo-create-netcdf-abstraction-wrapper">6. Generate boundary conditions with NRCT/PyNEMO: Create netcdf abstraction wrapper</a></li>
<li><a class="reference internal" href="#a-generate-ncml-file-that-points-to-the-external-data">6a. Generate ncml file that points to the external data</a></li>
<li><a class="reference internal" href="#b-generate-the-namelist-bdy-file-for-pynemo-nrct">6b. Generate the namelist.bdy file for PyNEMO / NRCT</a></li>
<li><a class="reference internal" href="#run-pynemo-nrct-to-generate-boundary-conditions">Run PyNEMO / NRCT to generate boundary conditions</a></li>
<li><a class="reference internal" href="#run-the-configuration-on-archer-turn-on-the-tides">8. Run the configuration ON ARCHER. Turn on the tides</a></li>
<li><a class="reference internal" href="#update-tides-code-with-nico-s-version">Update tides code with Nico&#8217;s version.</a></li>
<li><a class="reference internal" href="#mpp-decomposition-for-land-suppression">MPP decomposition for land suppression</a></li>
</ul>
</li>
<li><a class="reference internal" href="#horizontally-constant-t-and-s-initial-condition">Horizontally constant T and S initial condition</a></li>
<li><a class="reference internal" href="#turn-off-tidal-forcing">Turn off tidal forcing</a><ul>
<li><a class="reference internal" href="#set-boudaries-to-initial-condition">Set boudaries to initial condition</a></li>
<li><a class="reference internal" href="#hpg-errors">HPG errors</a></li>
<li><a class="reference internal" href="#internal-tide-with-idealised-stratification">Internal tide with idealised stratification</a></li>
<li><a class="reference internal" href="#tide-only-simulation">Tide only simulation</a></li>
<li><a class="reference internal" href="#tide-with-idealised-stratification-and-rivers">Tide with idealised stratification and rivers</a></li>
<li><a class="reference internal" href="#initial-conditions">Initial conditions</a><ul>
<li><a class="reference internal" href="#initial-conditions-tides">Initial conditions + tides</a></li>
</ul>
</li>
<li><a class="reference internal" href="#try-lateral-boundary-conditions-t-s-u">Try lateral boundary conditions T,S,u</a></li>
<li><a class="reference internal" href="#tide-2d-forcing-simulation">Tide + 2D forcing simulation</a></li>
<li><a class="reference internal" href="#trouble">trouble</a></li>
<li><a class="reference internal" href="#catch-up-with-james-edits">Catch up with James&#8217; edits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backup-to-repo-key-files">Backup to repo key files</a></li>
<li><a class="reference internal" href="#note-about-timestep">Note about timestep</a><ul>
<li><a class="reference internal" href="#rebuild-the-output-and-inspect-rebuild-and-inspect-nemo-output-rst">Rebuild the output and inspect `rebuild_and_inspect_NEMO_output.rst`_</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="LBay_180m.html" title="previous chapter">Liverpool Bay 180m NEMO configuration</a></li>
      <li>Next: <a href="SWPacific_archer_livljobs4.html" title="next chapter">Setting up a SW Pacific NEMO v4 configuration</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/SEAsia_archer_livljobs4.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, NOC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/SEAsia_archer_livljobs4.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>