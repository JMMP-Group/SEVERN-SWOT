<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ARCHER: compilation and useful tools &#8212; NEMO-RELOC 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="NEMO-RELOC 0.1 documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#archer-compilation-and-useful-tools" id="id1">ARCHER: compilation and useful tools</a><ul>
<li><a class="reference internal" href="#compile-nemo-on-archer" id="id2">Compile NEMO on ARCHER</a><ul>
<li><a class="reference internal" href="#cray-compiler" id="id3">Cray compiler</a></li>
<li><a class="reference internal" href="#intel-compiler" id="id4">Intel compiler</a></li>
<li><a class="reference internal" href="#general-comments" id="id5">General comments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-ncview" id="id6">Running ncview</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="archer-compilation-and-useful-tools">
<h1><a class="toc-backref" href="#id1">ARCHER: compilation and useful tools</a><a class="headerlink" href="#archer-compilation-and-useful-tools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="compile-nemo-on-archer">
<h2><a class="toc-backref" href="#id2">Compile NEMO on ARCHER</a><a class="headerlink" href="#compile-nemo-on-archer" title="Permalink to this headline">¶</a></h2>
<p>You need to compile both XIOS and NEMO (with the same compilers). For NEMO 3.6, you need XIOS 1.0 (rev 703 max). With NEMO 4.0,
you need XIOS 2.0 (trunk). NEMO provides architecture files already for ARCHER.</p>
<div class="section" id="cray-compiler">
<h3><a class="toc-backref" href="#id3">Cray compiler</a><a class="headerlink" href="#cray-compiler" title="Permalink to this headline">¶</a></h3>
<p>Load the set of modules</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">libsci</span><span class="o">/</span><span class="mf">16.11</span><span class="o">.</span><span class="mi">1</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">mpich</span><span class="o">/</span><span class="mf">7.5</span><span class="o">.</span><span class="mi">5</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span><span class="o">-</span><span class="n">hdf5parallel</span><span class="o">/</span><span class="mf">4.4</span><span class="o">.</span><span class="mf">1.1</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span><span class="o">/</span><span class="mf">1.10</span><span class="o">.</span><span class="mf">0.1</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">PrgEnv</span><span class="o">-</span><span class="n">cray</span><span class="o">/</span><span class="mf">5.2</span><span class="o">.</span><span class="mi">82</span>
</pre></div>
</div>
<p>And you can use of the ARCHER NEMO template for compiling (<strong>ARCH/arch-XC_ARCHER.fcm</strong>); only need to update the path to xios</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>%NCDF_HOME           $NETCDF_DIR
%HDF5_HOME           $HDF5_DIR
%XIOS_HOME           /work/n01/n01/nibrun/NEMO/xios-1.0_r703/

%NCDF_INC            -I%NCDF_HOME/include -I%HDF5_HOME/include
%NCDF_LIB            -L%HDF5_HOME/lib -L%NCDF_HOME/lib -lnetcdff -lnetcdf -lhdf5_hl -lhdf5 -lz
%XIOS_INC            -I%XIOS_HOME/inc
%XIOS_LIB            -L%XIOS_HOME/lib -lxios

%CPP                 cpp
%FC                  ftn
%FCFLAGS             -em -s integer32 -s real64 -O0 -e0 -eZ
%FFLAGS              -em -s integer32 -s real64 -O0 -e0 -eZ
</pre></div>
</div>
<p>For XIOS, you can use <strong>arch-XC30_Cray</strong> file to compile.</p>
</div>
<div class="section" id="intel-compiler">
<h3><a class="toc-backref" href="#id4">Intel compiler</a><a class="headerlink" href="#intel-compiler" title="Permalink to this headline">¶</a></h3>
<p>Similarly</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">libsci</span><span class="o">/</span><span class="mf">16.11</span><span class="o">.</span><span class="mi">1</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">mpich</span><span class="o">/</span><span class="mf">7.5</span><span class="o">.</span><span class="mi">5</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span><span class="o">-</span><span class="n">hdf5parallel</span><span class="o">/</span><span class="mf">4.4</span><span class="o">.</span><span class="mf">1.1</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span><span class="o">/</span><span class="mf">1.10</span><span class="o">.</span><span class="mf">0.1</span>
<span class="n">module</span> <span class="n">swap</span> <span class="n">PrgEnv</span><span class="o">-</span><span class="n">cray</span> <span class="n">PrgEnv</span><span class="o">-</span><span class="n">intel</span>
</pre></div>
</div>
<p>and for the compilation</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>%NCDF_HOME           $NETCDF_DIR
%HDF5_HOME           $HDF5_DIR
%XIOS_HOME           /work/n01/n01/jelt/xios-1.0_r703/

%NCDF_INC            -I%NCDF_HOME/include -I%HDF5_HOME/include
%NCDF_LIB            -L%HDF5_HOME/lib -L%NCDF_HOME/lib -lnetcdff -lnetcdf -lhdf5_hl -lhdf5 -lz
%XIOS_INC            -I%XIOS_HOME/inc
%XIOS_LIB            -L%XIOS_HOME/lib -lxios

%CPP                 cpp
%FC                  ftn
%FCFLAGS             -integer-size 32 -real-size 64 -O3 -fp-model source -zero -fpp -warn all
%FFLAGS              -integer-size 32 -real-size 64 -O3 -fp-model source -zero -fpp -warn all
%LD                  CC -Wl,&quot;--allow-multiple-definition&quot;
%FPPFLAGS            -P -C -traditional
%LDFLAGS
%AR                  ar
%ARFLAGS             -r
%MK                  gmake
%USER_INC            %XIOS_INC %NCDF_INC
%USER_LIB            %XIOS_LIB %NCDF_LIB

%CC                  cc
%CFLAGS              -O0
</pre></div>
</div>
</div>
<div class="section" id="general-comments">
<h3><a class="toc-backref" href="#id5">General comments</a><a class="headerlink" href="#general-comments" title="Permalink to this headline">¶</a></h3>
<p>Results cannot be seen on the fly during the run. From a quick set of tests, killing the job is likely to lead to no output file access.
If the job stops before the end, in my case, I couldn&#8217;t access the data with cray compiled executable but could with intel...</p>
<p>Compiling XIOS with Cray was slow...</p>
</div>
</div>
<div class="section" id="running-ncview">
<h2><a class="toc-backref" href="#id6">Running ncview</a><a class="headerlink" href="#running-ncview" title="Permalink to this headline">¶</a></h2>
<p>You need to slightly update / change your environement. If parrallel NetCDF and h5 loaded, they need to be switched to the non-parallel version.
In addition, python through anaconda should not be loaded as it breaks links required by ncview</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">swap</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span><span class="o">-</span><span class="n">hdf5parallel</span><span class="o">/</span><span class="mf">4.4</span><span class="o">.</span><span class="mf">1.1</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span>
<span class="n">module</span> <span class="n">swap</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span><span class="o">/</span><span class="mf">1.10</span><span class="o">.</span><span class="mf">0.1</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span>
<span class="n">module</span> <span class="n">unload</span> <span class="n">anaconda</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">ncview</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ARCHER: compilation and useful tools</a><ul>
<li><a class="reference internal" href="#compile-nemo-on-archer">Compile NEMO on ARCHER</a><ul>
<li><a class="reference internal" href="#cray-compiler">Cray compiler</a></li>
<li><a class="reference internal" href="#intel-compiler">Intel compiler</a></li>
<li><a class="reference internal" href="#general-comments">General comments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-ncview">Running ncview</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/ARCHER.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, NOC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/ARCHER.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>