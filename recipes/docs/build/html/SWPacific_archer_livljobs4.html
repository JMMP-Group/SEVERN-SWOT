<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Setting up a SW Pacific NEMO v4 configuration &#8212; NEMO-RELOC 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="NEMO-RELOC 0.1 documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="setting-up-a-sw-pacific-nemo-v4-configuration">
<h1>Setting up a SW Pacific NEMO v4 configuration<a class="headerlink" href="#setting-up-a-sw-pacific-nemo-v4-configuration" title="Permalink to this headline">¶</a></h1>
<p>Machines: livljobs4, ARCHER</p>
<p>URL:: <em>to add</em>
<em>Actually I&#8217;ve taken this off readthedocs as it is internal. However writing in</em>
<em>ReStrucTed text means it is trivial to deploy anywhere with whatever style</em></p>
<ul class="simple">
<li>Build notes with:: ~/GitLab/NEMO-RELOC/docs$ make html</li>
</ul>
<p>Builds a SW Pacific regional tide-only model using GEBCO bathymetry, TPXO tidal
boundaries.</p>
<p>Build on a combination of livljobs4 and ARCHER.</p>
<p>Uses a pre-release of NEMO v4 (&#64;r8395)</p>
<p>The summary procedure:
#. ARCHER: Get code. Build tools. Generate coordinates, bathymetry, domain_cfg.nc
#. ARCHER: Generate initial conditions and atmospheric forcings
#. LIVLJOBS4: Generate boundary conditions with NRCT/PyNEMO
#. ARCHER: Run simulation</p>
<p>It is a tide-only run.</p>
<div class="section" id="issues-that-arose">
<h2>Issues that arose<a class="headerlink" href="#issues-that-arose" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>I had real trouble getting this to be stable is s-ccordinates, thought it worked</li>
</ul>
<p>for the SEAsia doman. S-coordinates affects the domain_cfg.nc generation and PyNEMO
process. So I have made &#8220;protected&#8221; copies of the <code class="docutils literal"><span class="pre">ARCHER:$TIDR/DOMAINcfg/SCO</span></code>
<code class="docutils literal"><span class="pre">LIVLJOBS:$INPUTS/SCO</span></code> directories, and tried again with z-coords (following James&#8217; examples). When I got z-coords working I did not go back to see if s-coords
where also fixed.</p>
<ul class="simple">
<li>This configuration uses 31 levels. At one point I used 5 levels but it didn&#8217;t</li>
</ul>
<p>work for, perhaps, other reasons. I haven&#8217;t revisited the number of levels.</p>
<ul class="simple">
<li>The rimwidth variable is not used for barotropic runs, though it must be consistent between</li>
</ul>
<p>PyNEMO and NEMO namelists. The rimwdith determines the relaxation zone for U,V (+T,S?) fields.</p>
<ul class="simple">
<li>There was a mask fix missing from the NEMO trunk that meant the bdy mask was not imposed</li>
</ul>
<p>back on the global mask. This led to near boundary instabilities.</p>
<ul class="simple">
<li>PyNEMO does not expect users to only want tidal output and error trapping is in</li>
</ul>
<p>a nascent stage. With the current namelist.bdy (PyNEMO namelist) it crashes after
generating the tidal boundary conditions while generating the 3D boundary conditions
that I don&#8217;t care about. I did not bother to resolve this.</p>
<ul class="simple">
<li>Trouble shooting issues are covered in <a href="#id1"><span class="problematic" id="id2">`trouble_shooting.rst`_</span></a></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="recipe-notes">
<h2>Recipe Notes<a class="headerlink" href="#recipe-notes" title="Permalink to this headline">¶</a></h2>
<p>In the following I build most stuff on ARCHER but the PyNEMO bits are done on livljobs4.
(There was a problem with some java bits working on ARCHER)
Starting on ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ssh login.archer.ac.uk

export CONFIG=SWPacific
export WORK=/work/n01/n01
export WDIR=$WORK/$USER/$CONFIG
export INPUTS=$WDIR/INPUTS
export START_FILES=$WDIR/START_FILES
export CDIR=$WDIR/trunk_NEMOGCM_r8395/CONFIG
export TDIR=$WDIR/trunk_NEMOGCM_r8395/TOOLS
export OLD_TDIR=$WORK/$USER/LBay/dev_r4621_NOC4_BDY_VERT_INTERP/NEMOGCM/TOOLS/
export EXP=$CDIR/$CONFIG/EXP00

module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel cray-hdf5-parallel
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="collect-essential-files">
<h2>Collect essential files<a class="headerlink" href="#collect-essential-files" title="Permalink to this headline">¶</a></h2>
<p>Note you might have to mkdir the odd directory or two...:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mkdir $WDIR
mkdir $INPUTS
mkdir $START_FILES
cp $WDIR/../LBay/START_FILES/dommsk.F90 $START_FILES/.
cp $WDIR/../LBay/START_FILES/bdyini.F90 $START_FILES/.
cp $WDIR/../LBay/START_FILES/coordinates_ORCA_R12.nc $START_FILES/.
cp $WDIR/../LBay/INPUTS/namelist_reshape_bilin_gebco $START_FILES/.
cp $WDIR/../SEAsia/START_FILES/usrdef_istate.F90 $START_FILES/.
cp $WDIR/../SEAsia/START_FILES/usrdef_sbc.F90    $START_FILES/.
</pre></div>
</div>
<p>Checkout and build NEMO (ORCHESTRA) trunk &#64; r8395 <a href="#id3"><span class="problematic" id="id4">`build_opa_orchestra.html`_</span></a>.
Or just build (if it is already downloaded). Note here we use user defined</p>
<blockquote>
<div><p>functions for the initial state (constant T and S) and surface forcing (zero forcing):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR
cp $START_FILES/usrdef_istate.F90 $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/usrdef_sbc.F90    $CDIR/$CONFIG/MY_SRC/.
./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
</div></blockquote>
<p>&#8212;</p>
<p>Checkout and build XIOS2 &#64; r1080 <a href="#id5"><span class="problematic" id="id6">`build_XIOS2.html`_</span></a>:</p>
<p>Or just link XIOS executable to the EXP directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s  /work/n01/n01/$USER/xios-2.0_r1080/bin/xios_server.exe $EXP/xios_server.exe
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="build-tools">
<h2>Build TOOLS<a class="headerlink" href="#build-tools" title="Permalink to this headline">¶</a></h2>
<p>To generate domain coords and rebuild tools we first need
to compile some of the NEMO TOOLS.</p>
<p>First build DOMAINcfg (which is relatively new and in NEMOv4). Use my XIOS1 file
(see userid and path in variable <code class="docutils literal"><span class="pre">%XIOS_HOME</span></code>). Copy from ARCH <em>store</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $WORK/$USER/ARCH/arch-XC_ARCHER_INTEL_XIOS1.fcm $CDIR/../ARCH/.
cd $TDIR

./maketools -m XC_ARCHER_INTEL_XIOS1 -n DOMAINcfg
./maketools -m XC_ARCHER_INTEL_XIOS1 -n REBUILD_NEMO
</pre></div>
</div>
<p>For the generation of bathymetry and met forcing weights files we need to patch
the code (to allow direct passing of arguments. NB this code has not been
updated in 7 years.):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/WEIGHTS/src
patch -b &lt; $START_FILES/scripinterp_mod.patch
patch -b &lt; $START_FILES/scripinterp.patch
patch -b &lt; $START_FILES/scrip.patch
patch -b &lt; $START_FILES/scripshape.patch
patch -b &lt; $START_FILES/scripgrid.patch

cd $TDIR
./maketools -m XC_ARCHER_INTEL_XIOS1 -n WEIGHTS
</pre></div>
</div>
<div class="section" id="generate-new-coordinates-file">
<h3>1. Generate new coordinates file<a class="headerlink" href="#generate-new-coordinates-file" title="Permalink to this headline">¶</a></h3>
<p>Generate a <code class="docutils literal"><span class="pre">coordinates.nc</span></code> file from a parent NEMO grid at some resolution.
<strong>Plan:</strong> Use tool <code class="docutils literal"><span class="pre">agrif_create_coordinates.exe</span></code> which reads cutting indices and
parent grid location from <code class="docutils literal"><span class="pre">namelist.input</span></code> and outputs a new files with new
resolution grid elements. Originally we tried to interpolate to a finer grid with
<code class="docutils literal"><span class="pre">rho=rhot=3</span></code>. Now keeping resolution at R12 incase it sorts out a stability issue.</p>
<p>Edit namelist:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/NESTING
vi namelist.input

&amp;input_output
    iom_activated = true
/
&amp;coarse_grid_files
    parent_coordinate_file = &#39;coordinates_ORCA_R12.nc&#39;
/
&amp;bathymetry
/
&amp;nesting
    imin = 865
    imax = 1405
    jmin = 1116
    jmax = 1494
    rho  = 1
    rhot = 1
    bathy_update = false
/
&amp;vertical_grid
/
&amp;partial_cells
/
&amp;nemo_coarse_grid
/
&amp;forcing_files
/
&amp;interp
/
&amp;restart
/
&amp;restart_trc
/
</pre></div>
</div>
<p>Build and execute agrif version of create_coordinates.exe.
See <a href="#id7"><span class="problematic" id="id8">`build_and_create_coordinates.rst`_</span></a></p>
<p>This creates a new coordinatesfile with contents, which is now copied to
INPUTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp 1_coordinates_ORCA_R12.nc $INPUTS/coordinates.nc
</pre></div>
</div>
<p>Now we need to generate a bathymetry on this new grid.</p>
</div>
<div class="section" id="generate-bathymetry-file">
<h3>2. Generate bathymetry file<a class="headerlink" href="#generate-bathymetry-file" title="Permalink to this headline">¶</a></h3>
<p>thopri downloaded, by parts, and merged 1 minute GEBCO data for (-30N :0N , -170E : 145E ).
Method in <code class="docutils literal"><span class="pre">/work/thopri/NEMO/SWPacific/START_FILES/gebco_lon_convertor.py</span></code>
Copy this to ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4$ rsync -utv /work/thopri/NEMO/SWPacific_ver3.6/START_FILES/GRIDONE_2D_140_-35.0_-165.0_5.0.nc jelt@login.archer.ac.uk:/work/n01/n01/jelt/SWPacific/INPUTS/.
</pre></div>
</div>
<p>Copy namelist for reshaping GEBCO data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>rsync -utv $START_FILES/namelist_reshape_bilin_gebco $INPUTS/.
</pre></div>
</div>
<dl class="docutils">
<dt>Edit namelist to point to correct input file. Edit lat and lon variable names to</dt>
<dd>make sure they match the nc file content (used e.g.</dd>
</dl>
<p><code class="docutils literal"><span class="pre">ncdump</span> <span class="pre">-h</span> <span class="pre">GRIDONE_2D_140_-35.0_-165.0_5.0.nc</span></code> to get input
variable names):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $INPUTS/namelist_reshape_bilin_gebco
...
&amp;grid_inputs
  input_file = &#39;gebco_in.nc&#39;
  nemo_file = &#39;coordinates.nc&#39;
  ...
  input_lon = &#39;lon&#39;
  input_lat = &#39;lat&#39;
  nemo_lon = &#39;glamt&#39;
  nemo_lat = &#39;gphit&#39;
  ...

  &amp;interp_inputs
  input_file = &quot;gebco_in.nc&quot;
  ...
  input_name = &quot;elevation&quot;
</pre></div>
</div>
<p>Do some things to 1) flatten out land elevations, 2) make depths positive.
Have to swap around with the modules to get nco working <em>(James
noted a problem with the default nco module)</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS

module unload cray-netcdf-hdf5parallel cray-hdf5-parallel
module load cray-netcdf cray-hdf5

module load nco/4.5.0
ncap2 -s &#39;where(elevation &gt; 0) elevation=0&#39; GRIDONE_2D_140_-35.0_-165.0_5.0.nc tmp.nc
ncflint --fix_rec_crd -w -1.0,0.0 tmp.nc tmp.nc gebco_in.nc
rm tmp.nc
</pre></div>
</div>
<p>Restore the original parallel modules:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">unload</span> <span class="n">nco</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span><span class="o">-</span><span class="n">hdf5parallel</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span>
</pre></div>
</div>
<p>Execute first scrip thing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">remap_nemo_grid_gebco</span><span class="o">.</span><span class="n">nc</span>
<span class="n">remap_data_grid_gebco</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Execute second scip thing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">data_nemo_bilin_gebco</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Execute third scip thing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scripinterp.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bathy_meter</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
</div>
<div class="section" id="generate-initial-conditions">
<h3>3. Generate initial conditions<a class="headerlink" href="#generate-initial-conditions" title="Permalink to this headline">¶</a></h3>
<p>Skip this for a tide-only run. Using user defined constant T and S.</p>
<dl class="docutils">
<dt>For constant T and S use the user defined functions in <code class="docutils literal"><span class="pre">$CDIR/$CONFIG/MY_SRC</span></code>:</dt>
<dd><code class="docutils literal"><span class="pre">usrdef_sbc.F90</span></code>  and <code class="docutils literal"><span class="pre">usrdef_istate.F90</span></code>.</dd>
</dl>
</div>
</div>
<div class="section" id="generate-a-domain-configuration-file">
<h2>4. Generate a domain configuration file<a class="headerlink" href="#generate-a-domain-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>The general idea is that you have to copy the <code class="docutils literal"><span class="pre">namelist_cfg</span></code> file into the <code class="docutils literal"><span class="pre">DOMAINcfg</span></code>
directory along with all the inputs files that would have previously been needed
get v3.6 running. The reason being that all the non-time stepping stuff, like
grid generating, has been abstracted from the core OPA code and is now done as
a pre-processing step, and output into an important file <code class="docutils literal"><span class="pre">domain_cfg.nc</span></code>.</p>
<p>Copy essential files into DOMAINcfg directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>rsync -uvt $INPUTS/coordinates.nc $TDIR/DOMAINcfg/.
rsync -uvt $INPUTS/bathy_meter.nc $TDIR/DOMAINcfg/.
</pre></div>
</div>
<p>Edit the template namelist_cfg with only the essenetial domain building stuff.
Get the indices from <code class="docutils literal"><span class="pre">ncdump</span> <span class="pre">-h</span> <span class="pre">coordinates.nc</span></code>.</p>
<p>When the increase in resolution was x3, the size of the coordinate were:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>jpidta      =    1624   !  1st lateral dimension ( &gt;= jpi )
jpjdta      =    1138   !  2nd    &quot;         &quot;    ( &gt;= jpj )
</pre></div>
</div>
<p>When the increase in resolution is x1, the size of the coordinates were:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>jpidta      =    544   !  1st lateral dimension ( &gt;= jpi )
jpjdta      =    382   !  2nd    &quot;         &quot;    ( &gt;= jpj )
</pre></div>
</div>
<p>Somewhat arbitrarily I am going to use <strong>31</strong> <code class="docutils literal"><span class="pre">(jpkdta=31;</span> <span class="pre">rn_jpk=31)</span></code> levels.
(Earlier I used 5 levels. This config gave me trouble. I&#8217;ve not revisited whether
the number of levels was a problem).</p>
<p>(didn&#8217;t work, though pehaps for reasons nothing to do with the coordinates...)</p>
<blockquote>
<div><p>(If I tried 5 levels then the function to compute the depth range breaks).
Added in s-coordinate settings from AMM60. (There is a function that tapers dz
near the equation. This is activated in <code class="docutils literal"><span class="pre">domzgr.F90</span></code> and not by a logical flag):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/DOMAINcfg
vi namelist_cfg

!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!! NEMO/OPA  Configuration namelist : used to overwrite defaults values defined in SHARED/namelist_ref
!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!
!-----------------------------------------------------------------------
&amp;namrun        !   parameters of the run
!-----------------------------------------------------------------------
   nn_no       =       0   !  job number (no more used...)
   cn_exp      =  &quot;domaincfg&quot;  !  experience name
   nn_it000    =       1   !  first time step
   nn_itend    =      75   !  last  time step (std 5475)
/
!-----------------------------------------------------------------------
&amp;namcfg        !   parameters of the configuration
!-----------------------------------------------------------------------
   !
   ln_e3_dep   = .false.   ! =T : e3=dk[depth] in discret sens.
   !                       !      ===&gt;&gt;&gt; will become the only possibility in v4.0
   !                       ! =F : e3 analytical derivative of depth function
   !                       !      only there for backward compatibility test with v3.6
   !                       !
   cp_cfg      =  &quot;orca&quot;   !  name of the configuration
   jp_cfg      =      12   !  resolution of the configuration
   jpidta      =     544   !  1st lateral dimension ( &gt;= jpi )
   jpjdta      =     382   !  2nd    &quot;         &quot;    ( &gt;= jpj )
   jpkdta      =      31   !  number of levels      ( &gt;= jpk )
   jpiglo      =     544   !  1st dimension of global domain --&gt; i =jpidta
   jpjglo      =     382   !  2nd    -                  -    --&gt; j  =jpjdta
   jpizoom     =       1   !  left bottom (i,j) indices of the zoom
   jpjzoom     =       1   !  in data domain indices
   jperio      =       0   !  lateral cond. type (between 0 and 6)
/
!-----------------------------------------------------------------------
&amp;namzgr        !   vertical coordinate
!-----------------------------------------------------------------------
  ln_zco      = .false.   !  z-coordinate - full    steps
  ln_zps      = .false.   !  z-coordinate - partial steps
  ln_sco      = .true.   !  s- or hybrid z-s-coordinate
  ln_isfcav   = .false.   !  ice shelf cavity
  ln_linssh   = .false.   !  linear free surface
/
!-----------------------------------------------------------------------
&amp;namzgr_sco    !   s-coordinate or hybrid z-s-coordinate
!-----------------------------------------------------------------------
  ln_s_sh94   = .false.    !  Song &amp; Haidvogel 1994 hybrid S-sigma   (T)|
  ln_s_sf12   = .true.   !  Siddorn &amp; Furner 2012 hybrid S-z-sigma (T)| if both are false the NEMO tanh stretching is applied
  ln_sigcrit  = .true.    !  use sigma coordinates below critical depth (T) or Z coordinates (F) for Siddorn &amp; Furner stretch
                          !  stretching coefficients for all functions
  rn_jpk      =   31       ! Number of S levels
  !ln_eq_taper = .false.   !  Tapering of S coords near equator
  cn_coord_hgr = &#39;coordinates.nc&#39;  ! File containing gphit (latitude) coordinate for use if ln_eq_taper=.true.
  rn_sbot_min =   10.0    !  minimum depth of s-bottom surface (&gt;0) (m)
  rn_sbot_max = 7000.0    !  maximum depth of s-bottom surface (= ocean depth) (&gt;0) (m)
  rn_hc       =   50.0    !  critical depth for transition to stretched coordinates
                       !!!!!!!  Envelop bathymetry
  rn_rmax     =    0.3    !  maximum cut-off r-value allowed (0&lt;r_max&lt;1)
                       !!!!!!!  SH94 stretching coefficients  (ln_s_sh94 = .true.)
  rn_theta    =    6.0    !  surface control parameter (0&lt;=theta&lt;=20)
  rn_bb       =    0.8    !  stretching with SH94 s-sigma
                       !!!!!!!  SF12 stretching coefficient  (ln_s_sf12 = .true.)
  rn_alpha    =    4.4    !  stretching with SF12 s-sigma
  rn_efold    =    0.0    !  efold length scale for transition to stretched coord
  rn_zs       =    1.0    !  depth of surface grid box
                          !  bottom cell depth (Zb) is a linear function of water depth Zb = H*a + b
  rn_zb_a     =    0.024  !  bathymetry scaling factor for calculating Zb
  rn_zb_b     =   -0.2    !  offset for calculating Zb
                       !!!!!!!! Other stretching (not SH94 or SF12) [also uses rn_theta above]
  rn_thetb    =    1.0    !  bottom control parameter  (0&lt;=thetb&lt;= 1)
/
</pre></div>
</div>
</div></blockquote>
<dl class="docutils">
<dt>::</dt>
<dd><p class="first">cd $TDIR/DOMAINcfg
vi namelist_cfg</p>
<p>!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!! NEMO/OPA  Configuration namelist : used to overwrite defaults values defined in SHARED/namelist_ref
!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
&amp;namrun        !   parameters of the run
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>nn_no       =       0   !  job number (no more used...)
cn_exp      =  &#8220;domaincfg&#8221;  !  experience name
nn_it000    =       1   !  first time step
nn_itend    =      75   !  last  time step (std 5475)</div></blockquote>
<p>/
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
&amp;namcfg        !   parameters of the configuration
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>!
ln_e3_dep   = .false.   ! =T : e3=dk[depth] in discret sens.
!                       !      ===&gt;&gt;&gt; will become the only possibility in v4.0
!                       ! =F : e3 analytical derivative of depth function
!                       !      only there for backward compatibility test with v3.6
!                       !
cp_cfg      =  &#8220;orca&#8221;   !  name of the configuration
jp_cfg      =      12   !  resolution of the configuration
jpidta      =     544   !  1st lateral dimension ( &gt;= jpi )
jpjdta      =     382   !  2nd    &#8221;         &#8221;    ( &gt;= jpj )
jpkdta      =      31   !  number of levels      ( &gt;= jpk )
jpiglo      =     544   !  1st dimension of global domain &#8211;&gt; i =jpidta
jpjglo      =     382   !  2nd    -                  -    &#8211;&gt; j  =jpjdta
jpizoom     =       1   !  left bottom (i,j) indices of the zoom
jpjzoom     =       1   !  in data domain indices
jperio      =       0   !  lateral cond. type (between 0 and 6)</div></blockquote>
<p>/
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
&amp;namzgr        !   vertical coordinate
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>ln_zco      = .false.   !  z-coordinate - full    steps
ln_zps      = .true.   !  z-coordinate - partial steps
ln_sco      = .false.   !  s- or hybrid z-s-coordinate
ln_isfcav   = .false.   !  ice shelf cavity
ln_linssh   = .false.   !  linear free surface</div></blockquote>
<p>/
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
&amp;namzgr_sco    !   s-coordinate or hybrid z-s-coordinate
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
/
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
&amp;namdom        !   space and time domain (bathymetry, mesh, timestep)
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>jphgr_msh   =       0               !  type of horizontal mesh
ppglam0     =  999999.0             !  longitude of first raw and column T-point (jphgr_msh = 1)
ppgphi0     =  999999.0             ! latitude  of first raw and column T-point (jphgr_msh = 1)
ppe1_deg    =  999999.0             !  zonal      grid-spacing (degrees)
ppe2_deg    =  999999.0             !  meridional grid-spacing (degrees)
ppe1_m      =  999999.0             !  zonal      grid-spacing (degrees)
ppe2_m      =  999999.0             !  meridional grid-spacing (degrees)
ppsur       =   -4762.96143546300   !  ORCA r4, r2 and r05 coefficients
ppa0        =     255.58049070440   ! (default coefficients)
ppa1        =     245.58132232490   !
ppkth       =      21.43336197938   !
ppacr       =       3.0             !
ppdzmin     =  999999.              !  Minimum vertical spacing
pphmax      =  999999.              !  Maximum depth
ldbletanh   =  .FALSE.              !  Use/do not use double tanf function for vertical coordinates
ppa2        =  999999.              !  Double tanh function parameters
ppkth2      =  999999.              !
ppacr2      =  999999.              !</div></blockquote>
<p class="last">/</p>
</dd>
</dl>
<hr class="docutils" />
<p>Build a script to run the executable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $TDIR/DOMAINcfg/rs

#!/bin/bash
#PBS -N domain_cfg
#PBS -l walltime=00:20:00
#PBS -l select=1
#PBS -j oe
#PBS -A n01-NOCL
# mail alert at (b)eginning, (e)nd and (a)bortion of execution
#PBS -m bea
#PBS -M jelt@noc.ac.uk
#! -----------------------------------------------------------------------------

# Change to the directory that the job was submitted from
cd $PBS_O_WORKDIR

# Set the number of threads to 1
#   This prevents any system libraries from automatically
#   using threading.
export OMP_NUM_THREADS=1
# Change to the directory that the job was submitted from
ulimit -s unlimited

#===============================================================
# LAUNCH JOB
#===============================================================
echo `date` : Launch Job
aprun -n 1 -N 1 ./make_domain_cfg.exe &gt;&amp;  stdouterr_cfg

exit
</pre></div>
</div>
<p>Try running it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/DOMAINcfg
qsub -q short rs
</pre></div>
</div>
<p>Put a copy of the namelist_cfg in $INPUTS for safe keeping:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $TDIR/DOMAINcfg/namelist_cfg $INPUTS/namelist_cfg_generateDOMAINcfg
</pre></div>
</div>
<dl class="docutils">
<dt>#Copy domain_cfg.nc to the EXP directory (also copy it to the INPUTS directory, which stores</dt>
<dd><p class="first">the bits and bobs for a rebuild):</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>rsync -uvt $TDIR/DOMAINcfg/domain_cfg.nc $EXP/.
rsync -uvt $TDIR/DOMAINcfg/domain_cfg.nc $INPUTS/.
</pre></div>
</div>
</dd>
</dl>
<div class="section" id="generate-weights-for-atm-forcing">
<h3>5. Generate weights for atm forcing<a class="headerlink" href="#generate-weights-for-atm-forcing" title="Permalink to this headline">¶</a></h3>
<p>Skip this for a tide-only simulation</p>
<p>&#8212;</p>
<p>THIS IS WHERE START WITH LIVLJOBS4 to create boundary files with PyNEMO
If all the files are ready to go jump straight to <a href="#id9"><span class="problematic" id="id10">`7. Generate boundary conditions with PyNEMO: Run PyNEMO`_</span></a></p>
<hr class="docutils" />
<p>Follow SEAsia notes <a href="#id11"><span class="problematic" id="id12">`SEAsia_archer_livljobs4.rst`_</span></a> for PyNEMO bit. Changing
instances of <cite>SEAsia</cite> for <cite>SWPacific</cite>.
Note a lot of the files are actually used for a tide-only simulation but it is not
trivial to prevent PyNEMO looking for them.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="set-up-directory-structure-and-files-in-livljobs4">
<h2>Set up directory structure and files in livljobs4<a class="headerlink" href="#set-up-directory-structure-and-files-in-livljobs4" title="Permalink to this headline">¶</a></h2>
<p>Define paths:</p>
<p>cat &gt; ~/temporary_path_names_for_NEMO_build &lt;&lt; EOL
export CONFIG=SWPacific
export WORK=/work
export WDIR=$WORK/$USER/NEMO/$CONFIG
export INPUTS=$WDIR/INPUTS
export START_FILES=$WDIR/START_FILES
#export CDIR=$WDIR/trunk_NEMOGCM_r8395/CONFIG
#export TDIR=$WDIR/trunk_NEMOGCM_r8395/TOOLS
#export EXP=$CDIR/$CONFIG/EXP00</p>
<p>EOL</p>
<p>Execute path settings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span> <span class="o">~/</span><span class="n">temporary_path_names_for_NEMO_build</span>
</pre></div>
</div>
<p>Synchronise with key files from ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>rsync -utv $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/bathy_meter.nc $INPUTS/.
rsync -utv $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/coordinates.nc $INPUTS/.
rsync -utv $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/domain_cfg.nc  $INPUTS/.
</pre></div>
</div>
</div>
<div class="section" id="statement-about-external-forcing-and-files">
<h2>Statement about external forcing and files<a class="headerlink" href="#statement-about-external-forcing-and-files" title="Permalink to this headline">¶</a></h2>
<p>Use ORCA 1/12 data via a thredds server. Also use ORCA 1/12 mesh and mask files.
(Originally tried to get them via a thredds server but gave up trying to figure
out how to write the NCML file).</p>
<blockquote>
<div><p>Copy necessary files into INPUTS. (Be careful of symbolic links in PyNEMO).:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ls -lh $INPUTS/bathy_meter.nc
ls -lh $INPUTS/coordinates.nc
ls -lh $INPUTS/domain_cfg.nc
</pre></div>
</div>
</div></blockquote>
<p>Need to generate 6 more files: A <code class="docutils literal"><span class="pre">namelist.bdy</span></code> (archived as <a href="#id13"><span class="problematic" id="id14">`SWPacific_namelist.bdy`_</span></a>)
which drives PyNEMO and which has two input files: <code class="docutils literal"><span class="pre">inputs_src.ncml</span></code>
which points to the remote ORCA data source and <code class="docutils literal"><span class="pre">inputs_dst.ncml</span></code> which
remaps some variable names in the destination files. Then generate ncml files
to get the mesh and mask files (<code class="docutils literal"><span class="pre">mask_src.ncml</span>&#160; <span class="pre">mesh_hgr_src.ncml</span>&#160; <span class="pre">mesh_zgr_src.ncml</span></code>).
<em>NB In the end I copied the source mesh and mask files locally. So obly need to
generate 3 files</em></p>
<p>Create ncml file for ORCA12 source data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi  $INPUTS/inputs_src.ncml

&lt;ns0:netcdf xmlns:ns0=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot; title=&quot;NEMO aggregation&quot;&gt;
&lt;ns0:aggregation type=&quot;union&quot;&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;temperature&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05T.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;salinity&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05T.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;zonal_velocity&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05U.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;meridian_velocity&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05V.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
  &lt;ns0:netcdf&gt;
    &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;sea_surface_height&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:netcdf location=&quot;http://gws-access.ceda.ac.uk/public/nemo/runs/ORCA0083-N01/means/1979/ORCA0083-N01_19791206d05T.nc&quot; /&gt;
    &lt;/ns0:aggregation&gt;
  &lt;/ns0:netcdf&gt;
&lt;/ns0:aggregation&gt;
&lt;/ns0:netcdf&gt;
</pre></div>
</div>
<p>Create NCML file for mapping variables in DESTINATION grid to what PyNEMO expects:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">inputs_dst</span><span class="o">.</span><span class="n">ncml</span>

<span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">ns0</span><span class="o">=</span><span class="s2">&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;NEMO aggregation&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;union&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:domain_cfg.nc&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mbathy&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;top_level&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;gdept&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;gdept_0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;gdepw&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;gdepw_0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e3u&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;e3u_0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e3v&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;e3v_0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Create a PyNEMO namelist.bdy file. Note this this is tides only and so z-coordinates
are OK as it is only 2D variables. I have archived a working version of this file
here <a href="#id15"><span class="problematic" id="id16">`SWPacific_namelist.bdy`_</span></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist.bdy

!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!! NEMO/OPA  : namelist for BDY generation tool
!!
!!             User inputs for generating open boundary conditions
!!             employed by the BDY module in NEMO. Boundary data
!!             can be set up for v3.2 NEMO and above.
!!
!!             More info here.....
!!
!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

!-----------------------------------------------------------------------
!   vertical coordinate
!-----------------------------------------------------------------------
   ln_zco      = .true.   !  z-coordinate - full    steps   (T/F)
   ln_zps      = .false.    !  z-coordinate - partial steps   (T/F)
   ln_sco      = .false.   !  s- or hybrid z-s-coordinate    (T/F)
   rn_hmin     =   -5     !  min depth of the ocean (&gt;0) or
                           !  min number of ocean level (&lt;0)

!-----------------------------------------------------------------------
!   s-coordinate or hybrid z-s-coordinate
!-----------------------------------------------------------------------
   rn_sbot_min =   10.     !  minimum depth of s-bottom surface (&gt;0) (m)
   rn_sbot_max = 7000.     !  maximum depth of s-bottom surface
                           !  (= ocean depth) (&gt;0) (m)
   ln_s_sigma  = .false.   !  hybrid s-sigma coordinates
   rn_hc       =  50.0    !  critical depth with s-sigma

!-----------------------------------------------------------------------
!  grid information
!-----------------------------------------------------------------------
   sn_src_hgr = &#39;./mesh_hgr_src.nc&#39;   !  parent /grid/
   sn_src_zgr = &#39;./mesh_zgr_src.nc&#39;   !  parent
   sn_dst_hgr = &#39;./domain_cfg.nc&#39;
   sn_dst_zgr = &#39;./inputs_dst.ncml&#39; ! rename output variables
   sn_src_msk = &#39;./mask_src.nc&#39;       ! parent
   sn_bathy   = &#39;./bathy_meter.nc&#39;

!-----------------------------------------------------------------------
!  I/O
!-----------------------------------------------------------------------
   sn_src_dir = &#39;./inputs_src.ncml&#39;       ! src_files/&#39;
   sn_dst_dir = &#39;/work/jelt/NEMO/SWPacific/INPUTS/&#39;
   sn_fn      = &#39;SWPacific&#39;                 ! prefix for output files
   nn_fv      = -1e20                     !  set fill value for output files
   nn_src_time_adj = 0                                    ! src time adjustment
   sn_dst_metainfo = &#39;metadata info: jelt&#39;

!-----------------------------------------------------------------------
!  unstructured open boundaries
!-----------------------------------------------------------------------
ln_coords_file = .true.               !  =T : produce bdy coordinates files
cn_coords_file = &#39;coordinates.bdy.nc&#39; !  name of bdy coordinates files (if ln_coords_file=.TRUE.)
ln_mask_file   = .true.              !  =T : read mask from file
cn_mask_file   = &#39;./bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
ln_dyn2d       = .false.               !  boundary conditions for barotropic fields
ln_dyn3d       = .false.               !  boundary conditions for baroclinic velocities
ln_tra         = .false.               !  boundary conditions for T and S
ln_ice         = .false.               !  ice boundary condition
nn_rimwidth    = 1                    !  width of the relaxation zone

!-----------------------------------------------------------------------
!  unstructured open boundaries tidal parameters
!-----------------------------------------------------------------------
ln_tide        = .true.               !  =T : produce bdy tidal conditions
clname(1)      = &#39;M2&#39;                 ! constituent name
clname(2)      = &#39;S2&#39;
clname(3)      = &#39;K2&#39;
ln_trans       = .false.
sn_tide_h     = &#39;/work/jelt/tpxo7.2/h_tpxo7.2.nc&#39;
sn_tide_u     = &#39;/work/jelt/tpxo7.2/u_tpxo7.2.nc&#39;

!-----------------------------------------------------------------------
!  Time information
!-----------------------------------------------------------------------
nn_year_000     = 1979        !  year start
nn_year_end     = 1979        !  year end
nn_month_000    = 11          !  month start (default = 1 is years&gt;1)
nn_month_end    = 11          !  month end (default = 12 is years&gt;1)
sn_dst_calendar = &#39;gregorian&#39; !  output calendar format
nn_base_year    = 1978        !  base year for time counter
sn_tide_grid    = &#39;/work/jelt/tpxo7.2/grid_tpxo7.2.nc&#39;

!-----------------------------------------------------------------------
!  Additional parameters
!-----------------------------------------------------------------------
nn_wei  = 1                   !  smoothing filter weights
rn_r0   = 0.041666666         !  decorrelation distance use in gauss
                              !  smoothing onto dst points. Need to
                              !  make this a funct. of dlon
sn_history  = &#39;bdy files produced by jelt from ORCA0083-N01&#39;
                              !  history for netcdf file
ln_nemo3p4  = .true.          !  else presume v3.2 or v3.3
nn_alpha    = 0               !  Euler rotation angle
nn_beta     = 0               !  Euler rotation angle
nn_gamma    = 0               !  Euler rotation angle
rn_mask_max_depth = 7000.0    !  Maximum depth to be ignored for the mask
rn_mask_shelfbreak_dist = 60    !  Distance from the shelf break
</pre></div>
</div>
<p>Tried to put the mesh and mask files as remote access via ncml files. Failed, so
downloaded them instead. (Perhaps the mesh and mask variables could all go in
the inputs_src.ncml ?)...</p>
<p>Finally I am going to create a boundary mask file. This can also be done with
the PyNEMO GUI. The mask variable takes values (-1 mask, 1 wet, 0 land). Get a
template from domain_cfg.nc and then modify as desired around the boundary:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">nco</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">4.4</span><span class="o">.</span><span class="mf">2.</span><span class="n">ncwa</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">bdy_mask</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncks</span> <span class="o">-</span><span class="n">v</span> <span class="n">top_level</span> <span class="n">domain_cfg</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncrename</span> <span class="o">-</span><span class="n">h</span> <span class="o">-</span><span class="n">v</span> <span class="n">top_level</span><span class="p">,</span><span class="n">mask</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncwa</span> <span class="o">-</span><span class="n">a</span> <span class="n">t</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">nc</span> <span class="n">bdy_mask</span><span class="o">.</span><span class="n">nc</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>In ipython:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="n">dset</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="s1">&#39;bdy_mask.nc&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">,:]</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>     <span class="c1"># Southern boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>    <span class="c1"># Northern boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>    <span class="c1"># Eastern boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>        <span class="c1"># Western boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="run-pynemo-nrct-to-generate-boundary-conditions">
<h3>Run PyNEMO / NRCT to generate boundary conditions<a class="headerlink" href="#run-pynemo-nrct-to-generate-boundary-conditions" title="Permalink to this headline">¶</a></h3>
<p>First install PyNEMO <a href="#id17"><span class="problematic" id="id18">`install_nrct`_</span></a> if not already done so.</p>
<p>Generate the boundary conditions with PyNEMO</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module load anaconda/2.1.0  # Want python2
source activate nrct_env
cd $INPUTS
export LD_LIBRARY_PATH=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64/lib/amd64/server:$LD_LIBRARY_PATH

pynemo -s namelist.bdy
</pre></div>
</div>
<p>&#8212;</p>
<dl class="docutils">
<dt>(By the time it crashes on some 3D stuff I am not interested in) this has already</dt>
<dd><p class="first">generated what I need:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>ls -1 $INPUTS

coordinates.bdy.nc
SWPacific_bdytide_rotT_M2_grid_T.nc
SWPacific_bdytide_rotT_K2_grid_T.nc
SWPacific_bdytide_rotT_S2_grid_T.nc
SWPacific_bdytide_rotT_M2_grid_U.nc
SWPacific_bdytide_rotT_K2_grid_U.nc
SWPacific_bdytide_rotT_S2_grid_U.nc
SWPacific_bdytide_rotT_M2_grid_V.nc
SWPacific_bdytide_rotT_K2_grid_V.nc
SWPacific_bdytide_rotT_S2_grid_V.nc
</pre></div>
</div>
</dd>
</dl>
<p>Copy the new files back onto ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4$
cd $INPUTS
rsync -utv coordinates.bdy.nc $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/coordinates.bdy.nc
for file in $CONFIG*nc; do rsync -utv $file $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/$file ; done
</pre></div>
</div>
</div>
<div class="section" id="run-the-configuration-on-archer-turn-on-the-tides">
<h3>8. Run the configuration ON ARCHER. Turn on the tides<a class="headerlink" href="#run-the-configuration-on-archer-turn-on-the-tides" title="Permalink to this headline">¶</a></h3>
<p>Get set up:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">archer</span>
<span class="o">.</span> <span class="o">~/</span><span class="n">temporary_path_names_for_NEMO_build</span>
</pre></div>
</div>
<p>Get important files into EXP directory. Should already have <code class="docutils literal"><span class="pre">domain_cfg.nc</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP
rsync -tuv $INPUTS/bathy_meter.nc $EXP/.
rsync -tuv $INPUTS/coordinates.nc $EXP/.
rsync -tuv $INPUTS/coordinates.bdy.nc $EXP/.
rsync -tuv $START_FILES/namelist_cfg $EXP/.
</pre></div>
</div>
<p>Create symbolic links from EXP directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s $INPUTS $EXP/bdydta
</pre></div>
</div>
<p>Edit the output to have 1hrly SSH:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi file_def_nemo.xml
...
&lt;file_group id=&quot;1h&quot; output_freq=&quot;1h&quot;  output_level=&quot;10&quot; enabled=&quot;.TRUE.&quot;&gt; &lt;!-- 1h files --&gt;
 &lt;file id=&quot;file19&quot; name_suffix=&quot;_SSH&quot; description=&quot;ocean T grid variables&quot; &gt;
   &lt;field field_ref=&quot;ssh&quot;          name=&quot;zos&quot;   /&gt;
 &lt;/file&gt;
&lt;/file_group&gt;
</pre></div>
</div>
<p>&#8212;</p>
<p>Create a short queue runscript. (Note: PBS -N jobname, PBS -m email):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi runscript

#!/bin/bash
#PBS -N SWPacific
#PBS -l select=5
#PBS -l walltime=00:20:00
#PBS -A n01-NOCL
# mail alert at (b)eginning, (e)nd and (a)bortion of execution
#PBS -m bea
#PBS -M jelt@noc.ac.uk

module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel
module load cray-hdf5-parallel

export PBS_O_WORKDIR=$(readlink -f $PBS_O_WORKDIR)
#  echo $(readlink -f $PBS_O_WORKDIR)
# export OMP_NUM_THREADS=1

cd $PBS_O_WORKDIR
#
  echo &quot; &quot;;
  OCEANCORES=96
ulimit -c unlimited
ulimit -s unlimited

rm -f core
aprun -b -n 5 -N 5 ./xios_server.exe : -n $OCEANCORES -N 24 ./opa

exit
</pre></div>
</div>
<p>&#8212;</p>
<p>Edit <code class="docutils literal"><span class="pre">namelist_cfg</span></code> to make sure it is OK</p>
<p>Synchronise the namelist_cfg with the GitLab repo. (This is also done at the end
of this repo):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">rsync</span> <span class="o">-</span><span class="n">uvt</span> <span class="n">jelt</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">SWPacific</span><span class="o">/</span><span class="n">trunk_NEMOGCM_r8395</span><span class="o">/</span><span class="n">CONFIG</span><span class="o">/</span><span class="n">SWPacific</span><span class="o">/</span><span class="n">EXP00</span><span class="o">/</span><span class="n">namelist_cfg</span> <span class="n">SWPacific_EXP_namelist_cfg</span>
</pre></div>
</div>
<p>&#8212;</p>
<p>Submit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP
qsub -q short runscript
</pre></div>
</div>
<p>Iterative debugging process. Configuration blew up around the boundary
E.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">stp_ctl</span> <span class="p">:</span> <span class="n">the</span> <span class="n">ssh</span> <span class="ow">is</span> <span class="n">larger</span> <span class="n">than</span> <span class="mi">10</span><span class="n">m</span>
<span class="o">=======</span>
<span class="n">kt</span><span class="o">=</span>   <span class="mi">410</span> <span class="nb">max</span> <span class="n">ssh</span><span class="p">:</span>   <span class="mf">10.08</span>    <span class="p">,</span> <span class="n">i</span> <span class="n">j</span><span class="p">:</span>   <span class="mi">446</span>   <span class="mi">11</span>

<span class="n">stp_ctl</span> <span class="p">:</span> <span class="n">the</span> <span class="n">ssh</span> <span class="ow">is</span> <span class="n">larger</span> <span class="n">than</span> <span class="mi">10</span><span class="n">m</span>
<span class="o">=======</span>
<span class="n">kt</span><span class="o">=</span>   <span class="mi">101</span> <span class="nb">max</span> <span class="n">ssh</span><span class="p">:</span>   <span class="mf">10.32</span>    <span class="p">,</span> <span class="n">i</span> <span class="n">j</span><span class="p">:</span>   <span class="mi">172</span>    <span class="mi">4</span>

<span class="n">stpctl</span><span class="p">:</span> <span class="n">the</span> <span class="n">zonal</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="n">larger</span> <span class="n">than</span> <span class="mi">20</span> <span class="n">m</span><span class="o">/</span><span class="n">s</span>
<span class="o">======</span>
<span class="n">kt</span><span class="o">=</span>  <span class="mi">6374</span> <span class="nb">max</span> <span class="nb">abs</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>   <span class="mf">21.05</span>    <span class="p">,</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="p">:</span>   <span class="mi">542</span>   <span class="mi">57</span>   <span class="mi">30</span>

<span class="n">stpctl</span><span class="p">:</span> <span class="n">the</span> <span class="n">zonal</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="n">larger</span> <span class="n">than</span> <span class="mi">20</span> <span class="n">m</span><span class="o">/</span><span class="n">s</span>
<span class="o">======</span>
<span class="n">kt</span><span class="o">=</span>  <span class="mi">6209</span> <span class="nb">max</span> <span class="nb">abs</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>   <span class="mf">23.41</span>    <span class="p">,</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="p">:</span>   <span class="mi">532</span>  <span class="mi">379</span>   <span class="mi">10</span>
</pre></div>
</div>
<p>Edit the bdy_mask.nc file to blank out (-1) the edges with problems. (I blanked them
out preserving a rectangular grid. This may not be necessary). Rerun PyNEMO to
generate new boundary forcing.</p>
<p>In the end I ran with <code class="docutils literal"><span class="pre">rn_rdt=360</span></code> (6 minutes). I also played with the number of
processors used to do the XIOS, but I am not sure that it did anything to speed up
the simulation. (Changed from <code class="docutils literal"><span class="pre">-n</span> <span class="pre">5</span> <span class="pre">-N</span> <span class="pre">5</span></code> to <code class="docutils literal"><span class="pre">-n</span> <span class="pre">20</span> <span class="pre">-N</span> <span class="pre">20</span></code>).</p>
<p>I was able to run 20 days in 17 mins on the short queue.</p>
<p>Then optimising the MPI decomposition (93 processors - saving 3 from land). Competed
in 18 mins:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">aprun</span> <span class="o">-</span><span class="n">b</span> <span class="o">-</span><span class="n">n</span> <span class="mi">20</span> <span class="o">-</span><span class="n">N</span> <span class="mi">20</span> <span class="o">./</span><span class="n">xios_server</span><span class="o">.</span><span class="n">exe</span> <span class="p">:</span> <span class="o">-</span><span class="n">n</span> <span class="mi">93</span> <span class="o">-</span><span class="n">N</span> <span class="mi">24</span> <span class="o">./</span><span class="n">opa</span>
</pre></div>
</div>
</div>
<div class="section" id="mpp-decomposition-for-land-suppression">
<h3>MPP decomposition for land suppression<a class="headerlink" href="#mpp-decomposition-for-land-suppression" title="Permalink to this headline">¶</a></h3>
<p><a href="#id19"><span class="problematic" id="id20">`MPP_decomp_lanf_suppression.rst`_</span></a></p>
<dl class="docutils">
<dt>Before doing long runs it is important to optimise MPP decompositoin by invoking</dt>
<dd>land supression to save redundant ocean processors.</dd>
</dl>
<p>Resulting decomposition:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg
...
!-----------------------------------------------------------------------
&amp;nammpp        !   Massively Parallel Processing                        (&quot;key_mpp_mpi)
!-----------------------------------------------------------------------
   ...
   jpni        =  12       !  jpni   number of processors following i (set automatically if &lt; 1)
   jpnj        =  8    !  jpnj   number of processors following j (set automatically if &lt; 1)
   jpnij       =  1    !  jpnij  number of local domains (set automatically if &lt; 1)
</pre></div>
</div>
<p>Inspect <code class="docutils literal"><span class="pre">ocean_output</span></code> to find <code class="docutils literal"><span class="pre">jpnij</span></code>. In my simulation <code class="docutils literal"><span class="pre">jpni=8,</span> <span class="pre">jpnj=12</span> <span class="pre">--&gt;</span> <span class="pre">jpnij</span> <span class="pre">=</span> <span class="pre">93</span></code>
Update OCEANCORES in runscript (make sure the <code class="docutils literal"><span class="pre">aprun</span></code> statement is as expected too):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">runscript</span>
<span class="o">...</span>
<span class="n">OCEANCORES</span><span class="o">=</span><span class="mi">93</span>
</pre></div>
</div>
<p>And submit again.</p>
</div>
<div class="section" id="restart-run">
<h3>Restart run<a class="headerlink" href="#restart-run" title="Permalink to this headline">¶</a></h3>
<p>Rebuild restart file <a href="#id21"><span class="problematic" id="id22">`rebuild_and_inspect_NEMO_output.rst`_</span></a>
Modify the namelist_cfg file for a restart (also doubled number of steps to 9600).
Using nn_restctl = 2 don&#8217;t have to be too careful about dates in the namelist_cfg
as it comes from the restart file instead. (Though it seems to throw an error if
you get a mismatch between namelist and restart dates..)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg
...
nn_it000    =  14401   !  first time step
nn_itend    =  19200 ! 10day=14400   !  last  time step (std 5475)
nn_date0    =  20000302   !  date at nit_0000 (format yyyymmdd) used if ln_rstart=F or (ln_rstart=T and nn_rstctl=0 or 1)
ln_rstart   = .true.   !  start from rest (F) or from a restart file (T)
...
 nn_rstctl   =    2            !  restart control ==&gt; activated only if ln_rstart=T
 !                             !    = 2 nn_date0 read in restart  ; nn_it000 : check consistancy between namelist and restart
...
cn_ocerst_in    = &quot;SWPacific_00014400_restart_tide&quot;   !  suffix of ocean restart name (input)


!-----------------------------------------------------------------------
&amp;nam_diaharm   !   Harmonic analysis of tidal constituents               (&quot;key_diaharm&quot;)
!-----------------------------------------------------------------------
    nit000_han = 4801         ! First time step used for harmonic analysis
    nitend_han = 14400 ! 7200      ! Last time step used for harmonic analysis
    nstep_han  = 1        ! Time step frequency for harmonic analysis
    tname(1)   = &#39;M2&#39;      ! Name of tidal constituents
    ...
</pre></div>
</div>
<p>Double the wall time in <code class="docutils literal"><span class="pre">runscript</span></code> (40mins) and submit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="n">runscript</span>
</pre></div>
</div>
<p>&#8212;</p>
</div>
</div>
<div class="section" id="backup-to-repo-key-files">
<h2>Backup to repo key files<a class="headerlink" href="#backup-to-repo-key-files" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">GitLab</span><span class="o">/</span><span class="n">NEMO</span><span class="o">-</span><span class="n">RELOC</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">source</span>
<span class="c1"># DOMANcfg namelist_cfg for domain_cfg.nc (for s-coordinates)</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">utv</span> <span class="n">jelt</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">SWPacific</span><span class="o">/</span><span class="n">trunk_NEMOGCM_r8395</span><span class="o">/</span><span class="n">TOOLS</span><span class="o">/</span><span class="n">DOMAINcfg</span><span class="o">/</span><span class="n">namelist_cfg</span> <span class="n">SWPacific_DOMAINcfg_namelist_cfg</span>

<span class="c1"># EXP namelist_cfg (for s-coordinates)</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">uvt</span> <span class="n">jelt</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">SWPacific</span><span class="o">/</span><span class="n">trunk_NEMOGCM_r8395</span><span class="o">/</span><span class="n">CONFIG</span><span class="o">/</span><span class="n">SWPacific</span><span class="o">/</span><span class="n">EXP00</span><span class="o">/</span><span class="n">namelist_cfg</span> <span class="n">SWPacific_EXP_namelist_cfg</span>

<span class="c1"># PyNEMO namelist.bdy (for s-coordinates)</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">utv</span> <span class="n">jelt</span><span class="nd">@livljobs4</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">NEMO</span><span class="o">/</span><span class="n">SWPacific</span><span class="o">/</span><span class="n">INPUTS</span><span class="o">/</span><span class="n">namelist</span><span class="o">.</span><span class="n">bdy</span> <span class="n">SWPacific_namelist</span><span class="o">.</span><span class="n">bdy</span>

<span class="c1"># Python quick plot of SSH in the output.abort.nc file</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">uvt</span> <span class="n">jelt</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">SWPacific</span><span class="o">/</span><span class="n">trunk_NEMOGCM_r8395</span><span class="o">/</span><span class="n">CONFIG</span><span class="o">/</span><span class="n">SWPacific</span><span class="o">/</span><span class="n">EXP00</span><span class="o">/</span><span class="n">quickplotNEMO</span><span class="o">.</span><span class="n">py</span> <span class="n">quickplotNEMO</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Setting up a SW Pacific NEMO v4 configuration</a><ul>
<li><a class="reference internal" href="#issues-that-arose">Issues that arose</a></li>
<li><a class="reference internal" href="#recipe-notes">Recipe Notes</a></li>
<li><a class="reference internal" href="#collect-essential-files">Collect essential files</a></li>
<li><a class="reference internal" href="#build-tools">Build TOOLS</a><ul>
<li><a class="reference internal" href="#generate-new-coordinates-file">1. Generate new coordinates file</a></li>
<li><a class="reference internal" href="#generate-bathymetry-file">2. Generate bathymetry file</a></li>
<li><a class="reference internal" href="#generate-initial-conditions">3. Generate initial conditions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generate-a-domain-configuration-file">4. Generate a domain configuration file</a><ul>
<li><a class="reference internal" href="#generate-weights-for-atm-forcing">5. Generate weights for atm forcing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#set-up-directory-structure-and-files-in-livljobs4">Set up directory structure and files in livljobs4</a></li>
<li><a class="reference internal" href="#statement-about-external-forcing-and-files">Statement about external forcing and files</a><ul>
<li><a class="reference internal" href="#run-pynemo-nrct-to-generate-boundary-conditions">Run PyNEMO / NRCT to generate boundary conditions</a></li>
<li><a class="reference internal" href="#run-the-configuration-on-archer-turn-on-the-tides">8. Run the configuration ON ARCHER. Turn on the tides</a></li>
<li><a class="reference internal" href="#mpp-decomposition-for-land-suppression">MPP decomposition for land suppression</a></li>
<li><a class="reference internal" href="#restart-run">Restart run</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backup-to-repo-key-files">Backup to repo key files</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/SWPacific_archer_livljobs4.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, NOC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/SWPacific_archer_livljobs4.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>