<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Setting up a Liverpool Bay NEMO v4 configuration &#8212; NEMO-RELOC 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="NEMO-RELOC 0.1 documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="setting-up-a-liverpool-bay-nemo-v4-configuration">
<h1>Setting up a Liverpool Bay NEMO v4 configuration<a class="headerlink" href="#setting-up-a-liverpool-bay-nemo-v4-configuration" title="Permalink to this headline">¶</a></h1>
<p>Machines: livljobs4, ARCHER</p>
<p>URL:: <a class="reference external" href="http://nemo-reloc.readthedocs.io/en/latest/LBay_livljobs4.html">http://nemo-reloc.readthedocs.io/en/latest/LBay_livljobs4.html</a>
<em>Actually I&#8217;ve taken this off readthedocs as it is internal. However writing in</em>
<em>ReStrucTed text means it is trivial to deploy anywhere with whatever style</em></p>
<ul class="simple">
<li>Build notes with:: ~/GitLab/NEMO-RELOC/docs$ make html</li>
</ul>
<p>This builds a Liverpool Bay regional tide model using GEBCO bathymetry, NNA tidal
boundaries and TPXO tides.</p>
<p>Originally tried building everything on ARCHER but ran into a java problem with
NRCT (nee PyNEMO) that they needed to fix. Also MDP can&#8217;t use ARCHER.</p>
<dl class="docutils">
<dt>Then got it working on a combination of Liverpool machines for setup with</dt>
<dd>simulations on ARCHER.</dd>
</dl>
<p>This recipe is updated to use the pre-release of NEMOv4, which in
particular has a new method for handling the domain configuration. For this I use
the ORCHESTRA realease of the trunk (&#64;r8395)</p>
<p>The summary procedure:
#. ARCHER: Get code. Build tools. Generate coordinates, bathymetry, domain_cfg.nc
#. ARCHER: Generate initial conditions and atmospheric forcings
#. LIVLJOBS4: Generate boundary conditions with NRCT/PyNEMO
#. ARCHER: Run simulation</p>
<p>The actual simulation does not switch on T,S boundaries, or inital conditions,
or met forcing. It is a tide only run. Though much (all) of the machinary for met
and T,S are all here.</p>
<div class="section" id="issues-that-arose">
<h2>Issues that arose<a class="headerlink" href="#issues-that-arose" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>PyNEMO doesn&#8217;t yet deal with sigma parent grids.</li>
<li>PyNEMO needs a gdept function. DOMAINcfg (will) only store e3t.</li>
</ul>
<p>Other related recipes (all NEMOv3.6):
Follow PyNEMO recipe for Lighthouse Reef: <code class="docutils literal"><span class="pre">http://pynemo.readthedocs.io/en/latest/examples.html#example-2-lighthouse-reef</span></code>
Follow PyNEMO recipe for Lighthouse Reef: <code class="docutils literal"><span class="pre">http://nemo-reloc.readthedocs.io/en/latest/SEAsia.html</span></code>
Follow PyNEMO recipe for LBay on ARCHER (not complete because PyNEMO java issue): <code class="docutils literal"><span class="pre">http://nemo-reloc.readthedocs.io/en/latest/LBay.html</span></code>.
(Perhaps this other note is superceded by this present one, though the other
note includes information of using PyNEMO with different data sources).</p>
</div>
<hr class="docutils" />
<div class="section" id="recipe-notes">
<h2>Recipe Notes<a class="headerlink" href="#recipe-notes" title="Permalink to this headline">¶</a></h2>
<p>In the following I build most stuff on ARCHER but the PyNEMO bits are done on livljobs4.
(There was a problem with some java bits working on ARCHER)
Starting on ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ssh login.archer.ac.uk

export CONFIG=LBay
export WORK=/work/n01/n01
export WDIR=$WORK/$USER/$CONFIG
export INPUTS=$WDIR/INPUTS
export START_FILES=$WDIR/START_FILES
export CDIR=$WDIR/trunk_NEMOGCM_r8395/CONFIG
export TDIR=$WDIR/trunk_NEMOGCM_r8395/TOOLS
export OLD_TDIR=$WDIR/dev_r4621_NOC4_BDY_VERT_INTERP/NEMOGCM/TOOLS/
export EXP=$CDIR/$CONFIG/EXP00


module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel cray-hdf5-parallel

export JINPUTS=/work/n01/n01/jdha/2017/INPUTS/ODA/E-AFRICA
export JEXP=/work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ODA_E-AFRICA/EXP00/
export OCDIR=/work/n01/n01/jelt/LBay/dev_r4621_NOC4_BDY_VERT_INTERP/NEMOGCM/CONFIG/
</pre></div>
</div>
<p>&#8212;</p>
<p>Checkout and build XIOS2 &#64; r1080 <a href="#id5"><span class="problematic" id="id6">`build_XIOS2.html`_</span></a>:</p>
<p>Or just link XIOS executable to the EXP directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s  /work/n01/n01/$USER/xios-2.0_r1080/bin/xios_server.exe $EXP/xios_server.exe
</pre></div>
</div>
<p>&#8212;</p>
<p>Checkout and build NEMO (ORCHESTRA) trunk &#64; r8395 <a href="#id7"><span class="problematic" id="id8">`build_opa_orchestra.html`_</span></a>.
Or just build:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR
./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="build-tools">
<h2>Build TOOLS<a class="headerlink" href="#build-tools" title="Permalink to this headline">¶</a></h2>
<p>To generate bathymetry, initial conditions and grid information we first need
to compile some of the NEMO TOOLS. NB for some reason GRIDGEN doesn’t like INTEL</p>
<p>First build DOMAINcfg (which is relatively new and in NEMOv4). Use my XIOS1 file
(see userid and path in variable <code class="docutils literal"><span class="pre">%XIOS_HOME</span></code>). Copy from ARCH <em>store</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $WORK/$USER/ARCH/arch-XC_ARCHER_INTEL_XIOS1.fcm $CDIR/../ARCH/.
cd $TDIR

./maketools -m XC_ARCHER_INTEL_XIOS1 -n DOMAINcfg
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">maketools</span> <span class="o">-</span><span class="n">n</span> <span class="n">WEIGHTS</span> <span class="o">-</span><span class="n">m</span> <span class="n">XC_ARCHER_INTEL_XIOS1</span>
<span class="o">./</span><span class="n">maketools</span> <span class="o">-</span><span class="n">n</span> <span class="n">REBUILD_NEMO</span> <span class="o">-</span><span class="n">m</span> <span class="n">XC_ARCHER_INTEL_XIOS1</span>
</pre></div>
</div>
<p>Actually we don&#8217;t do use GRIDGEN anymore::
..</p>
<blockquote>
<div><p>module unload cray-netcdf-hdf5parallel cray-hdf5-parallel
module swap PrgEnv-intel PrgEnv-cray
module load cray-netcdf cray-hdf5
./maketools -n GRIDGEN -m XC_ARCHER    # This uses acc&#8217;s XIOS_r474</p>
<p>module unload cray-netcdf cray-hdf5
module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel cray-hdf5-parallel</p>
</div></blockquote>
<div class="section" id="generate-new-coordinates-file">
<h3>1. Generate new coordinates file<a class="headerlink" href="#generate-new-coordinates-file" title="Permalink to this headline">¶</a></h3>
<p>Generate a <code class="docutils literal"><span class="pre">coordinates.nc</span></code> file from a parent NEMO grid at some resolution.
<strong>Plan:</strong> Use tool <code class="docutils literal"><span class="pre">agrif_create_coordinates.exe</span></code> which reads cutting indices and
parent grid location from <code class="docutils literal"><span class="pre">namelist.input</span></code> and outputs a new files with new
resolution grid elements.</p>
<p>Build and execute agrif version of create_coordinates.exe.
See <a href="#id9"><span class="problematic" id="id10">`build_and_create_coordinates.rst`_</span></a></p>
<p>This creates a new coordinatesfile with contents, which is now copied to
INPUTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp 1_coordinates_ORCA_R12.nc $INPUTS/coordinates.nc
</pre></div>
</div>
<p>Now we need to generate a bathymetry on this new grid.</p>
</div>
<div class="section" id="generate-bathymetry-file">
<h3>2. Generate bathymetry file<a class="headerlink" href="#generate-bathymetry-file" title="Permalink to this headline">¶</a></h3>
<p>Download some GEBCO data and copy to ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">~/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">RN</span><span class="o">-</span><span class="mi">5922</span><span class="n">_1488296787410</span><span class="o">/</span><span class="n">GEBCO_2014_2D_</span><span class="o">-</span><span class="mf">4.7361</span><span class="n">_53</span><span class="o">.</span><span class="mi">0299</span><span class="n">_</span><span class="o">-</span><span class="mf">2.5941</span><span class="n">_54</span><span class="o">.</span><span class="mf">4256.</span><span class="n">nc</span> <span class="n">jelt</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="p">:</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">LBay</span><span class="o">/</span><span class="n">INPUTS</span><span class="o">/.</span>
</pre></div>
</div>
<p>Copy namelist for reshaping GEBCO data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $INPUTS/namelist_reshape_bilin_gebco $WDIR/INPUTS/.
</pre></div>
</div>
<dl class="docutils">
<dt>Edit namelist to point to correct input file. Edit lat and lon variable names to</dt>
<dd>make sure they match the nc file content (used e.g.</dd>
</dl>
<p><code class="docutils literal"><span class="pre">ncdump</span> <span class="pre">-h</span> <span class="pre">GEBCO_2014_2D_-4.7361_53.0299_-2.5941_54.4256.nc</span></code> to get input
variable names):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $WDIR/INPUTS/namelist_reshape_bilin_gebco
...
&amp;grid_inputs
  input_file = &#39;gebco_in.nc&#39;
  nemo_file = &#39;coordinates.nc&#39;
  ...
  input_lon = &#39;lon&#39;
  input_lat = &#39;lat&#39;
  nemo_lon = &#39;glamt&#39;
  nemo_lat = &#39;gphit&#39;
  ...

  &amp;interp_inputs
  input_file = &quot;gebco_in.nc&quot;
  ...
  input_name = &quot;elevation&quot;
</pre></div>
</div>
<p>Do some things to 1) flatten out land elevations, 2) make depths positive. <em>(James
noted a problem with the default nco module)</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $WDIR/INPUTS
module load nco/4.5.0
ncap2 -s &#39;where(elevation &gt; 0) elevation=0&#39; GEBCO_2014_2D_-4.7361_53.0299_-2.5941_54.4256.nc tmp.nc
ncflint --fix_rec_crd -w -1.0,0.0 tmp.nc tmp.nc gebco_in.nc
rm tmp.nc
</pre></div>
</div>
<p>Restore the original parallel modules, which were removed to fix tool building issue:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">unload</span> <span class="n">nco</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span><span class="o">-</span><span class="n">hdf5parallel</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span>
</pre></div>
</div>
<p>Execute first scrip thing (use old tools - already compiled):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">remap_nemo_grid_gebco</span><span class="o">.</span><span class="n">nc</span>
<span class="n">remap_data_grid_gebco</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Execute second scip thing (use old tools - already compiled):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">data_nemo_bilin_gebco</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Execute third scip thing (use old tools - already compiled):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scripinterp.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bathy_meter</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
</div>
<div class="section" id="generate-initial-conditions">
<h3>3. Generate initial conditions<a class="headerlink" href="#generate-initial-conditions" title="Permalink to this headline">¶</a></h3>
<p>Copy <code class="docutils literal"><span class="pre">make.macro</span></code> file and edit the path if necessary::
<strong>FIX</strong> to the notes (copied from jdha instead): <code class="docutils literal"><span class="pre">cp</span> <span class="pre">$WDIR/INPUTS/make.macro</span> <span class="pre">./</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jdha</span><span class="o">/</span><span class="n">sosie</span><span class="o">/</span><span class="n">make</span><span class="o">.</span><span class="n">macro</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">sosie</span><span class="o">/.</span>

<span class="n">vi</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">sosie</span><span class="o">/</span><span class="n">make</span><span class="o">.</span><span class="n">macro</span>
<span class="c1"># Directory to install binaries:</span>
<span class="n">INSTALL_DIR</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">n01</span><span class="o">/</span><span class="n">jelt</span><span class="o">/</span><span class="n">local</span>
</pre></div>
</div>
<p>Proceed with Step 6 (of Lighhouse Reef Readthedocs):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd ~
mkdir local
svn co svn://svn.code.sf.net/p/sosie/code/trunk sosie
cd sosie

make
make install
export PATH=~/local/bin:$PATH
cd $WDIR/INPUTS
</pre></div>
</div>
<p>Obtain the fields to interpolate. Interpolate AMM60
data. Get the namelists:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/initcd_votemper.namelist $INPUTS/.
cp $START_FILES/initcd_vosaline.namelist $INPUTS/.
</pre></div>
</div>
<p>Generate the actual files. Cut them out of something bigger. Use the same indices
as used in coordinates.nc (note that the nco tools don&#8217;t like the
parallel modules):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----</span>
</pre></div>
</div>
<p><em>(3 March 2017)</em>
Insert new method to use AMM60 data for initial conditions.
/work/n01/n01/kariho40/NEMO/NEMOGCM_jdha/dev_r4621_NOC4_BDY_VERT_INTERP/NEMOGCM/CONFIG/AMM60smago/EXP_notradiff/OUTPUT
AMM60_5d_20131013_20131129_grid_T.nc</p>
<p>Find the AMM60 indices using FERRET on the bathy_meter.nc file: <code class="docutils literal"><span class="pre">shade</span> <span class="pre">log(Bathymetry[I=540:750,</span> <span class="pre">J=520:820])</span></code></p>
<p>Note that the temperature and salinity variables are <code class="docutils literal"><span class="pre">thetao</span></code> and <code class="docutils literal"><span class="pre">so</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module unload cray-netcdf-hdf5parallel cray-hdf5-parallel
module load cray-netcdf cray-hdf5
module load nco/4.5.0
cd $INPUTS

ncks -d x,560,620 -d y,720,800 /work/n01/n01/kariho40/NEMO/NEMOGCM_jdha/dev_r4621_NOC4_BDY_VERT_INTERP/NEMOGCM/CONFIG/AMM60smago/EXP_notradiff/OUTPUT/AMM60_5d_20131013_20131129_grid_T.nc $INPUTS/cut_down_20131013_LBay_grid_T.nc
</pre></div>
</div>
<p>Average over time and restore the parallel modules:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ncwa -a time_counter $START_FILES/cut_down_20131013_LBay_grid_T.nc  $INPUTS/cut_down_201310_LBay_grid_T.nc

module unload nco cray-netcdf cray-hdf5
module load cray-netcdf-hdf5parallel cray-hdf5-parallel
</pre></div>
</div>
<p>Edit namelists:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">initcd_votemper</span><span class="o">.</span><span class="n">namelist</span>
<span class="n">cf_in</span>     <span class="o">=</span> <span class="s1">&#39;cut_down_201310_LBay_grid_T.nc&#39;</span>
<span class="n">cv_in</span>     <span class="o">=</span> <span class="s1">&#39;thetao&#39;</span>
<span class="n">cf_x_in</span>   <span class="o">=</span> <span class="s1">&#39;cut_down_201310_LBay_grid_T.nc&#39;</span>
<span class="n">cv_out</span>   <span class="o">=</span> <span class="s1">&#39;thetao&#39;</span>
<span class="n">csource</span>  <span class="o">=</span> <span class="s1">&#39;AMM60&#39;</span>
<span class="n">ctarget</span>  <span class="o">=</span> <span class="s1">&#39;LBay&#39;</span>

<span class="n">vi</span> <span class="n">initcd_vosaline</span><span class="o">.</span><span class="n">namelist</span>
<span class="o">...</span>
<span class="n">cv_out</span>   <span class="o">=</span> <span class="s1">&#39;so&#39;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Do stuff. I think the intention was for SOSIE to flood fill the land:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sosie</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span><span class="n">f</span> <span class="n">initcd_votemper</span><span class="o">.</span><span class="n">namelist</span>
</pre></div>
</div>
<p>Creates:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">thetao_AMM60</span><span class="o">-</span><span class="n">LBay_2013</span><span class="o">.</span><span class="n">nc4</span>
<span class="n">sosie_mapping_AMM60</span><span class="o">-</span><span class="n">LBay</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Repeat for salinity:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sosie</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span><span class="n">f</span> <span class="n">initcd_vosaline</span><span class="o">.</span><span class="n">namelist</span>
</pre></div>
</div>
<p>Creates:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">so_AMM60</span><span class="o">-</span><span class="n">LBay_2013</span><span class="o">.</span><span class="n">nc4</span>
</pre></div>
</div>
<p>Now do interpolation as before. First copy the namelists:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/namelist_reshape_bilin_initcd_votemper $INPUTS/.
cp $START_FILES/namelist_reshape_bilin_initcd_vosaline $INPUTS/.
</pre></div>
</div>
<p>Edit the input files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $INPUTS/namelist_reshape_bilin_initcd_votemper
&amp;grid_inputs
  input_file = &#39;thetao_AMM60-LBay_2013.nc4&#39;
...

&amp;interp_inputs
  input_file = &quot;thetao_AMM60-LBay_2013.nc4&quot;
...
</pre></div>
</div>
<p>Simiarly for the <a href="#id1"><span class="problematic" id="id2">*</span></a>vosaline.nc file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $INPUTS/namelist_reshape_bilin_initcd_vosaline
&amp;grid_inputs
  input_file = &#39;so_AMM60-LBay_2013.nc4&#39;
...

&amp;interp_inputs
  input_file = &quot;so_AMM60-LBay_2013.nc4&quot;
...
</pre></div>
</div>
<p>Produce the remap files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_initcd_votemper
</pre></div>
</div>
<p>Creates <code class="docutils literal"><span class="pre">remap_nemo_grid_R12.nc</span></code> and <code class="docutils literal"><span class="pre">remap_data_grid_R12.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_initcd_votemper
</pre></div>
</div>
<p>Creates <code class="docutils literal"><span class="pre">data_nemo_bilin_R12.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scripinterp.exe namelist_reshape_bilin_initcd_votemper
</pre></div>
</div>
<p>Creates <code class="docutils literal"><span class="pre">initcd_votemper.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scripinterp.exe namelist_reshape_bilin_initcd_vosaline
</pre></div>
</div>
<p>Creates <code class="docutils literal"><span class="pre">initcd_vosaline.nc</span></code>.</p>
</div>
</div>
<div class="section" id="generate-a-domain-configuration-file">
<h2>4. Generate a domain configuration file<a class="headerlink" href="#generate-a-domain-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>The general idea is that you have to copy the <code class="docutils literal"><span class="pre">namelist_cfg</span></code> file into the <code class="docutils literal"><span class="pre">DOMAINcfg</span></code>
directory along with all the inputs files that would have previously been needed
get v3.6 running. The reason being that all the non-time stepping stuff, like
grid generating, has been abstracted from the core OPA code and is now done as
a pre-processing step, and output into an important file <code class="docutils literal"><span class="pre">domain_cfg.nc</span></code>.</p>
<p>Copy essential files into DOMAINcfg directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $INPUTS/coordinates.nc $TDIR/DOMAINcfg/.
cp $INPUTS/bathy_meter.nc $TDIR/DOMAINcfg/.
</pre></div>
</div>
<p>Edit the template namelist_cfg with only the essenetial domain building stuff:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/DOMAINcfg
vi namelist_cfg

!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!! NEMO/OPA  Configuration namelist : used to overwrite defaults values defined in SHARED/namelist_ref
!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!
!-----------------------------------------------------------------------
&amp;namrun        !   parameters of the run
!-----------------------------------------------------------------------
   nn_no       =       0   !  job number (no more used...)
   cn_exp      =  &quot;domaincfg&quot;  !  experience name
   nn_it000    =       1   !  first time step
   nn_itend    =      75   !  last  time step (std 5475)
/
!-----------------------------------------------------------------------
&amp;namcfg        !   parameters of the configuration
!-----------------------------------------------------------------------
   !
   ln_e3_dep   = .false.    ! =T : e3=dk[depth] in discret sens.
   !                       !      ===&gt;&gt;&gt; will become the only possibility in v4.0
   !                       ! =F : e3 analytical derivative of depth function
   !                       !      only there for backward compatibility test with v3.6
   !                       !
   cp_cfg      =  &quot;orca&quot;   !  name of the configuration
   jp_cfg      =       0   !  resolution of the configuration
   jpidta      =      53   !  1st lateral dimension ( &gt;= jpi )
   jpjdta      =     109   !  2nd    &quot;         &quot;    ( &gt;= jpj )
   jpkdta      =      51   !  number of levels      ( &gt;= jpk )
   jpiglo      =      53   !  1st dimension of global domain --&gt; i =jpidta
   jpjglo      =     109   !  2nd    -                  -    --&gt; j  =jpjdta
   jpizoom     =       1   !  left bottom (i,j) indices of the zoom
   jpjzoom     =       1   !  in data domain indices
   jperio      =       0   !  lateral cond. type (between 0 and 6)
/
!-----------------------------------------------------------------------
&amp;namzgr        !   vertical coordinate
!-----------------------------------------------------------------------
   ln_sco      = .true.    !  z-coordinate - partial steps
   ln_linssh   = .false.    !  linear free surface
/
!-----------------------------------------------------------------------
&amp;namdom        !   space and time domain (bathymetry, mesh, timestep)
!-----------------------------------------------------------------------
   jphgr_msh   =       0               !  type of horizontal mesh
...
</pre></div>
</div>
<p>Build a script to run the executable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $TDIR/DOMAINcdf/rs

#!/bin/bash
#PBS -N domain_cfg
#PBS -l walltime=00:20:00
#PBS -l select=1
#PBS -j oe
#PBS -A n01-NOCL
# mail alert at (b)eginning, (e)nd and (a)bortion of execution
#PBS -m bea
#PBS -M jelt@noc.ac.uk
#! -----------------------------------------------------------------------------

# Change to the directory that the job was submitted from
cd $PBS_O_WORKDIR

# Set the number of threads to 1
#   This prevents any system libraries from automatically
#   using threading.
export OMP_NUM_THREADS=1
# Change to the directory that the job was submitted from
ulimit -s unlimited

#===============================================================
# LAUNCH JOB
#===============================================================
echo `date` : Launch Job
aprun -n 1 -N 1 ./make_domain_cfg.exe &gt;&amp;  stdouterr_cfg

exit
</pre></div>
</div>
<p>Try running it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/DOMAINcfg
qsub -q short rs
</pre></div>
</div>
<p>Put a copy in $INPUTS for safe keeping:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $TDIR/DOMAINcfg/namelist_cfg $INPUTS/namelist_cfg_generateDOMAINcfg
</pre></div>
</div>
<dl class="docutils">
<dt>Copy domain_cfg.nc to the EXP directory (also copy it to the INPUTS directory, which stores</dt>
<dd><p class="first">the bits and bobs for a rebuild):</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>cp $TDIR/DOMAINcfg/domain_cfg.nc $EXP/.
cp $TDIR/DOMAINcfg/domain_cfg.nc $INPUTS/.
</pre></div>
</div>
</dd>
</dl>
<div class="section" id="generate-weights-for-atm-forcing">
<h3>5. Generate weights for atm forcing<a class="headerlink" href="#generate-weights-for-atm-forcing" title="Permalink to this headline">¶</a></h3>
<p>Generate cut down drowned precip file (note that the nco tools don&#8217;t like the
parallel modules). <strong>HEALTH WARNING</strong> <em>Cut out files with only one index in that lat direction broke NEMO</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module unload cray-netcdf-hdf5parallel cray-hdf5-parallel
module load cray-netcdf cray-hdf5
module load nco/4.5.0
ncks -d lon,355.,360. -d lat,48.,55. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_precip_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_precip_DFS5.1.1_y2000.nc
ncks -d lon0,355.,360. -d lat0,48.,55. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_u10_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_u10_DFS5.1.1_y2000.nc
ncks -d lon0,355.,360. -d lat0,48.,55. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_v10_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_v10_DFS5.1.1_y2000.nc
ncks -d lon0,355.,360. -d lat0,48.,55. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_radsw_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_radsw_DFS5.1.1_y2000.nc
ncks -d lon0,355.,360. -d lat0,48.,55. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_radlw_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_radlw_DFS5.1.1_y2000.nc
ncks -d lon0,355.,360. -d lat0,48.,55. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_t2_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_t2_DFS5.1.1_y2000.nc
ncks -d lon0,355.,360. -d lat0,48.,55. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_q2_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_q2_DFS5.1.1_y2000.nc
ncks -d lon0,355.,360. -d lat0,48.,55. /work/n01/n01/acc/ORCA0083/NEMOGCM/CONFIG/R12_ORCA/EXP00/FORCING/drowned_snow_DFS5.1.1_y2000.nc $WDIR/INPUTS/cutdown_drowned_snow_DFS5.1.1_y2000.nc

module unload nco/4.5.0
module unload cray-netcdf cray-hdf5
module load cray-netcdf-hdf5parallel cray-hdf5-parallel
</pre></div>
</div>
<p>Obtain namelist files and data file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/namelist_reshape_bilin_atmos $INPUTS/.
cp $START_FILES/namelist_reshape_bicubic_atmos $INPUTS/.
</pre></div>
</div>
<p>Edit namelist to reflect source filenames (just a year change):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $WDIR/INPUTS/namelist_reshape_bilin_atmos
...
&amp;grid_inputs
    input_file = &#39;cutdown_drowned_precip_DFS5.1.1_y2000.nc&#39;

vi $WDIR/INPUTS/namelist_reshape_bicubic_atmos
...
&amp;grid_inputs
  input_file = &#39;cutdown_drowned_precip_DFS5.1.1_y2000.nc&#39;
</pre></div>
</div>
<p>Setup weights files for the atmospheric forcing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
$OLD_TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_atmos
</pre></div>
</div>
<p>Generate  remap files <code class="docutils literal"><span class="pre">remap_nemo_grid_atmos.nc</span></code> and <code class="docutils literal"><span class="pre">remap_data_grid_atmos.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_atmos
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">data_nemo_bilin_atmos.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scripshape.exe namelist_reshape_bilin_atmos
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">weights_bilinear_atmos.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scrip.exe namelist_reshape_bicubic_atmos
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">data_nemo_bicubic_atmos.nc</span></code>. Then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$OLD_TDIR/WEIGHTS/scripshape.exe namelist_reshape_bicubic_atmos
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">weights_bicubic_atmos.nc</span></code>.</p>
<p>THIS IS WHERE START WITH LIVLJOBS4 to create boundary files with PyNEMO <em>(20 Sept 2017)</em>
If all the files are ready to go jump straight to <a class="reference internal" href="#generate-boundary-conditions-with-pynemo-run-pynemo">7. Generate boundary conditions with PyNEMO: Run PyNEMO</a></p>
</div>
<div class="section" id="generate-boundary-conditions-with-nrct-pynemo-create-netcdf-abstraction-wrapper">
<h3>6. Generate boundary conditions with NRCT/PyNEMO: Create netcdf abstraction wrapper<a class="headerlink" href="#generate-boundary-conditions-with-nrct-pynemo-create-netcdf-abstraction-wrapper" title="Permalink to this headline">¶</a></h3>
<p>In this section there are two stages.
* generate a ncml file which describes the files needed to create boundary conditions
* generate a namelist.bdy file which controls the actual boundary condition generation.</p>
<p>For each parent data set a new pair of (<code class="docutils literal"><span class="pre">*.ncml</span></code>, <code class="docutils literal"><span class="pre">namelist.bdy</span></code>) are needed.
Here I attempt to use parent data from NNA. I could use data from:
* AMM60 local data (might not yet work because of the sigma levels)
* thredds server (as in the LH_REEF example, though this is turned off!)
* NNA local data (easiest ?)</p>
<p>First install PyNEMO if not already done so. Full description (If this is already
installed then follow through anyway but skip the mkdir / create / install / clone</p>
<blockquote>
<div><p>and build commands):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ssh -Y livljobs4

export CONFIG=LBay
export WORK=/work
export WDIR=$WORK/$USER/NEMO/$CONFIG
export INPUTS=$WDIR/INPUTS
export START_FILES=$WDIR/START_FILES
#export CDIR=$WDIR/trunk_NEMOGCM_r8395/CONFIG
#export TDIR=$WDIR/trunk_NEMOGCM_r8395/TOOLS
#export EXP=$CDIR/$CONFIG/EXP00

cd $WORK/$USER
mkdir $WDIR
module load anaconda/2.1.0  # Want python2
conda create --name nrct_env scipy=0.16.0 numpy matplotlib=1.5.1 basemap netcdf4 libgfortran=1.0.0
source activate nrct_env
conda install -c https://conda.anaconda.org/conda-forge seawater=3.3.4 # Note had to add https path
conda install -c https://conda.anaconda.org/srikanthnagella thredds_crawler
conda install -c https://conda.anaconda.org/srikanthnagella pyjnius
</pre></div>
</div>
</div></blockquote>
<p>Find java object by doing a which java and then following the trail
find  /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/ -name libjvm.so -print</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>export LD_LIBRARY_PATH=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64/lib/amd64/server:$LD_LIBRARY_PATH
unset SSH_ASKPASS # Didn&#39;t need this on ARCHER...
git clone https://jpolton@bitbucket.org/jdha/nrct.git nrct  # Give jpolton@bitbucket passwd
cd nrct/Python
python setup.py build
export PYTHONPATH=/login/$USER/.conda/envs/nrct_env/lib/python2.7/site-packages/:$PYTHONPATH
python setup.py install --prefix ~/.conda/envs/nrct_env
cd $INPUTS
</pre></div>
</div>
<dl class="docutils">
<dt>I suggest managing the namelist.bdy file after the <code class="docutils literal"><span class="pre">ncml</span></code> file is generated.</dt>
<dd>A fresh <code class="docutils literal"><span class="pre">ncml</span></code> file can be generated automatically or an existing one can be edited.</dd>
</dl>
</div>
<div class="section" id="a-generate-ncml-files">
<h3>6a. Generate ncml files<a class="headerlink" href="#a-generate-ncml-files" title="Permalink to this headline">¶</a></h3>
<p>Activate generator:</p>
<p>Start up pynemo and generate boundary conditions. First we need to create a
few ncml files to gather input data and map variable names. Then using pynemo
we define the area we want to model.
Redefine <code class="docutils literal"><span class="pre">WDIR</span></code>. Launch from WDIR:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ssh -Y espp1
module load anaconda
source activate pynemo_env
#  export LD_LIBRARY_PATH=/opt/java/jdk1.7.0_45/jre/lib/amd64/server:$LD_LIBRARY_PATH
#  export PYTHONPATH=/home/n01/n01/jelt/.conda/envs/pynemo_env/lib/python2.7/site-packages/:$PYTHONPATH
cd $WDIR/INPUTS
pynemo_ncml_generator
</pre></div>
</div>
<p>Here the object is to generate a ncml file that is read in by PyNEMO as the <code class="docutils literal"><span class="pre">sn_src_dir</span></code>
(in the <code class="docutils literal"><span class="pre">namelist.bdy</span></code> file)</p>
<p>Fill in the Tracer and Dynamics for T,S,U,V,Z tabs: using T,T &amp; U,V,T in the reg
expressions e.g. .*T.nc$
To generate a e.g. <code class="docutils literal"><span class="pre">inputs_src.ncml</span></code> file click  <strong>generate</strong>. Defining the
filename seems to work better with the file selector rather than direct typing.</p>
<p>In <code class="docutils literal"><span class="pre">$INPUTS</span></code> I have three ncml files.
* One for using the thredds server to get remote ORCA12 data.
* One for using local AMM60 data, with ackward s-sigma levels
* One for using local NNA data</p>
<p>The first two are work in progress / templates. The latter is used here.</p>
</div>
<div class="section" id="nna-inputs-src-ncml">
<h3>NNA_inputs_src.ncml<a class="headerlink" href="#nna-inputs-src-ncml" title="Permalink to this headline">¶</a></h3>
<p>Note need to set the time variables and new <code class="docutils literal"><span class="pre">sn_src_dir</span></code> in namelist.bdy.
Actually upated the following with all the Jan 2000 files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
vi NNA_inputs_src.ncml

&lt;ns0:netcdf xmlns:ns0=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot; title=&quot;NEMO aggregation&quot;&gt;
  &lt;ns0:aggregation type=&quot;union&quot;&gt;
    &lt;ns0:netcdf&gt;
      &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;votemper&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:scan location=&quot;file://work/n01/n01/jdha/LBay/INPUTS/NNA&quot; regExp=&quot;.*T\.nc$&quot; /&gt;
      &lt;/ns0:aggregation&gt;
    &lt;/ns0:netcdf&gt;
    &lt;ns0:netcdf&gt;
      &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;vosaline&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:scan location=&quot;file://work/n01/n01/jdha/LBay/INPUTS/NNA&quot; regExp=&quot;.*T\.nc$&quot; /&gt;
      &lt;/ns0:aggregation&gt;
    &lt;/ns0:netcdf&gt;
    &lt;ns0:netcdf&gt;
      &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;vozocrtx&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:scan location=&quot;file://work/n01/n01/jdha/LBay/INPUTS/NNA&quot; regExp=&quot;.*U\.nc$&quot; /&gt;
      &lt;/ns0:aggregation&gt;
    &lt;/ns0:netcdf&gt;
    &lt;ns0:netcdf&gt;
      &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;vomecrty&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:scan location=&quot;file://work/n01/n01/jdha/LBay/INPUTS/NNA&quot; regExp=&quot;.*V\.nc$&quot; /&gt;
      &lt;/ns0:aggregation&gt;
    &lt;/ns0:netcdf&gt;
    &lt;ns0:netcdf&gt;
      &lt;ns0:aggregation dimName=&quot;time_counter&quot; name=&quot;sossheig&quot; type=&quot;joinExisting&quot;&gt;
        &lt;ns0:scan location=&quot;file://work/n01/n01/jdha/LBay/INPUTS/NNA&quot; regExp=&quot;.*T\.nc$&quot; /&gt;
      &lt;/ns0:aggregation&gt;
    &lt;/ns0:netcdf&gt;
  &lt;/ns0:aggregation&gt;
&lt;/ns0:netcdf&gt;
</pre></div>
</div>
</div>
<div class="section" id="b-generate-the-namelist-bdy-file-for-pynemo-nrct">
<h3>6b. Generate the namelist.bdy file for PyNEMO / NRCT<a class="headerlink" href="#b-generate-the-namelist-bdy-file-for-pynemo-nrct" title="Permalink to this headline">¶</a></h3>
<p>Copy the NRCT template namelist.bdy from the START_FILES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
cp $START_FILES/namelist.bdy $INPUTS/.
</pre></div>
</div>
<p>Edit namelist.bdy to for the configuration name and <code class="docutils literal"><span class="pre">ncml</span></code> file name. <strong>Note
need the slash following OUTPUT</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist.bdy
sn_src_dir = &#39;./inputs_src.ncml&#39;       ! src_files/&#39;
sn_dst_dir = &#39;/work/n01/n01/jelt/LBay/OUTPUT/&#39;
sn_fn      = &#39;LBay&#39;                 ! prefix for output files
...
cn_mask_file   = &#39;./mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
</pre></div>
</div>
<dl class="docutils">
<dt>Now edit the pynemo namelist file. Add location of grid information. Note had to</dt>
<dd><p class="first">hunt for a mesh.nc file. Incase this doesn&#8217;t work, there were a couple of
options. (Tried both) Note also that mesh_zgr includes gdept_0, gdepw_0, e3t_0, e3u_0,
e3v_0, e3w_0, so use ncml to convert to variables without <a href="#id3"><span class="problematic" id="id4">*</span></a>_0. (Also didn&#8217;t convert e3w_0).</p>
<p class="last">Make sure the timestamps correspond to the input data.</p>
</dd>
</dl>
<p>Turn off as many things as possible to help it along.
Turned off <code class="docutils literal"><span class="pre">ln_mask_file</span></code>. James said it was for outputting a new mask file
but it might have given me trouble.</p>
<p>I have a namelist.bdy file for each ncml configuration
* namelist.bdy_AMM60
* namelist.bdy_thredds (uses global 1/12 degree data)
* namelist.bdy_NNA</p>
</div>
<div class="section" id="generate-boundary-conditions-with-pynemo-run-pynemo">
<h3>7. Generate boundary conditions with PyNEMO: Run PyNEMO<a class="headerlink" href="#generate-boundary-conditions-with-pynemo-run-pynemo" title="Permalink to this headline">¶</a></h3>
<p>Using livljobs4</p>
<p><em>(20/21 Sept 2017)</em></p>
<p><strong>Start the process again on livljobs4: LBay_livljobs4.rst</strong></p>
<dl class="docutils">
<dt>Need to grab some INPUT files. (File bathy_meter.nc and domain_cfg.nc should be</dt>
<dd><p class="first">there already):</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>scp jelt@login.archer.ac.uk:/work/n01/n01/jelt/LBay/INPUTS/domain_cfg.nc $INPUTS/.
scp jelt@login.archer.ac.uk:/work/n01/n01/jelt/LBay/INPUTS/bathy_meter.nc $INPUTS/.
</pre></div>
</div>
</dd>
</dl>
<p>Copy the pynemo namelist and ncml files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/namelist.bdy_NNA    $INPUTS/.
cp $START_FILES/NNA_inputs_src.ncml $INPUTS/.
cp $START_FILES/inputs_dst.ncml     $INPUTS/.
cd $INPUTS
</pre></div>
</div>
<p>Make sure the NNA data is available:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mkdir $WDIR/INPUTS/NNA
scp jelt@login.archer.ac.uk:/work/n01/n01/jdha/LBay/INPUTS/NNA/mesh_hgr.nc $WDIR/INPUTS/NNA/.
scp jelt@login.archer.ac.uk:/work/n01/n01/jdha/LBay/INPUTS/NNA/mesh_hgr.nc $WDIR/INPUTS/NNA/.
scp jelt@login.archer.ac.uk:/work/n01/n01/jdha/LBay/INPUTS/NNA/mask.nc $WDIR/INPUTS/NNA/.
for file in NNA_*200001*nc ; do scp jelt@login.archer.ac.uk:/work/n01/n01/jdha/LBay/INPUTS/NNA/$file $WDIR/INPUTS/NNA/. ; done
</pre></div>
</div>
</div>
<div class="section" id="namelist-bdy-nna">
<h3>namelist.bdy_NNA<a class="headerlink" href="#namelist-bdy-nna" title="Permalink to this headline">¶</a></h3>
<p>Edit namelist.bdy_NNA to reflect locally stored mesh and mask files. Also
inputs_dst.ncml. Set the date info back to (Nov?) 1979.</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist.bdy_NNA

!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!! NEMO/OPA  : namelist for BDY generation tool
!!
!!             User inputs for generating open boundary conditions
!!             employed by the BDY module in NEMO. Boundary data
!!             can be set up for v3.2 NEMO and above.
!!
!!             More info here.....
!!
!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

!-----------------------------------------------------------------------
!   vertical coordinate
!-----------------------------------------------------------------------
   ln_zco      = .false.   !  z-coordinate - full    steps   (T/F)
   ln_zps      = .true.    !  z-coordinate - partial steps   (T/F)
   ln_sco      = .false.   !  s- or hybrid z-s-coordinate    (T/F)
   rn_hmin     =   -10     !  min depth of the ocean (&gt;0) or
                           !  min number of ocean level (&lt;0)

!-----------------------------------------------------------------------
!   s-coordinate or hybrid z-s-coordinate
!-----------------------------------------------------------------------
   rn_sbot_min =   10.     !  minimum depth of s-bottom surface (&gt;0) (m)
   rn_sbot_max = 7000.     !  maximum depth of s-bottom surface
                           !  (= ocean depth) (&gt;0) (m)
   ln_s_sigma  = .true.   !  hybrid s-sigma coordinates
   rn_hc       =  150.0    !  critical depth with s-sigma

!-----------------------------------------------------------------------
!  grid information
!-----------------------------------------------------------------------
   sn_src_hgr = &#39;/work/jelt/NEMO/LBay/INPUTS/NNA/mesh_hgr.nc&#39;   !  /grid/
   sn_src_zgr = &#39;/work/jelt/NEMO/LBay/INPUTS/NNA/mesh_zgr.nc&#39;
   sn_dst_hgr = &#39;./domain_cfg.nc&#39;
   sn_dst_zgr = &#39;./inputs_dst.ncml&#39; ! rename output variables
   sn_src_msk = &#39;/work/jelt/NEMO/LBay/INPUTS/NNA/mask.nc&#39;
   sn_bathy   = &#39;./bathy_meter.nc&#39;

!-----------------------------------------------------------------------
!  I/O
!-----------------------------------------------------------------------
   sn_src_dir = &#39;./NNA_inputs_src.ncml&#39;       ! src_files/&#39;
   sn_dst_dir = &#39;/work/jelt/NEMO/LBay/INPUTS/&#39;
   sn_fn      = &#39;LBay&#39;                 ! prefix for output files
   nn_fv      = -1e20                     !  set fill value for output files
   nn_src_time_adj = 0                                    ! src time adjustment
   sn_dst_metainfo = &#39;metadata info: jelt&#39;

!-----------------------------------------------------------------------
!  unstructured open boundaries
!-----------------------------------------------------------------------
    ln_coords_file = .true.               !  =T : produce bdy coordinates files
    cn_coords_file = &#39;coordinates.bdy.nc&#39; !  name of bdy coordinates files (if ln_coords_file=.TRUE.)
    ln_mask_file   = .false.              !  =T : read mask from file
    cn_mask_file   = &#39;./mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
    ln_dyn2d       = .true.               !  boundary conditions for barotropic fields
    ln_dyn3d       = .false.               !  boundary conditions for baroclinic velocities
    ln_tra         = .true.               !  boundary conditions for T and S
    ln_ice         = .false.               !  ice boundary condition
    nn_rimwidth    = 9                    !  width of the relaxation zone

!-----------------------------------------------------------------------
!  unstructured open boundaries tidal parameters
!-----------------------------------------------------------------------
    ln_tide        = .true.               !  =T : produce bdy tidal conditions
    clname(1)      = &#39;M2&#39;                  ! constituent name
    clname(2)      = &#39;S2&#39;
    clname(3)      = &#39;N2&#39;
    clname(4)      = &#39;K2&#39;
    clname(5)      = &#39;K1&#39;
    clname(6)      = &#39;O1&#39;
    clname(7)      = &#39;P1&#39;
    clname(8)      = &#39;Q1&#39;
    clname(9)      = &#39;MF&#39;
    clname(10)     = &#39;MM&#39;
    clname(11)     = &#39;M4&#39;
    clname(12)     = &#39;MS4&#39;
    clname(13)     = &#39;MN4&#39;
    ln_trans       = .false.
    sn_tide_h     = &#39;/work/jelt/tpxo7.2/h_tpxo7.2.nc&#39;
    sn_tide_u     = &#39;/work/jelt/tpxo7.2/u_tpxo7.2.nc&#39;


!-----------------------------------------------------------------------
!  Time information
!-----------------------------------------------------------------------
    nn_year_000     = 2000        !  year start
    nn_year_end     = 2000        !  year end
    nn_month_000    = 01          !  month start (default = 1 is years&gt;1)
    nn_month_end    = 01          !  month end (default = 12 is years&gt;1)
    sn_dst_calendar = &#39;gregorian&#39; !  output calendar format
    nn_base_year    = 1979        !  base year for time counter
    sn_tide_grid    = &#39;/work/jelt/tpxo7.2/grid_tpxo7.2.nc&#39;

!-----------------------------------------------------------------------
!  Additional parameters
!-----------------------------------------------------------------------
    nn_wei  = 1                   !  smoothing filter weights
    rn_r0   = 0.041666666         !  decorrelation distance use in gauss
                                  !  smoothing onto dst points. Need to
                                  !  make this a funct. of dlon
    sn_history  = &#39;bdy files produced by jelt from AMM60 for testing&#39;
                                  !  history for netcdf file
    ln_nemo3p4  = .true.          !  else presume v3.2 or v3.3
    nn_alpha    = 0               !  Euler rotation angle
    nn_beta     = 0               !  Euler rotation angle
    nn_gamma    = 0               !  Euler rotation angle
    rn_mask_max_depth = 300.0     !  Maximum depth to be ignored for the mask
    rn_mask_shelfbreak_dist = 60    !  Distance from the shelf break
</pre></div>
</div>
</div></blockquote>
<dl class="docutils">
<dt>Also had to check that <code class="docutils literal"><span class="pre">inputs_dst.ncml</span></code> has the correct file name within:</dt>
<dd><dl class="first last docutils">
<dt><em>Now domain_cfg.nc, formerly mesh_zgr.nc</em>. Note also that some variables in</dt>
<dd><p class="first">domain_cfg.nc have different names e.g. <code class="docutils literal"><span class="pre">mbathy</span></code> &#8211;&gt; <code class="docutils literal"><span class="pre">bottom_level</span></code>. Check the mapping
in <code class="docutils literal"><span class="pre">inputs_dst.ncml</span></code>:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">inputs_dst</span><span class="o">.</span><span class="n">ncml</span>

<span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">ns0</span><span class="o">=</span><span class="s2">&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;NEMO aggregation&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;union&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;file:domain_cfg.nc&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mbathy&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;bottom_level&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;gdept&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;gdept_0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;gdepw&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;gdepw_0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e3u&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;e3u_0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">ns0</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e3v&quot;</span> <span class="n">orgName</span><span class="o">=</span><span class="s2">&quot;e3v_0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">aggregation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ns0</span><span class="p">:</span><span class="n">netcdf</span><span class="o">&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</dd>
</dl>
<p>Generate the boundary conditions again, with PyNEMO</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module load anaconda/2.1.0  # Want python2
source activate nrct_env
cd $INPUTS
export LD_LIBRARY_PATH=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64/lib/amd64/server:$LD_LIBRARY_PATH

#pynemo -g -s namelist.bdy_NNA
pynemo -s namelist.bdy_NNA
</pre></div>
</div>
<p>Once the area of interest is selected and the close button is clicked, open
boundary data should be generated in the current directory (NB I dont fiddle
with the GUI; I just click CLOSE to activiate, if everything is already sorted
in the input files).</p>
<p>The SAVE button only updates the <code class="docutils literal"><span class="pre">namelist.bdy</span></code> file. The CLOSE button activates the process.</p>
<p>Alternatively don&#8217;t invoke the <cite>-g</cite> option and there is no GUI.</p>
<dl class="docutils">
<dt>This generates::</dt>
<dd><p class="first">ls -1 $INPUTS</p>
<p class="last">coordinates.bdy.nc
LBay_bdytide_rotT_M4_grid_T.nc
LBay_bdytide_rotT_MM_grid_T.nc
LBay_bdytide_rotT_MN4_grid_T.nc
LBay_bdytide_rotT_MS4_grid_T.nc
LBay_bdytide_rotT_M2_grid_T.nc
LBay_bdytide_rotT_N2_grid_T.nc
LBay_bdytide_rotT_S2_grid_T.nc
LBay_bdytide_rotT_K1_grid_T.nc
LBay_bdytide_rotT_K2_grid_T.nc
LBay_bdytide_rotT_P1_grid_T.nc
LBay_bdytide_rotT_O1_grid_T.nc
LBay_bdytide_rotT_MF_grid_T.nc
LBay_bdytide_rotT_Q1_grid_T.nc
LBay_bdytide_rotT_M4_grid_U.nc
LBay_bdytide_rotT_MM_grid_U.nc
LBay_bdytide_rotT_MN4_grid_U.nc
LBay_bdytide_rotT_MS4_grid_U.nc
LBay_bdytide_rotT_M2_grid_U.nc
LBay_bdytide_rotT_N2_grid_U.nc
LBay_bdytide_rotT_S2_grid_U.nc
LBay_bdytide_rotT_K1_grid_U.nc
LBay_bdytide_rotT_K2_grid_U.nc
LBay_bdytide_rotT_P1_grid_U.nc
LBay_bdytide_rotT_O1_grid_U.nc
LBay_bdytide_rotT_MF_grid_U.nc
LBay_bdytide_rotT_Q1_grid_U.nc
LBay_bdytide_rotT_M4_grid_V.nc
LBay_bdytide_rotT_MM_grid_V.nc
LBay_bdytide_rotT_MN4_grid_V.nc
LBay_bdytide_rotT_MS4_grid_V.nc
LBay_bdytide_rotT_M2_grid_V.nc
LBay_bdytide_rotT_N2_grid_V.nc
LBay_bdytide_rotT_S2_grid_V.nc
LBay_bdytide_rotT_K1_grid_V.nc
LBay_bdytide_rotT_K2_grid_V.nc
LBay_bdytide_rotT_P1_grid_V.nc
LBay_bdytide_rotT_O1_grid_V.nc
LBay_bdytide_rotT_MF_grid_V.nc
LBay_bdytide_rotT_Q1_grid_V.nc
LBay_bdyT_y2000m01.nc
LBay_bt_bdyT_y2000m01.nc
LBay_bdyU_y2000m01.nc
LBay_bdyV_y2000m01.nc</p>
</dd>
</dl>
<p>Prepare the boundary files (need to fix some variable names):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS

module load nco/gcc/4.4.2.ncwa

ncrename -v depthu,gdepu LBay_bdyU_y2000m01.nc
ncrename -v depthv,gdepv LBay_bdyV_y2000m01.nc
module unload nco
</pre></div>
</div>
<p>Copy the new files back onto ARCHER</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4$
cd $INPUTS
for file in LBay*nc; do scp $file jelt@login.archer.ac.uk:/work/n01/n01/jelt/LBay/INPUTS/. ; done
scp coordinates.bdy.nc jelt@login.archer.ac.uk:/work/n01/n01/jelt/LBay/INPUTS/.
</pre></div>
</div>
<p>I previously also had the following. But now I comment it out as these files are
generated on ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#for file in initcd_vo*nc; do scp $file jelt@login.archer.ac.uk:/work/n01/n01/jelt/LBay/INPUTS/. ; done</span>
</pre></div>
</div>
</div>
<div class="section" id="run-the-configuration-on-archer-turn-on-the-tides">
<h3>8. Run the configuration ON ARCHER. Turn on the tides<a class="headerlink" href="#run-the-configuration-on-archer-turn-on-the-tides" title="Permalink to this headline">¶</a></h3>
<p><em>(16 OCt 17)</em></p>
<p>Edit the output to have 1hrly SSH:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi file_def_nemo.xml
...
&lt;file_group id=&quot;1h&quot; output_freq=&quot;1h&quot;  output_level=&quot;10&quot; enabled=&quot;.TRUE.&quot;&gt; &lt;!-- 1h files --&gt;
 &lt;file id=&quot;file19&quot; name_suffix=&quot;_SSH&quot; description=&quot;ocean T grid variables&quot; &gt;
   &lt;field field_ref=&quot;ssh&quot;          name=&quot;zos&quot;   /&gt;
 &lt;/file&gt;
&lt;/file_group&gt;
</pre></div>
</div>
<p>&#8212;</p>
<p>Create a short queue runscript:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi runscript
#!/bin/bash
#PBS -N LBay
#PBS -l select=5
#PBS -l walltime=00:20:00
#PBS -A n01-NOCL
# mail alert at (b)eginning, (e)nd and (a)bortion of execution
#PBS -m bea
#PBS -M jelt@noc.ac.uk


module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel
module load cray-hdf5-parallel

export PBS_O_WORKDIR=$(readlink -f $PBS_O_WORKDIR)
#  echo $(readlink -f $PBS_O_WORKDIR)
# export OMP_NUM_THREADS=1

cd $PBS_O_WORKDIR
#
  echo &quot; &quot;;
  OCEANCORES=96
  XIOCORES=1
ulimit -c unlimited
ulimit -s unlimited

rm -f core

#aprun -n $OCEANCORES -N 24 ./opa
aprun -b -n 5 -N 5 ./xios_server.exe : -n $OCEANCORES -N 24 ./opa
#aprun -b -n $XIOCORES -N 1 ./xios_server.exe : -n $OCEANCORES -N 24 ./opa

exit
</pre></div>
</div>
<p>&#8212;</p>
<p>No met (missing slp) <code class="docutils literal"><span class="pre">ln_usr=T</span></code>. rn_rdt=60s. Output more harmonics (20-30days).
Run for 30 days:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP
qsub -q short runscript
</pre></div>
</div>
<p><strong>IT WORKS!</strong></p>
<ul class="simple">
<li>Tidy up this note. Freeze it. Add met?</li>
</ul>
<blockquote>
<div>&#8212;</div></blockquote>
</div>
<div class="section" id="rebuild-the-output-and-inspect">
<h3>Rebuild the output and inspect<a class="headerlink" href="#rebuild-the-output-and-inspect" title="Permalink to this headline">¶</a></h3>
<p>Rebuild the output using NEMO tools. Inspect the output using python script
<a href="#id11"><span class="problematic" id="id12">`rebuild_and_inspect_NEMO_output`_</span></a></p>
<p>&#8212;</p>
<p>&#8212;</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>TO DO</strong> another time / for Solent config</p>
<ul class="simple">
<li>Add in met forcing</li>
<li>Turn on T,S at boundares</li>
<li>Change namelist to include tidal harmonic analysis:</li>
</ul>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
&amp;nam_diaharm   !   Harmonic analysis of tidal constituents (&#8216;key_diaharm&#8217;)
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>nit000_han = 1440         ! First time step used for harmonic analysis
nitend_han = 14400        ! Last time step used for harmonic analysis
nstep_han  = 15        ! Time step frequency for harmonic analysis
tname(1)     =   &#8216;O1&#8217;  !  name of constituent
tname(2)     =   &#8216;P1&#8217;
tname(3)     =   &#8216;K1&#8217;
tname(4)     =   &#8216;N2&#8217;
tname(5)     =   &#8216;M2&#8217;
tname(6)     =   &#8216;S2&#8217;
tname(7)     =   &#8216;K2&#8217;
tname(8)     =   &#8216;Q1&#8217;
tname(9)     =   &#8216;M4&#8217;</div></blockquote>
<ul class="last simple">
<li>Harmonise all wet forcing to use AMM60 data.</li>
</ul>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Setting up a Liverpool Bay NEMO v4 configuration</a><ul>
<li><a class="reference internal" href="#issues-that-arose">Issues that arose</a></li>
<li><a class="reference internal" href="#recipe-notes">Recipe Notes</a></li>
<li><a class="reference internal" href="#build-tools">Build TOOLS</a><ul>
<li><a class="reference internal" href="#generate-new-coordinates-file">1. Generate new coordinates file</a></li>
<li><a class="reference internal" href="#generate-bathymetry-file">2. Generate bathymetry file</a></li>
<li><a class="reference internal" href="#generate-initial-conditions">3. Generate initial conditions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generate-a-domain-configuration-file">4. Generate a domain configuration file</a><ul>
<li><a class="reference internal" href="#generate-weights-for-atm-forcing">5. Generate weights for atm forcing</a></li>
<li><a class="reference internal" href="#generate-boundary-conditions-with-nrct-pynemo-create-netcdf-abstraction-wrapper">6. Generate boundary conditions with NRCT/PyNEMO: Create netcdf abstraction wrapper</a></li>
<li><a class="reference internal" href="#a-generate-ncml-files">6a. Generate ncml files</a></li>
<li><a class="reference internal" href="#nna-inputs-src-ncml">NNA_inputs_src.ncml</a></li>
<li><a class="reference internal" href="#b-generate-the-namelist-bdy-file-for-pynemo-nrct">6b. Generate the namelist.bdy file for PyNEMO / NRCT</a></li>
<li><a class="reference internal" href="#generate-boundary-conditions-with-pynemo-run-pynemo">7. Generate boundary conditions with PyNEMO: Run PyNEMO</a></li>
<li><a class="reference internal" href="#namelist-bdy-nna">namelist.bdy_NNA</a></li>
<li><a class="reference internal" href="#run-the-configuration-on-archer-turn-on-the-tides">8. Run the configuration ON ARCHER. Turn on the tides</a></li>
<li><a class="reference internal" href="#rebuild-the-output-and-inspect">Rebuild the output and inspect</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/LBay_archer_livljobs4.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, NOC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/LBay_archer_livljobs4.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>