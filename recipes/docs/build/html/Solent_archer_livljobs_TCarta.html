<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Setting up a Solent NEMO v4 configuration &#8212; NEMO-RELOC 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="NEMO-RELOC 0.1 documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="setting-up-a-solent-nemo-v4-configuration">
<h1>Setting up a Solent NEMO v4 configuration<a class="headerlink" href="#setting-up-a-solent-nemo-v4-configuration" title="Permalink to this headline">¶</a></h1>
<p>Machines: livljobs4, ARCHER</p>
<ul class="simple">
<li>Build notes with:: ~/GitLab/NEMO-RELOC/docs$ make html</li>
</ul>
<p>Builds a Solent regional model using TCarta bathymetry, FES tidal boundaries.</p>
<p>Build on a combination of livljobs4 and ARCHER.</p>
<p>Uses a prerelease of NEMO v4 (&#64;r8395)</p>
<p>The summary procedure:
#. ARCHER: Get code. Build tools. Generate coordinates, domain_cfg.nc
#. ARCHER: Generate initial conditions and atmospheric forcings
#. LIVLJOBS4: Generate boundary conditions with NRCT/PyNEMO. Generate bathymetry
#. ARCHER: Run simulation</p>
<div class="section" id="issues-that-arose">
<h2>Issues that arose<a class="headerlink" href="#issues-that-arose" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>SCRIP tools didn&#8217;t work on ARCHER. Walltime too long for interactive mode,</li>
</ul>
<p>and couldn&#8217;t get serial job to work with intel compiler.
* ...</p>
</div>
<hr class="docutils" />
<div class="section" id="recipe-notes">
<h2>Recipe Notes<a class="headerlink" href="#recipe-notes" title="Permalink to this headline">¶</a></h2>
<p>In the following I build most stuff on ARCHER but the PyNEMO and SCRIP bathymetry
generation bits are done on livljobs4.
Starting on ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ssh login.archer.ac.uk

export CONFIG=Solent
export WORK=/work/n01/n01
export WDIR=$WORK/$USER/$CONFIG
export INPUTS=$WDIR/INPUTS
export START_FILES=$WDIR/START_FILES
export CDIR=$WDIR/trunk_NEMOGCM_r8395/CONFIG
export TDIR=$WDIR/trunk_NEMOGCM_r8395/TOOLS
export OLD_TDIR=$WORK/$USER/LBay/dev_r4621_NOC4_BDY_VERT_INTERP/NEMOGCM/TOOLS/
export EXP=$CDIR/$CONFIG/EXP00

module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel cray-hdf5-parallel
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="collect-essential-files">
<h2>Collect essential files<a class="headerlink" href="#collect-essential-files" title="Permalink to this headline">¶</a></h2>
<p>Note you might have to mkdir the odd directory or two... Some of these will need
to be done on ARCHER and LIVLJOBS4:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mkdir $WDIR
mkdir $INPUTS
mkdir $START_FILES

# SCRIP tools
rsync -uvt $WDIR/../SEAsia/START_FILES/scrip.patch $START_FILES/.
rsync -uvt $WDIR/../SEAsia/START_FILES/scripgrid.patch $START_FILES/.
rsync -uvt $WDIR/../SEAsia/START_FILES/scripinterp.patch $START_FILES/.
rsync -uvt $WDIR/../SEAsia/START_FILES/scripinterp_mod.patch $START_FILES/.
rsync -uvt $WDIR/../SEAsia/START_FILES/scripshape.patch $START_FILES/.

rsync -uvt $WDIR/../LBay/START_FILES/dommsk.F90 $START_FILES/.
rsync -uvt $WDIR/../LBay/START_FILES/bdyini.F90 $START_FILES/.
rsync -uvt $WDIR/../LBay/START_FILES/coordinates_ORCA_R12.nc $START_FILES/.
rsync -uvt $WDIR/../LBay/INPUTS/namelist_reshape_bilin_gebco $START_FILES/.
rsync -uvt $WDIR/../SWPacific/START_FILES/usrdef_istate.F90 $START_FILES/.
rsync -uvt $WDIR/../SWPacific/START_FILES/usrdef_sbc.F90    $START_FILES/.

# Interpolate z-coordinates for initial conditions on the fly
rsync -uvt /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ORCHESTRA/MY_SRC/par_oce.F90 $START_FILES/.
rsync -uvt /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/CONFIG/ORCHESTRA/MY_SRC/dtatsd.F90 $START_FILES/.

# FES tides and POLCOMS harmonic analysis `&lt;FES2014_NEMO.rst&gt;`_
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/bdyini.F90 $START_FILES/.
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/diaharm.F90 $START_FILES/.
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/diaharm_fast.F90 $START_FILES/.
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/sbctide.F90 $START_FILES/.
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/step.F90 $START_FILES/.
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/step_oce.F90 $START_FILES/.
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/tide_FES14.h90 $START_FILES/.
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/tideini.F90 $START_FILES/.
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/tide_mod.F90 $START_FILES/.
rsync -uvt /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC/ $START_FILES/.
</pre></div>
</div>
<p>Checkout and build NEMO (ORCHESTRA) trunk &#64; r8395 <a href="#id7"><span class="problematic" id="id8">`build_opa_orchestra.html`_</span></a>.
Or just build (if it is already downloaded). Note here we use user defined</p>
<blockquote>
<div><p>functions for the initial state (constant T and S) and surface forcing (zero forcing):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR
cp $START_FILES/usrdef_istate.F90 $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/usrdef_sbc.F90    $CDIR/$CONFIG/MY_SRC/.
./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
</div></blockquote>
<p>&#8212;</p>
<p>Checkout and build XIOS2 &#64; r1080 <a href="#id9"><span class="problematic" id="id10">`build_XIOS2.html`_</span></a>:</p>
<p>Or just link XIOS executable to the EXP directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s  /work/n01/n01/$USER/xios-2.0_r1080/bin/xios_server.exe $EXP/xios_server.exe
</pre></div>
</div>
<p>&#8212;</p>
</div>
<div class="section" id="build-tools">
<h2>Build TOOLS<a class="headerlink" href="#build-tools" title="Permalink to this headline">¶</a></h2>
<p>To generate domain coords and rebuild tools we first need
to compile some of the NEMO TOOLS. These are split across ARCHER and LIVLJOBS4.
In particular the SCRIP tools didn&#8217;t work on ARCHER.</p>
<p>First build DOMAINcfg (which is relatively new and in NEMOv4). Use my XIOS1 file
(see userid and path in variable <code class="docutils literal"><span class="pre">%XIOS_HOME</span></code>). Copy from ARCH <em>store</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span># ARCHER
cp $WORK/$USER/ARCH/arch-XC_ARCHER_INTEL_XIOS1.fcm $TDIR/../ARCH/.
cd $TDIR

./maketools -m XC_ARCHER_INTEL_XIOS1 -n DOMAINcfg
./maketools -m XC_ARCHER_INTEL_XIOS1 -n REBUILD_NEMO
</pre></div>
</div>
<p>&#8212;</p>
<p>To generate bathymetry, initial conditions and grid information we first need
to compile some of the NEMO TOOLS (after a small bugfix - and to allow direct
passing of arguments). <strong>For some reason GRIDGEN doesn’t like INTEL.</strong>
<strong>Do this on livljobs4</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">livljobs4</span>
</pre></div>
</div>
<p>Apply patches:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/WEIGHTS/src
patch -b &lt; $START_FILES/scripinterp_mod.patch
patch -b &lt; $START_FILES/scripinterp.patch
patch -b &lt; $START_FILES/scrip.patch
patch -b &lt; $START_FILES/scripshape.patch
patch -b &lt; $START_FILES/scripgrid.patch
</pre></div>
</div>
<p>Setup for PGI modules and compile:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR
cp $START_FILES/arch-pgf90_linux_jb.fcm $TDIR/../ARCH/arch-pgf90_linux_jb.fcm

module add netcdf/gcc/4.1.3
module add pgi/15.4

./maketools -n WEIGHTS -m pgf90_linux_jb
./maketools -n REBUILD_NEMO -m pgf90_linux_jb
./maketools -n GRIDGEN -m pgf90_linux_jb
./maketools -n NESTING -m pgf90_linux_jb
</pre></div>
</div>
<div class="section" id="generate-new-coordinates-file">
<h3>1. Generate new coordinates file<a class="headerlink" href="#generate-new-coordinates-file" title="Permalink to this headline">¶</a></h3>
<p>...</p>
<p>Hmm try and jump straight to DOMAINcfg with only lat and lon points</p>
<p>Extract from the parent bathymetry the size, start lat and lon, and resolution:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="mi">1363</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mi">2410</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg

jpidta      =    2410   !  1st lateral dimension ( &gt;= jpi )
jpjdta      =    1363   !  2nd    &quot;         &quot;    ( &gt;= jpj )
...
jpiglo      =    2410   !  1st dimension of global domain --&gt; i =jpidta
jpjglo      =    1363   !  2nd    -                  -    --&gt; j  =jpjdta


!-----------------------------------------------------------------------
&amp;namdom        !   space and time domain (bathymetry, mesh, timestep)
!-----------------------------------------------------------------------
  jphgr_msh   =       1               !  type of horizontal mesh
  ppglam0     =  -1.6638888888888899             !  longitude of first raw and column T-point (jphgr_msh = 1)
  ppgphi0     =  50.53833333333690803             ! latitude  of first raw and column T-point (jphgr_msh = 1)
  ppe1_deg    =  0.0002777777778             !  zonal      grid-spacing (degrees)
  ppe2_deg    =  0.0002777777778             !  meridional grid-spacing (degrees)
  ppdzmin     =  999999.              !  Minimum vertical spacing
  pphmax      =  999999.              !  Maximum depth
  ldbletanh   =  .FALSE.              !  Use/do not use double tanf function for vertical coordinates
  ppa2        =  999999.              !  Double tanh function parameters
  ppkth2      =  999999.              !
  ppacr2      =  999999.              !
/
</pre></div>
</div>
<p>This seems to work, in populating e1 and e2 fields.</p>
<p>NExt steps:
Do rigourously.</p>
<p>Then build into a coordinate.nc file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$archer
module load nco

# copy the desired variables
ncks -O -C -a -v nav_lon,nav_lat,glamt,glamu,glamv,glamf,gphit,gphiu,gphiv,gphif,e1t,e1u,e1v,e1f,e2t,e2u,e2v,e2f,ff_f,ff_t domain_cfg.nc coordinates_Solent_R3600.nc
</pre></div>
</div>
<dl class="docutils">
<dt>This creates a new coordinates file with contents, which is now copied to</dt>
<dd><p class="first">INPUTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp coordinates_Solent_R3600.nc $INPUTS/coordinates.nc
</pre></div>
</div>
<p class="last">Now we need to generate a bathymetry on this new grid.</p>
</dd>
</dl>
</div>
<div class="section" id="generate-bathymetry-file">
<h3>2. Generate bathymetry file<a class="headerlink" href="#generate-bathymetry-file" title="Permalink to this headline">¶</a></h3>
<p>Take parent bathymetry from TCarta. Put the data on ARCHER in $INPUTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>scp TCarta_30m_dbm.nc $USER@login.archer.ac.uk:/work/n01/n01/$USER/SEAsia/INPUTS/.
</pre></div>
</div>
<p>and:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/namelist_reshape_bilin_tcarta $INPUTS/.
</pre></div>
</div>
<dl class="docutils">
<dt>Do some things to 0) set the elevation variable name, 1) flatten out land</dt>
<dd>elevations, 2) make depths positive.</dd>
</dl>
<p>Have to swap around with the modules to get nco working <em>(James
noted a problem with the default nco module)</em>
Here force a minimum depth of 10m by lowering the data by 12m:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS

module unload cray-netcdf-hdf5parallel cray-hdf5-parallel
module load cray-netcdf cray-hdf5

module load nco/4.5.0
ncrename -v TCarta_30m_dbm.tif,elevation   TCarta_30m_dbm.nc
ncap2 -s &#39;elevation=elevation-12&#39; TCarta_30m_dbm.nc tmp.nc

# Fix the missing values: reassign the values and zero. (Check what the values are first)
ncap2 -s &#39;where(elevation &lt; -32000) elevation=0&#39; tmp.nc tmp2.nc

ncflint --fix_rec_crd -w -1.0,0.0 tmp2.nc tmp2.nc TCarta_Solent_10m.nc
rm tmp*.nc
</pre></div>
</div>
<p>Restore the original parallel modules:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">unload</span> <span class="n">nco</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span><span class="o">-</span><span class="n">hdf5parallel</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Port (TCarta_Solent_10m.nc, coordinates.nc) to livljobs4 for processing</dt>
<dd><p class="first">(convert to v3 and run SCRIP routines):</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Convert to netCDF3_classic</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">nco</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">4.4</span><span class="o">.</span><span class="mf">2.</span><span class="n">ncwa</span>
<span class="n">ncks</span> <span class="o">--</span><span class="n">fl_fmt</span><span class="o">=</span><span class="n">classic</span> <span class="n">TCarta_Solent_10m</span><span class="o">.</span><span class="n">nc</span> <span class="n">TCarta_Solent_10m_v3</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
</dd>
<dt>Edit namelist to point to correct input file. Edit lat and lon variable names to</dt>
<dd>make sure they match the nc file content (used e.g.</dd>
</dl>
<p><code class="docutils literal"><span class="pre">ncdump</span> <span class="pre">-h</span> <span class="pre">TCarta_Solent_10m_v3.nc</span></code> to get input variable names):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $INPUTS/namelist_reshape_bilin_tcarta
...
&amp;grid_inputs
  input_file = &#39;TCarta_Solent_10m_v3.nc&#39;
  nemo_file = &#39;coordinates.nc&#39;
  ...
  input_lon = &#39;lon&#39;
  input_lat = &#39;lat&#39;
  nemo_lon = &#39;glamt&#39;
  nemo_lat = &#39;gphit&#39;
  ...

  &amp;interp_inputs
  input_file = &quot;TCarta_Solent_10m_v3.nc&quot;
  ...
  input_name = &quot;elevation&quot;
</pre></div>
</div>
<p>Restore the original parallel modules (used livljobs4):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># livljobs4</span>
<span class="n">module</span> <span class="n">purge</span>
<span class="n">module</span> <span class="n">add</span> <span class="n">netcdf</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">4.1</span><span class="o">.</span><span class="mi">3</span>
<span class="n">module</span> <span class="n">add</span> <span class="n">pgi</span><span class="o">/</span><span class="mf">15.4</span>
</pre></div>
</div>
<p>Execute first scrip thing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_tcarta
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">remap_nemo_grid_tcarta</span><span class="o">.</span><span class="n">nc</span>
<span class="n">remap_data_grid_tcarta</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Execute second scip thing (~6 hrs):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_tcarta
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">data_nemo_bilin_tcarta</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Execute third scip thing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scripinterp.exe namelist_reshape_bilin_tcarta
</pre></div>
</div>
<p>Output files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bathy_meter</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Copy to Archer:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>rsync -urtv bathy_meter.nc $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/.
</pre></div>
</div>
</div>
<div class="section" id="generate-initial-conditions">
<h3>3. Generate initial conditions<a class="headerlink" href="#generate-initial-conditions" title="Permalink to this headline">¶</a></h3>
<p>Skip this for a tide-only run. Using user defined constant T and S.</p>
<dl class="docutils">
<dt>For constant T and S use the user defined functions in <code class="docutils literal"><span class="pre">$CDIR/$CONFIG/MY_SRC</span></code>:</dt>
<dd><code class="docutils literal"><span class="pre">usrdef_sbc.F90</span></code>  and <code class="docutils literal"><span class="pre">usrdef_istate.F90</span></code>.</dd>
</dl>
</div>
</div>
<div class="section" id="generate-a-domain-configuration-file">
<h2>4. Generate a domain configuration file<a class="headerlink" href="#generate-a-domain-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>The general idea is that you have to copy the <code class="docutils literal"><span class="pre">namelist_cfg</span></code> file into the <code class="docutils literal"><span class="pre">DOMAINcfg</span></code>
directory along with all the inputs files that would have previously been needed
get v3.6 running. The reason being that all the non-time stepping stuff, like
grid generating, has been abstracted from the core OPA code and is now done as
a pre-processing step, and output into an important file <code class="docutils literal"><span class="pre">domain_cfg.nc</span></code>.</p>
<p>Copy essential files into DOMAINcfg directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#ln -s $INPUTS/coordinates.nc $TDIR/DOMAINcfg/.  # Already there
ln -s $INPUTS/bathy_meter.nc $TDIR/DOMAINcfg/.
</pre></div>
</div>
<p>Edit the template <code class="docutils literal"><span class="pre">namelist_cfg</span></code> with only the essenetial domain building stuff.
Get the size of the new domain from <code class="docutils literal"><span class="pre">ncdump</span> <span class="pre">-h</span> <span class="pre">bathy_meter.nc</span></code>.</p>
<p>Follow recipe of hybrid z-s coordinates in <a href="#id11"><span class="problematic" id="id12">`build_domain_cfg_file.rst`_</span></a></p>
<dl class="docutils">
<dt>Copy domain_cfg.nc to the EXP directory (also copy it to the INPUTS directory, which stores</dt>
<dd><p class="first">the bits and bobs for a rebuild):</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>rsync -utv $TDIR/DOMAINcfg/domain_cfg.nc $EXP/.
rsync -utv $TDIR/DOMAINcfg/domain_cfg.nc $INPUTS/.
</pre></div>
</div>
</dd>
</dl>
<p>Also have to copy to where the tidal forcing is made (like the SAN)</p>
</div>
<div class="section" id="generate-tidal-boundary-conditions">
<h2>5. Generate tidal boundary conditions<a class="headerlink" href="#generate-tidal-boundary-conditions" title="Permalink to this headline">¶</a></h2>
<p>livljobs4: get all the necessary files onto this machine:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
rsync -uvrt jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/domain_cfg.nc .
rsync -uvrt jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/coordinates.nc .
rsync -uvrt jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/bathy_meter.nc .
</pre></div>
</div>
<p>Need to generate 3 more files: A <code class="docutils literal"><span class="pre">namelist.bdy</span></code> which drives PyNEMO and which
has two input files: <code class="docutils literal"><span class="pre">inputs_src.ncml</span></code> which points to the data source and
<code class="docutils literal"><span class="pre">inputs_dst.ncml</span></code> which remaps some variable names in the destination files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">../../</span><span class="n">SWPacific</span><span class="o">/</span><span class="n">INPUTS</span><span class="o">/</span><span class="n">namelist</span><span class="o">.</span><span class="n">bdy</span> <span class="o">.</span>
</pre></div>
</div>
<p>First install PyNEMO <a href="#id13"><span class="problematic" id="id14">`install_nrct`_</span></a> if not already done so. Use branch <code class="docutils literal"><span class="pre">Generalise-tide-input</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd /work/$USER/nrct
git checkout Generalise-tide-input
</pre></div>
</div>
<p>Copy across some parent mesh files and a mask file (even though they are not
used. This is because this old version of PyNEMO didn&#8217;t anticipate tide-only usage):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
cp ../../SEAsia/INPUTS/mesh_?gr_src.nc $INPUTS/.
cp ../../SEAsia/INPUTS/mask_src.nc $INPUTS/.
</pre></div>
</div>
<p>If I don&#8217;t make a boundary mask then it doesn&#8217;t work... This can also be done with
the PyNEMO GUI. The mask variable takes values (-1 mask, 1 wet, 0 land). Get a
template from domain_cfg.nc and then modify as desired around the boundary:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">nco</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">4.4</span><span class="o">.</span><span class="mf">2.</span><span class="n">ncwa</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">bdy_mask</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncks</span> <span class="o">-</span><span class="n">v</span> <span class="n">top_level</span> <span class="n">domain_cfg</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncrename</span> <span class="o">-</span><span class="n">h</span> <span class="o">-</span><span class="n">v</span> <span class="n">top_level</span><span class="p">,</span><span class="n">mask</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncwa</span> <span class="o">-</span><span class="n">a</span> <span class="n">t</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">nc</span> <span class="n">bdy_mask</span><span class="o">.</span><span class="n">nc</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>In ipython:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="n">dset</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="s1">&#39;bdy_mask.nc&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>     <span class="c1"># Southern boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>    <span class="c1"># Northern boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>    <span class="c1"># Eastern boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>        <span class="c1"># Western boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Couldn&#8217;t find the FES data (they have moved from Tom&#8217;s work dir). Tide data source
is clumsily set in <code class="docutils literal"><span class="pre">nemo_bdy_tide3.py</span></code></p>
<dl class="docutils">
<dt>::</dt>
<dd><p class="first">vi namelist.bdy</p>
<p>!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!! NEMO/OPA  : namelist for BDY generation tool
!!
!!             User inputs for generating open boundary conditions
!!             employed by the BDY module in NEMO. Boundary data
!!             can be set up for v3.2 NEMO and above.
!!
!!             More info here.....
!!
!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</p>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!   vertical coordinate
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div><p>ln_zco      = .true.   !  z-coordinate - full    steps   (T/F)
ln_zps      = .false.    !  z-coordinate - partial steps   (T/F)
ln_sco      = .false.   !  s- or hybrid z-s-coordinate    (T/F)
rn_hmin     =   -5     !  min depth of the ocean (&gt;0) or</p>
<blockquote>
<div>!  min number of ocean level (&lt;0)</div></blockquote>
</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!   s-coordinate or hybrid z-s-coordinate
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div><p>rn_sbot_min =   10.     !  minimum depth of s-bottom surface (&gt;0) (m)
rn_sbot_max = 7000.     !  maximum depth of s-bottom surface</p>
<blockquote>
<div>!  (= ocean depth) (&gt;0) (m)</div></blockquote>
<p>ln_s_sigma  = .false.   !  hybrid s-sigma coordinates
rn_hc       =  50.0    !  critical depth with s-sigma</p>
</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  grid information
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>sn_src_hgr = &#8216;./mesh_hgr_src.nc&#8217;   !  parent /grid/
sn_src_zgr = &#8216;./mesh_zgr_src.nc&#8217;   !  parent
sn_dst_hgr = &#8216;./domain_cfg.nc&#8217;
sn_dst_zgr = &#8216;./inputs_dst.ncml&#8217; ! rename output variables
sn_src_msk = &#8216;./mask_src.nc&#8217;       ! parent
sn_bathy   = &#8216;./bathy_meter.nc&#8217;</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  I/O
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>sn_src_dir = &#8216;./cut_inputs_src.ncml&#8217;       ! src_files/&#8217;
sn_dst_dir = &#8216;/work/jelt/NEMO/Solent/INPUTS/&#8217;
sn_fn      = &#8216;Solent&#8217;                 ! prefix for output files
nn_fv      = -1e20                     !  set fill value for output files
nn_src_time_adj = 0                                    ! src time adjustment
sn_dst_metainfo = &#8216;metadata info: jelt&#8217;</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  unstructured open boundaries
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>ln_coords_file = .false.               !  =T : produce bdy coordinates files
cn_coords_file = &#8216;coordinates.bdy.nc&#8217; !  name of bdy coordinates files (if ln_coords_file=.TRUE.)
ln_mask_file   = .true.              !  =T : read mask from file
cn_mask_file   = &#8216;./bdy_mask.nc&#8217;                   !  name of mask file (if ln_mask_file=.TRUE.)
ln_dyn2d       = .false.               !  boundary conditions for barotropic fields
ln_dyn3d       = .false.               !  boundary conditions for baroclinic velocities
ln_tra         = .false.               !  boundary conditions for T and S
ln_ice         = .false.               !  ice boundary condition
nn_rimwidth    = 1                    !  width of the relaxation zone</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  unstructured open boundaries tidal parameters
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>ln_tide        = .true.               !  =T : produce bdy tidal conditions</div></blockquote>
<p>!TESTING
!               clname(1) =&#8217;M2&#8217;
!               clname(2)=&#8217;S2&#8217;
!               clname(3)=&#8217;K2&#8217;
!TPXO</p>
<blockquote>
<div><blockquote>
<div>clname(1)=&#8217;m2&#8217;
clname(2)=&#8217;s2&#8217;
clname(3)=&#8217;n2&#8217;
clname(4)=&#8217;k2&#8217;
clname(5)=&#8217;k1&#8217;
clname(6)=&#8217;o1&#8217;
clname(7)=&#8217;p1&#8217;
clname(8)=&#8217;q1&#8217;
clname(9)=&#8217;mf&#8217;
clname(10)=&#8217;mm&#8217;
clname(11)=&#8217;m4&#8217;
clname(12)=&#8217;ms4&#8217;
clname(13)=&#8217;mn4&#8217;</div></blockquote>
<p>ln_trans       = .false.</p>
</div></blockquote>
<p>sn_tide_h     = &#8216;/work/jelt/tpxo7.2/h_tpxo7.2.nc&#8217;
sn_tide_u     = &#8216;/work/jelt/tpxo7.2/u_tpxo7.2.nc&#8217;</p>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  Time information
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
nn_year_000     = 1979        !  year start
nn_year_end     = 1979        !  year end
nn_month_000    = 11          !  month start (default = 1 is years&gt;1)
nn_month_end    = 11          !  month end (default = 12 is years&gt;1)
sn_dst_calendar = &#8216;gregorian&#8217; !  output calendar format
nn_base_year    = 1978        !  base year for time counter
sn_tide_grid    = &#8216;/work/jelt/tpxo7.2/grid_tpxo7.2.nc&#8217;</p>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  Additional parameters
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
nn_wei  = 1                   !  smoothing filter weights
rn_r0   = 0.041666666         !  decorrelation distance use in gauss</p>
<blockquote>
<div>!  smoothing onto dst points. Need to
!  make this a funct. of dlon</div></blockquote>
<dl class="docutils">
<dt>sn_history  = &#8216;bdy files produced by jelt from ORCA0083-N01&#8217;</dt>
<dd>!  history for netcdf file</dd>
</dl>
<p class="last">ln_nemo3p4  = .true.          !  else presume v3.2 or v3.3
nn_alpha    = 0               !  Euler rotation angle
nn_beta     = 0               !  Euler rotation angle
nn_gamma    = 0               !  Euler rotation angle
rn_mask_max_depth = 7000.0    !  Maximum depth to be ignored for the mask
rn_mask_shelfbreak_dist = 60    !  Distance from the shelf break</p>
</dd>
</dl>
<p>Generate the boundary conditions with PyNEMO</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module load anaconda/2.1.0  # Want python2
source activate nrct_env
cd $INPUTS
export LD_LIBRARY_PATH=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64/lib/amd64/server:$LD_LIBRARY_PATH

pynemo -s namelist.bdy
</pre></div>
</div>
<p>This creates:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Solent_bdytide_rotT_M4_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MM_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MN4_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MS4_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_M2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_N2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_S2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_K1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_K2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_P1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_O1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MF_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_Q1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_M4_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MM_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MN4_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MS4_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_M2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_N2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_S2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_K1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_K2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_P1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_O1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MF_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_Q1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_M4_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MM_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MN4_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MS4_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_M2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_N2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_S2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_K1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_K2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_P1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_O1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_MF_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">Solent_bdytide_rotT_Q1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">coordinates</span><span class="o">.</span><span class="n">bdy</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Copy the new files back onto ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4$
cd $INPUTS
rsync -utv coordinates.bdy.nc $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/coordinates.bdy.nc
for file in $CONFIG*nc; do rsync -utv $file $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/$file ; done
</pre></div>
</div>
<div class="section" id="run-the-configuration-on-archer-turn-on-the-tides">
<h3>6. Run the configuration ON ARCHER. Turn on the tides<a class="headerlink" href="#run-the-configuration-on-archer-turn-on-the-tides" title="Permalink to this headline">¶</a></h3>
<p>Get set up:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">archer</span>
<span class="o">.</span> <span class="o">~/</span><span class="n">temporary_path_names_for_NEMO_build</span>
</pre></div>
</div>
<p>Get important files into EXP directory. Should already have <code class="docutils literal"><span class="pre">domain_cfg.nc</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP
rsync -tuv $INPUTS/bathy_meter.nc $EXP/.
rsync -tuv $INPUTS/coordinates.nc $EXP/.
rsync -tuv $INPUTS/coordinates.bdy.nc $EXP/.
rsync -tuv $START_FILES/namelist_cfg $EXP/.
</pre></div>
</div>
<p>Create symbolic links from EXP directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s $INPUTS $EXP/bdydta
</pre></div>
</div>
<p>Edit the output to have 1hrly SSH:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi file_def_nemo.xml
...
&lt;file_group id=&quot;1h&quot; output_freq=&quot;1h&quot;  output_level=&quot;10&quot; enabled=&quot;.TRUE.&quot;&gt; &lt;!-- 1h files --&gt;
 &lt;file id=&quot;file19&quot; name_suffix=&quot;_SSH&quot; description=&quot;ocean T grid variables&quot; &gt;
   &lt;field field_ref=&quot;ssh&quot;          name=&quot;zos&quot;   /&gt;
 &lt;/file&gt;
&lt;/file_group&gt;
</pre></div>
</div>
<p>&#8212;</p>
<p>Create a short queue runscript. (Note: PBS -N jobname, PBS -m email):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi runscript

#!/bin/bash
#PBS -N Solent
#PBS -l select=5
#PBS -l walltime=00:20:00
#PBS -A n01-NOCL
# mail alert at (b)eginning, (e)nd and (a)bortion of execution
#PBS -m bea
#PBS -M jelt@noc.ac.uk

module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel
module load cray-hdf5-parallel

export PBS_O_WORKDIR=$(readlink -f $PBS_O_WORKDIR)
#  echo $(readlink -f $PBS_O_WORKDIR)
# export OMP_NUM_THREADS=1

cd $PBS_O_WORKDIR
#
  echo &quot; &quot;;
  OCEANCORES=74
ulimit -c unlimited
ulimit -s unlimited

rm -f core
aprun -b -n 5 -N 5 ./xios_server.exe : -n $OCEANCORES -N 24 ./opa

exit
</pre></div>
</div>
<p>Change the notification email to your own address:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;s/xxx@noc/$USER@noc/g&quot;</span> <span class="n">runscript</span>
</pre></div>
</div>
<p>Follow <a class="reference external" href="MMP_decomp_land_suppression.rst">MMP_decomp_land_suppression.rst</a> to set the number of processors etc.
Edit namelist_cfg key parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg

!-----------------------------------------------------------------------
&amp;nammpp        !   Massively Parallel Processing                        (&quot;key_mpp_mpi)
!-----------------------------------------------------------------------
 ...
 jpni        =  12    !  jpni   number of processors following i (set automatically if &lt; 1)
 jpnj        =  8     !  jpnj   number of processors following j (set automatically if &lt; 1)
 jpnij       =  74    !  jpnij  number of local domains (set automatically if &lt; 1)

rn_rdt = 1.
ln_bdy=.false.
ln_tide=.true.
ln_tsd_init   = .false.   !  Initialisation of ocean T &amp; S with T &amp;S input data (T) or not (F)
ln_tsd_interp = .false.    !  Interpolation of T &amp; S in the verticalinput data (T) or not (F)
</pre></div>
</div>
<p>Adjust runscript parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi runscript
...
#PBS -l select=5
...
OCEANCORES=74
...
aprun -b -n 5 -N 5 ./xios_server.exe : -n $OCEANCORES -N 19 ./opa
</pre></div>
</div>
<p>27 May 2018
<strong>BLOWS AFTER A FEW STEPS. PROBABLY SOMETHING WRONG WITH THE VERTICAL GRID IN
THE DEEP CHANNEL</strong></p>
<p>7 Jun 2018
Regenerate domain_cfg.nc with stretched sigma and resubmit.
Still blows after a few steps. Didn&#8217;t get a chance to look why..</p>
<p>jpiglo =         2410
jpjglo =         1363
jpkglo =           31</p>
</div>
</div>
<div class="section" id="stpctl-the-zonal-velocity-is-larger-than-20-m-s">
<h2>stpctl: the zonal velocity is larger than 20 m/s<a class="headerlink" href="#stpctl-the-zonal-velocity-is-larger-than-20-m-s" title="Permalink to this headline">¶</a></h2>
<p>kt=     5 max abs(U):  7.6246E+05, i j k:  1211   34   30</p>
<p>Rebuild from 74 processors</p>
<p>Try running with SWPacific executable...</p>
<p>same problem. Try smoothing the bathy</p>
<p>ln_bdy = F
ln_tide = T
kt=13</p>
<p>Revert back to Solent executable (o/w issue with ln_tide=F when compiled with tidal analysis)
ln_bdy = F
ln_tide = F
kt=13</p>
</div>
<div class="section" id="id1">
<h2>stpctl: the zonal velocity is larger than 20 m/s<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>kt=    13 max abs(U):   167.4    , i j k:  1204   33   30</p>
<p>increase viscosty:
rn_ahm_0      =   400.     !  horizontal laplacian eddy viscosity   [m2/s]
rn_rdt = 1.</p>
</div>
<div class="section" id="id2">
<h2>stpctl: the zonal velocity is larger than 20 m/s<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>kt=    32 max abs(U):   48.93    , i j k:  1202   33   30</p>
<p>Deepest water ~100m &#8211;&gt; c_g = 32m/s &#8211;&gt; 16m box =&gt; 0.5s step
rn_ahm_0      =   400.     !  horizontal laplacian eddy viscosity   [m2/s]
rn_rdt = 0.5</p>
</div>
<div class="section" id="id3">
<h2>stpctl: the zonal velocity is larger than 20 m/s<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>kt=    51 max abs(U):   185.8    , i j k:     2  705   30</p>
<p>Try:
rn_ahm_0      =   4000.     !  horizontal laplacian eddy viscosity   [m2/s]
rn_rdt = 1.</p>
</div>
<div class="section" id="id4">
<h2>stpctl: the zonal velocity is larger than 20 m/s<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>kt=    16 max abs(U):   242.2    , i j k:  1205   33   30</p>
<p>Try:
rn_ahm_0      =   200.     !  horizontal laplacian eddy viscosity   [m2/s]
rn_rdt = 1.</p>
</div>
<div class="section" id="id5">
<h2>stpctl: the zonal velocity is larger than 20 m/s<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>kt=    49 max abs(U):   43.60    , i j k:     2  706   30</p>
<p>Try:
rn_ahm_0      =   100.     !  horizontal laplacian eddy viscosity   [m2/s]
rn_rdt = 1.</p>
</div>
<div class="section" id="id6">
<h2>stpctl: the zonal velocity is larger than 20 m/s<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>kt=    99 max abs(U):   61.36    , i j k:     2  704   29</p>
<p>Try:
rn_ahm_0      =   25.     !  horizontal laplacian eddy viscosity   [m2/s]
rn_rdt = 1.</p>
<p>kt=328 &#8211; 20 mins wall time.</p>
<p><em>Try with tides turned on</em></p>
<p>ln_tide = T
ln_bdy = T - tide only
rn_ahm_0      =   25.     !  horizontal laplacian eddy viscosity   [m2/s]
rn_rdt = 1.</p>
<p><em>8 Jun 2018</em></p>
<p><strong>Works</strong>. ~348 steps in 20mins</p>
<p>Try a 5s timestep &#8211;&gt; kt = 33
stp_ctl : the ssh is larger than 10m
=======
kt=    33 max ssh:   10.75    , i j:  2404  935</p>
<p>Try 3s timestep &#8211;&gt; kt=88
stp_ctl : the ssh is larger than 10m
=======
kt=    88 max ssh:   11.58    , i j:  2388 1104</p>
<p>Try 2s timestep &#8211;&gt; kt = 212
stp_ctl : the ssh is larger than 10m
=======
kt=   212 max ssh:   10.47    , i j:  2354  970</p>
<p>To do?:
* increase timestep?
* try more processors?
* Try FES tides</p>
<p>export CONFIG=Solent
export WORK=/work
export WDIR=$WORK/jelt/NEMO/$CONFIG
export INPUTS=$WDIR/INPUTS
export START_FILES=$WDIR/START_FILES</p>
<p>## Make a Solent directory</p>
<p>livljobs4:
mkdir $WDIR
mkdir $INPUTS
mkdir $START_FILES</p>
<p>cd $START_FILES</p>
<p>## Ckeckout the TCarta data for the Solent. 1/3600 deg</p>
<p>import netCDF4
import matplotlib.pyplot as plt
dset = netCDF4.Dataset(&#8216;TCarta_30m_dbm.nc&#8217;,&#8217;a&#8217;)</p>
<p>H = dset.variables[&#8216;TCarta_30m_dbm.tif&#8217;][:,:]
lon = dset.variables[&#8216;lon&#8217;][:]
lat = dset.variables[&#8216;lat&#8217;][:]</p>
<p>plt.pcolormesh(lon,lat,H)
plt.colorbar()
plt.show()</p>
<p>lat:
50.9166666666666714, 50.53833333333690803
lon:
-1.6638888888888899, 0.99472222222211859</p>
<p>## Find the coordinates for the Solent.</p>
<p>import netCDF4
import matplotlib.pyplot as plt
import numpy as np
dset = netCDF4.Dataset(&#8216;coordinates_ORCA_R12.nc&#8217;,&#8217;a&#8217;)</p>
<p>nav_lon = dset.variables[&#8216;nav_lon&#8217;][:]
nav_lat = dset.variables[&#8216;nav_lat&#8217;][:]</p>
<p>plt.pcolormesh(lon,lat,H)
plt.colorbar()
plt.show()</p>
<p>I = 2203,3411 # SW Corner.</p>
<p>In [46]: print &#8216;lat {}, lon {}&#8217;.format(nav_lat[I], nav_lon[I])
lat 50.5043754578, lon -1.67069804668</p>
<p>&#8212;</p>
<p>livljobs6:</p>
<p>module load nco/gcc/4.4.2.ncwa
# create new file with correct dimensions within
ncks -O -C -a -v TCarta_30m_dbm.tif TCarta_30m_dbm.nc coordinates_Solent_R3600.nc</p>
<p># rename variable and dimensions
ncrename -v TCarta_30m_dbm.tif,dummy   coordinates_Solent_R3600.nc
ncrename -d lat,y -d lon,x  coordinates_Solent_R3600.nc</p>
<p># Add a depth dimension
ncap2 -s &#8216;defdim(&#8220;z&#8221;,1); dum3[$z,$y,$x]=dummy&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -s &#8216;defdim(&#8220;time&#8221;,1); dum4[$time,$z,$y,$x]=dum3&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc</p>
<p># add a blank variables
ncap2 -O -s &#8216;nav_lat[y,x]=1f&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;nav_lon[y,x]=1f&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc</p>
<p>ncap2 -O -s &#8216;gphit[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;gphif[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;gphiu[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;gphiv[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc</p>
<p>ncap2 -O -s &#8216;glamt[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;glamf[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;glamu[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;glamv[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc</p>
<p>ncap2 -O -s &#8216;e1t[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;e1u[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;e1v[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;e1f[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc</p>
<p>ncap2 -O -s &#8216;e2t[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;e2u[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;e2v[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc
ncap2 -O -s &#8216;e2f[time,z,y,x]=1d&#8217; coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc</p>
<p># add needed attributes
ncatted -a units,nav_lon,c,c,&#8217;degrees_east&#8217;      </p>
<blockquote>
<div>-a units,nav_lon,c,c,&#8217;degrees_north&#8217;  coordinates_Solent_R3600.nc</div></blockquote>
<p># Remove now unnecessary bathymetry variable
ncks -x -v dummy,dum3,dum4 coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc</p>
<p># Extend the time dimension to UNLIMITED
ncks -O &#8211;mk_rec time coordinates_Solent_R3600.nc coordinates_Solent_R3600.nc</p>
<p>&#8212;
# Replace lat lon variable with bathy data
ipython</p>
<p>import netCDF4
import matplotlib.pyplot as plt
import numpy as np
dout = netCDF4.Dataset(&#8216;coordinates_Solent_R3600.nc&#8217;,&#8217;a&#8217;)</p>
<p>din = netCDF4.Dataset(&#8216;TCarta_30m_dbm.nc&#8217;,&#8217;a&#8217;)</p>
<p>TC_lon = din.variables[&#8216;lon&#8217;][:]
TC_lat = din.variables[&#8216;lat&#8217;][:]</p>
<p>yv, xv = np.meshgrid(np.flipud(TC_lat), TC_lon)</p>
<p>dout.variables[&#8216;glamt&#8217;][0,0,:,:] = xv.T
dout.variables[&#8216;gphit&#8217;][0,0,:,:] = yv.T
dout.variables[&#8216;nav_lon&#8217;][:,:] = xv.T
dout.variables[&#8216;nav_lat&#8217;][:,:] = yv.T</p>
<p>dout.close()
din.close()</p>
<p># copy lat and lon variables</p>
<p>variables:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">float</span> <span class="n">nav_lon</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">nav_lon</span><span class="p">:</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;degrees_east&quot;</span> <span class="p">;</span>
  <span class="n">nav_lon</span><span class="p">:</span><span class="n">valid_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.540191</span><span class="n">f</span> <span class="p">;</span>
  <span class="n">nav_lon</span><span class="p">:</span><span class="n">valid_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.716762</span><span class="n">f</span> <span class="p">;</span>
  <span class="n">nav_lon</span><span class="p">:</span><span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;Longitude&quot;</span> <span class="p">;</span>
<span class="nb">float</span> <span class="n">nav_lat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">nav_lat</span><span class="p">:</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;degrees_north&quot;</span> <span class="p">;</span>
  <span class="n">nav_lat</span><span class="p">:</span><span class="n">valid_min</span> <span class="o">=</span> <span class="mf">53.11438</span><span class="n">f</span> <span class="p">;</span>
  <span class="n">nav_lat</span><span class="p">:</span><span class="n">valid_max</span> <span class="o">=</span> <span class="mf">53.96194</span><span class="n">f</span> <span class="p">;</span>
  <span class="n">nav_lat</span><span class="p">:</span><span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;Latitude&quot;</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">glamt</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">glamt</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">glamu</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">glamu</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">glamv</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">glamv</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">glamf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">glamf</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">gphit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">gphit</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">gphiu</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">gphiu</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">gphiv</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">gphiv</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">gphif</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">gphif</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">e1t</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">e1t</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">e1u</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">e1u</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">e1v</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">e1v</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">e1f</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">e1f</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">e2t</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">e2t</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">e2u</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">e2u</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">e2v</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">e2v</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
<span class="n">double</span> <span class="n">e2f</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">;</span>
  <span class="n">e2f</span><span class="p">:</span><span class="n">missing_value</span> <span class="o">=</span> <span class="mf">1.e+20</span><span class="n">f</span> <span class="p">;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Setting up a Solent NEMO v4 configuration</a><ul>
<li><a class="reference internal" href="#issues-that-arose">Issues that arose</a></li>
<li><a class="reference internal" href="#recipe-notes">Recipe Notes</a></li>
<li><a class="reference internal" href="#collect-essential-files">Collect essential files</a></li>
<li><a class="reference internal" href="#build-tools">Build TOOLS</a><ul>
<li><a class="reference internal" href="#generate-new-coordinates-file">1. Generate new coordinates file</a></li>
<li><a class="reference internal" href="#generate-bathymetry-file">2. Generate bathymetry file</a></li>
<li><a class="reference internal" href="#generate-initial-conditions">3. Generate initial conditions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generate-a-domain-configuration-file">4. Generate a domain configuration file</a></li>
<li><a class="reference internal" href="#generate-tidal-boundary-conditions">5. Generate tidal boundary conditions</a><ul>
<li><a class="reference internal" href="#run-the-configuration-on-archer-turn-on-the-tides">6. Run the configuration ON ARCHER. Turn on the tides</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stpctl-the-zonal-velocity-is-larger-than-20-m-s">stpctl: the zonal velocity is larger than 20 m/s</a></li>
<li><a class="reference internal" href="#id1">stpctl: the zonal velocity is larger than 20 m/s</a></li>
<li><a class="reference internal" href="#id2">stpctl: the zonal velocity is larger than 20 m/s</a></li>
<li><a class="reference internal" href="#id3">stpctl: the zonal velocity is larger than 20 m/s</a></li>
<li><a class="reference internal" href="#id4">stpctl: the zonal velocity is larger than 20 m/s</a></li>
<li><a class="reference internal" href="#id5">stpctl: the zonal velocity is larger than 20 m/s</a></li>
<li><a class="reference internal" href="#id6">stpctl: the zonal velocity is larger than 20 m/s</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Solent_archer_livljobs_TCarta.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, NOC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/Solent_archer_livljobs_TCarta.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>