<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Setting up surge model for MASSMO5 domain &#8212; NEMO-RELOC 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="NEMO-RELOC 0.1 documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="setting-up-surge-model-for-massmo5-domain">
<span id="massmo5-surge"></span><h1>Setting up surge model for MASSMO5 domain<a class="headerlink" href="#setting-up-surge-model-for-massmo5-domain" title="Permalink to this headline">¶</a></h1>
<p>70.0, 30 SE corner
77.5 , 10.5 NW corner</p>
<p>coordinates_ORCA_R12.nc
shade/X=3339:3559/Y=2670:2820 E2T, nav_lon, nav_lat ; go fland</p>
<p>i=3339:3559
j=2670:2820</p>
<p>Obrained roughly from:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">findJI</span><span class="p">(</span><span class="mf">70.0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2710</span><span class="p">,</span> <span class="mi">3559</span><span class="p">]</span>

<span class="n">findJI</span><span class="p">(</span><span class="mf">77.5</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2778</span><span class="p">,</span> <span class="mi">3339</span><span class="p">]</span>
</pre></div>
</div>
<p>To link to me use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>:ref:`MASSMO5_surge`
</pre></div>
</div>
<p><strong>NOTE</strong> This receipe is a copy from <a class="reference internal" href="EAfricaSurge_jobs4_archer.html#eafrica-surge"><span class="std std-ref">Setting up surge model for East Africa</span></a> and <cite>Solent_surge</cite></p>
<p>Summary of the following:</p>
<ol class="arabic simple">
<li>Get and setup the Met Office NEMO v.4 surge code on Archer. <strong>Note</strong> two features of this code are: first, a namelist_cfg flag (ln_2d) which sets a constant temp
and salinity, and second a namelist_cfg flag (ln_usr, ln_use_sbc) which allows the user to set all surface boundary conditions to zero or to read in wind and pressure.
This is trunk revision 8814. For reference, the flag ln_2d appears in istate.f90 and ln_usr appears in sbcmod.f90 and sbcice_lim.F90.</li>
<li>copy coordinates file</li>
<li>copy bathymetry file</li>
<li>Generate a domain configuration file suitable for surge model on Archer</li>
<li>Generate tide boundary conditions on livljobs4</li>
<li>Run with tides only forcing on Archer</li>
<li>Output xml and running on Archer</li>
</ol>
<div class="section" id="a-get-and-build-met-surge-config">
<h2>1a) Get and build Met Surge Config<a class="headerlink" href="#a-get-and-build-met-surge-config" title="Permalink to this headline">¶</a></h2>
<p>Login to Archer</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ssh -l $USER login.archer.ac.uk
</pre></div>
</div>
<p>Create file &#8216;temporary_path_names_for_NEMO_build_surge&#8217; and add the following</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>export CONFIG=MASSMO5_surge
export WORK=/work/n01/n01
export WDIR=/work/n01/n01/$USER/$CONFIG
export INPUTS=$WDIR/INPUTS
export START_FILES=$WDIR/START_FILES
export CDIR=$WDIR/dev_r8814_surge_modelling_Nemo4/CONFIG
export TDIR=$WDIR/dev_r8814_surge_modelling_Nemo4/TOOLS
export EXP=$CDIR/$CONFIG/EXP00
</pre></div>
</div>
<p>execute e.g.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span> <span class="o">~/</span><span class="n">temporary_path_names_for_NEMO_build_surge</span>
</pre></div>
</div>
<p>Get some required files</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mkdir $WDIR
mkdir $INPUTS
mkdir $START_FILES
cp $WORK/jelt/LBay/START_FILES/dommsk.F90 $START_FILES/.
cp $WORK/jelt/LBay/START_FILES/bdyini.F90 $START_FILES/.
cp $WORK/jelt/SEAsia/git_repo/SEAsia/MY_SRC/stpctl.F90 $START_FILES/.
cp $WORK/jelt/LBay/START_FILES/coordinates_ORCA_R12.nc $START_FILES/.
cp $WORK/jelt/LBay/INPUTS/namelist_reshape_bilin_gebco $START_FILES/.
</pre></div>
</div>
<p>Files for improved tides and (last 2 items for) harmonic analysis:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd /work/n01/n01/nibrun/NEMO/NEMO_trunk_9395/NEMOGCM/CONFIG/SWPacific/MY_SRC
#cp bdyini.F90 $START_FILES/. # Already have this file
cp step.F90 $START_FILES/.
cp step_oce.F90 $START_FILES/.
cp tideini.F90 $START_FILES/.
cp tide_FES14.h90 $START_FILES/.
cp sbctide.F90 $START_FILES/.
cp tide_mod.F90 $START_FILES/.
#cp bdytides.F90 $START_FILES/.
cp diaharm_fast.F90 $START_FILES/.
cp /work/n01/n01/nibrun/RUNS/SWPacific/SIMU/field_def_nemo-opa.xml $START_FILES/.
</pre></div>
</div>
<p>Add a couple of extra lines into the field_def files. This is a glitch in the surge code,
because it doesn&#8217;t expect you to not care about the winds:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $START_FILES/field_def_nemo-opa.xml
line 338
&lt;field id=&quot;wspd&quot;         long_name=&quot;wind speed module&quot;                     standard_name=&quot;wind_speed&quot;                                                           unit=&quot;m/s&quot;                            /&gt;
&lt;field id=&quot;uwnd&quot;         long_name=&quot;u component of wind&quot;       unit=&quot;m/s&quot;         /&gt;
&lt;field id=&quot;vwnd&quot;         long_name=&quot;v component of wind&quot;       unit=&quot;m/s&quot;        /&gt;
</pre></div>
</div>
<p>Load modules</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">swap</span> <span class="n">PrgEnv</span><span class="o">-</span><span class="n">cray</span> <span class="n">PrgEnv</span><span class="o">-</span><span class="n">intel</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span><span class="o">-</span><span class="n">hdf5parallel</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span>
</pre></div>
</div>
</div>
<div class="section" id="b-build-xios2-r1080">
<h2>1b) Build XIOS2 &#64; r1080<a class="headerlink" href="#b-build-xios2-r1080" title="Permalink to this headline">¶</a></h2>
<p>Follow instructions at <span class="xref std std-ref">build_XIOS2</span>
(Note the final instruction to link the xios_server.exe may not work if the file structure has not been set
up, leave it, we do it here anyway)</p>
</div>
<div class="section" id="c-build-nemo">
<h2>1c) Build NEMO<a class="headerlink" href="#c-build-nemo" title="Permalink to this headline">¶</a></h2>
<p>Get NEMO branch</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $WDIR
svn co http://forge.ipsl.jussieu.fr/nemo/svn/branches/UKMO/dev_r8814_surge_modelling_Nemo4/NEMOGCM dev_r8814_surge_modelling_Nemo4
</pre></div>
</div>
<p>Get the correct archer compiler options file</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp /work/n01/n01/jelt/ARCH/arch-XC_ARCHER_INTEL.fcm $CDIR/../ARCH/.
</pre></div>
</div>
<p>Make NEMO</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $CDIR
./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
<p>If build finished then jump to next section. If build failed try</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10 clean
</pre></div>
</div>
<p>Check compile flags (add new harmonic analysis and tide handling flags):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $CONFIG/cpp_$CONFIG.fcm

bld::tool::fppkeys  key_nosignedzero key_diainstant key_mpp_mpi key_iomput \
                    key_diaharm_fast key_FES14_tides
</pre></div>
</div>
<p>Minor edit to solver.stat output:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/stpctl.F90  $CDIR/$CONFIG/MY_SRC/.
</pre></div>
</div>
<p>Copy in changes to harmonic analysis and tidal processing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/dommsk.F90  $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/bdyini.F90  $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/tideini.F90  $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/tide_mod.F90  $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/tide_FES14.h90  $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/step_oce.F90  $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/step.F90  $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/sbctide.F90  $CDIR/$CONFIG/MY_SRC/.
cp $START_FILES/diaharm_fast.F90    $CDIR/$CONFIG/MY_SRC/.
</pre></div>
</div>
<p>Build</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>./makenemo -n $CONFIG -m XC_ARCHER_INTEL -j 10
</pre></div>
</div>
<p>Create a link to xios_server.exe</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s  /work/n01/n01/$USER/xios-2.0_r1080/bin/xios_server.exe $EXP/xios_server.exe
</pre></div>
</div>
</div>
<div class="section" id="generate-coordinates-file">
<h2>2) Generate coordinates file<a class="headerlink" href="#generate-coordinates-file" title="Permalink to this headline">¶</a></h2>
<p>First obtain the parent coordinate file coordinates_ORCA_R12.nc</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/coordinates_ORCA_R12.nc $INPUTS/.
</pre></div>
</div>
<p>Using this NetCDF file first decide upon which indices will define your domain. Use ferret or python, for example, to explore the domain</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4$ cd /work/jelt/tpxo7.2
ferret
use coordinates_ORCA_R12.nc
shade/X=3339:3559/Y=2670:2820 E2T, nav_lon, nav_lat ; go fland
</pre></div>
</div>
<p>To find specific longitudes and latitude you can for example</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ipython</span>

<span class="k">def</span> <span class="nf">findJI</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple routine to find the nearest J,I coordinates for given lat lon</span>
<span class="sd">    Usage: [J,I] = findJI(49, -12, nav_lat_grid_T, nav_lon_grid_T)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dist2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">lat_grid</span> <span class="o">-</span> <span class="n">lat</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">lon_grid</span> <span class="o">-</span> <span class="n">lon</span><span class="p">)</span>
    <span class="p">[</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span> <span class="n">dist2</span><span class="o">.</span><span class="n">argmin</span><span class="p">(),</span> <span class="n">dist2</span><span class="o">.</span><span class="n">shape</span>  <span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="k">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;coordinates_ORCA_R12.nc&#39;</span>
<span class="n">nc_fid</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">nc_fid</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;nav_lat&#39;</span><span class="p">][:]</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">nc_fid</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;nav_lon&#39;</span><span class="p">][:]</span>

<span class="n">findJI</span><span class="p">(</span><span class="mf">70.0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2710</span><span class="p">,</span> <span class="mi">3559</span><span class="p">]</span>

<span class="n">findJI</span><span class="p">(</span><span class="mf">77.5</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2778</span><span class="p">,</span> <span class="mi">3339</span><span class="p">]</span>
</pre></div>
</div>
<p>It could also be useful to look at the TPXO harmonic amplitudes to find good cut off locations for boundaries. For example try</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4$ cd /work/jelt/tpxo7.2
ferret
go plot_MASSMO5_harmonics.jnl
</pre></div>
</div>
<p>In this case we are using the interval i=3339:3559/j=2670:2820 which is approximately 70.0, 30 SE corner
77.5 , 10.5 NW corner, but is squewed because of the grid. To obtain coordinates for
this domain create a namelist</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/NESTING
vim namelist.input

&amp;input_output
    iom_activated = true
/
&amp;coarse_grid_files
    parent_coordinate_file = &#39;coordinates_ORCA_R12.nc&#39;
/
&amp;bathymetry
/
&amp;nesting
    imin = 3339
    imax = 3559
    jmin = 2670
    jmax = 2820
    rho  = 3
    rhot = 3
    bathy_update = false
/
&amp;vertical_grid
/
&amp;partial_cells
/
&amp;nemo_coarse_grid
/
&amp;forcing_files
/
&amp;interp
/
&amp;restart
/
&amp;restart_trc
/
</pre></div>
</div>
<p>To build coordinates file see <span class="xref std std-ref">build_and_create_coordinates</span></p>
<p>Now copy to INPUTS</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp 1_coordinates_ORCA_R12.nc $INPUTS/coordinates.nc
</pre></div>
</div>
</div>
<div class="section" id="generate-bathymetry-file">
<h2>3) Generate bathymetry file<a class="headerlink" href="#generate-bathymetry-file" title="Permalink to this headline">¶</a></h2>
<p>For GEBCO bathymetry data head to BODC and download desired domain. Here we use 1-minute 2D dataset (2008) for 19E:66E, 39S:4S (we want the dataset to be spatially larger than the desired domain).
Copy NetCDF file to inputs e.g.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>scp GRIDONE_2D_0.0_69.0_42.0_79.0.nc $USER@login.archer.ac.uk:$INPUTS/.
</pre></div>
</div>
<p>Copy over namelist for reshaping bathymetry</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/namelist_reshape_bilin_gebco $INPUTS/.
</pre></div>
</div>
<p>Check that the lat and lon variable names are the same as in the data nc file. Now we need to flatten out the land elevations
and make the depths positive</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS

module unload cray-netcdf-hdf5parallel cray-hdf5-parallel
module load cray-netcdf cray-hdf5

module load nco/4.5.0
ncap2 -s &#39;where(elevation &gt; 0) elevation=0&#39; GRIDONE_2D_0.0_69.0_42.0_79.0.nc  tmp.nc
ncflint --fix_rec_crd -w -1.0,0.0 tmp.nc tmp.nc gebco_in.nc
rm tmp.nc
</pre></div>
</div>
<p>Restore original modules</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">unload</span> <span class="n">nco</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">netcdf</span><span class="o">-</span><span class="n">hdf5parallel</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span>
</pre></div>
</div>
<p>Execute script to map bathymetry to grid and generate remap_nemo_grid_gebco.nc
and remap_data_grid_gebco.nc files.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Execute script to generate data_nemo_bilin_gebco.nc file</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>Execute script to generate bath_meter.nc file</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$TDIR/WEIGHTS/scripinterp.exe namelist_reshape_bilin_gebco
</pre></div>
</div>
<p>This generates <code class="docutils literal"><span class="pre">bathy_meter.nc</span></code></p>
</div>
<div class="section" id="generate-a-domain-configuration-file">
<h2>4) Generate a domain configuration file<a class="headerlink" href="#generate-a-domain-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>Now generate a domain_cfg.nc file describing the vertial grid of the model.
In previous NEMO versions this would have been part of the main namelist_cfg.</p>
<p>Copy required files into DOMAINcfg directory</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $INPUTS/coordinates.nc $TDIR/DOMAINcfg/.
cp $INPUTS/bathy_meter.nc $TDIR/DOMAINcfg/.
</pre></div>
</div>
<p>Now edit the namelist_cfg file in the DOMAINcfg dirctory by following the instructions in <span class="xref std std-ref">build_domain_cfg_file.rst</span>
for your desired domain setup. Here we use a 3 level s-coordinate set up</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namrun        !   parameters of the run
!-----------------------------------------------------------------------
  nn_no       =       0   !  job number (no more used...)
  cn_exp      =  &quot;domaincfg&quot;  !  experience name
  nn_it000    =       1   !  first time step
  nn_itend    =      75   !  last  time step (std 5475)
/
!-----------------------------------------------------------------------
&amp;namcfg        !   parameters of the configuration
!-----------------------------------------------------------------------
  !
  ln_e3_dep   = .true.   ! =T : e3=dk[depth] in discret sens.
  !                       !      ===&gt;&gt;&gt; will become the only possibility in v4.0
  !                       ! =F : e3 analytical derivative of depth function
  !                       !      only there for backward compatibility test with v3.6
  !                       !
  cp_cfg      =  &quot;orca&quot;   !  name of the configuration
  jp_cfg      =    36   !  resolution of the configuration
  jpidta      =    664   !  1st lateral dimension ( &gt;= jpi )
  jpjdta      =    454   !  2nd    &quot;         &quot;    ( &gt;= jpj )
  jpkdta      =       3   !  number of levels      ( &gt;= jpk )
  jpiglo      =    664   !  1st dimension of global domain --&gt; i =jpidta
  jpjglo      =    454   !  2nd    -                  -    --&gt; j  =jpjdta
  jpizoom     =       1   !  left bottom (i,j) indices of the zoom
  jpjzoom     =       1   !  in data domain indices
  jperio      =       0   !  lateral cond. type (between 0 and 6)
/
!-----------------------------------------------------------------------
&amp;namzgr        !   vertical coordinate
!-----------------------------------------------------------------------
  ln_zco      = .false.   !  z-coordinate - full    steps
  ln_zps      = .false.   !  z-coordinate - partial steps
  ln_sco      = .true.   !  s- or hybrid z-s-coordinate
  ln_isfcav   = .false.   !  ice shelf cavity
  ln_linssh   = .false.   !  linear free surface
/
!-----------------------------------------------------------------------
&amp;namzgr_sco    !   s-coordinate or hybrid z-s-coordinate
!-----------------------------------------------------------------------
  ln_s_sh94   = .true.    !  Song &amp; Haidvogel 1994 hybrid S-sigma   (T)|
  ln_s_sf12   = .false.   !  Siddorn &amp; Furner 2012 hybrid S-z-sigma (T)| if both are false the NEMO tanh stretching is applied
  ln_sigcrit  = .false.   !  use sigma coordinates below critical depth (T) or Z coordinates (F) for Siddorn &amp; Furner stretch
                          !  stretching coefficients for all functions
  rn_sbot_min =   6.0     !  minimum depth of s-bottom surface (&gt;0) (m)
  rn_sbot_max =   100.0  !  maximum depth of s-bottom surface (= ocean depth) (&gt;0) (m)
  rn_hc       =   0.0     !  critical depth for transition to stretched coordinates
         !!!!!!!  Envelop bathymetry
  rn_rmax     =   0.3     !  maximum cut-off r-value allowed (0&lt;r_max&lt;1)
         !!!!!!!  SH94 stretching coefficients  (ln_s_sh94 = .true.)
  rn_theta    =   20.0    !  surface control parameter (0&lt;=theta&lt;=20)
  rn_bb       =   0.8     !  stretching with SH94 s-sigma
/
!-----------------------------------------------------------------------
&amp;namdom        !   space and time domain (bathymetry, mesh, timestep)
!-----------------------------------------------------------------------
  nn_msh      =    0      !  create (=1) a mesh file or not (=0)
  rn_rdt      =   100.     !  time step for the dynamics (and tracer if nn_acc=0)
  ppglam0     =  999999.0             !  longitude of first raw and column T-point (jphgr_msh = 1)
  ppgphi0     =  999999.0             ! latitude  of first raw and column T-point (jphgr_msh = 1)
  ppe1_deg    =  999999.0             !  zonal      grid-spacing (degrees)
  ppe2_deg    =  999999.0             !  meridional grid-spacing (degrees)
  ppe1_m      =  999999.0             !  zonal      grid-spacing (degrees)
  ppe2_m      =  999999.0             !  meridional grid-spacing (degrees)
  ppsur       =  999999.0             !  ORCA r4, r2 and r05 coefficients
  ppa0        =  999999.0             ! (default coefficients)
  ppa1        =  999999.0             !
  ppkth       =      23.563           !
  ppacr       =       9.0             !
  ppdzmin     =       6.0             !  Minimum vertical spacing
  pphmax      =    5720.              !  Maximum depth
  ldbletanh   =  .FALSE.              !  Use/do not use double tanf function for vertical coordinates
  ppa2        =  999999.              !  Double tanh function parameters
  ppkth2      =  999999.              !
  ppacr2      =  999999.
/
!-----------------------------------------------------------------------
&amp;nameos        !   ocean physical parameters
!-----------------------------------------------------------------------
  ln_teos10   = .true.         !  = Use TEOS-10 equation of state
/
</pre></div>
</div>
<p>Build executable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $WORK/$USER/ARCH/arch-XC_ARCHER_INTEL_XIOS1.fcm $CDIR/../ARCH/.
</pre></div>
</div>
<p>To get the new melange coordinates option to work I have copied a file into <code class="docutils literal"><span class="pre">src</span></code>. This will
eventually be in the trunk but for now:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp /work/n01/n01/jdha/2017/nemo/trunk/NEMOGCM/TOOLS/DOMAINcfg/src/domzgr.f90.jelt $TDIR/DOMAINcfg/src/domzgr.f90
</pre></div>
</div>
<p>Recompile the tool e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR
./maketools -m XC_ARCHER_INTEL_XIOS1 -n DOMAINcfg clean
./maketools -m XC_ARCHER_INTEL_XIOS1 -n DOMAINcfg
</pre></div>
</div>
<p>Build a script to run the executable (change the email)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#!/bin/bash
#PBS -N domain_cfg
#PBS -l walltime=00:20:00
#PBS -l select=1
#PBS -j oe
#PBS -A n01-ACCORD
# mail alert at (b)eginning, (e)nd and (a)bortion of execution
#PBS -m bea
#PBS -M jelt@noc.ac.uk
#! -----------------------------------------------------------------------------

# Change to the directory that the job was submitted from
cd $PBS_O_WORKDIR

# Set the number of threads to 1
#   This prevents any system libraries from automatically
#   using threading.
export OMP_NUM_THREADS=1
# Change to the directory that the job was submitted from
ulimit -s unlimited

#===============================================================
# LAUNCH JOB
#===============================================================
echo `date` : Launch Job
aprun -n 1 -N 1 ./make_domain_cfg.exe &gt;&amp;  stdouterr_cfg

exit
</pre></div>
</div>
<p>Run it</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $TDIR/DOMAINcfg
qsub -q short rs
</pre></div>
</div>
<p>Copy to EXP directory and also change permissions to ensure readable to others</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>chmod a+rx $TDIR/DOMAINcfg/domain_cfg.nc
rsync -uvt $TDIR/DOMAINcfg/domain_cfg.nc $EXP/.
rsync -uvt $TDIR/DOMAINcfg/domain_cfg.nc $INPUTS/.
</pre></div>
</div>
</div>
<div class="section" id="generate-boundary-conditions">
<h2>5) Generate boundary conditions<a class="headerlink" href="#generate-boundary-conditions" title="Permalink to this headline">¶</a></h2>
<p>livljobs4: get all the necessary files onto this machine:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $INPUTS
rsync -uvrt jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/domain_cfg.nc .
rsync -uvrt jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/coordinates.nc .
rsync -uvrt jelt@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/bathy_meter.nc .
</pre></div>
</div>
<p>Need to generate 3 more files: A <code class="docutils literal"><span class="pre">namelist.bdy</span></code> which drives PyNEMO and which
has two input files: <code class="docutils literal"><span class="pre">inputs_src.ncml</span></code> which points to the data source and
<code class="docutils literal"><span class="pre">inputs_dst.ncml</span></code> which remaps some variable names in the destination files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">../../</span><span class="n">Solent</span><span class="o">/</span><span class="n">INPUTS</span><span class="o">/</span><span class="n">namelist</span><span class="o">.</span><span class="n">bdy</span> <span class="o">.</span>
</pre></div>
</div>
<p>First install PyNEMO <a href="#id1"><span class="problematic" id="id2">`install_nrct`_</span></a> if not already done so. Use branch <code class="docutils literal"><span class="pre">Generalise-tide-input</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd /work/$USER/nrct
git checkout Generalise-tide-input
</pre></div>
</div>
<p>Copy across some parent mesh files and a mask file (even though they are not
used. This is because this old version of PyNEMO didn&#8217;t anticipate tide-only usage):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp ../../SEAsia/INPUTS/mesh_?gr_src.nc $INPUTS/.
cp ../../SEAsia/INPUTS/mask_src.nc $INPUTS/.
cp ../../SEAsia/INPUTS/inputs_dst.ncml $INPUTS/.
cp ../../SEAsia/INPUTS/cut_inputs_src.ncml $INPUTS/.
</pre></div>
</div>
<p>If I don&#8217;t make a boundary mask then it doesn&#8217;t work... This can also be done with
the PyNEMO GUI. The mask variable takes values (-1 mask, 1 wet, 0 land). Get a
template from domain_cfg.nc and then modify as desired around the boundary.</p>
<p>For this domain there was an issue with the top right corner being too near the amphidrome
(I think) so I chopped it out here:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">nco</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">4.4</span><span class="o">.</span><span class="mf">2.</span><span class="n">ncwa</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">bdy_mask</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncks</span> <span class="o">-</span><span class="n">v</span> <span class="n">top_level</span> <span class="n">domain_cfg</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncrename</span> <span class="o">-</span><span class="n">h</span> <span class="o">-</span><span class="n">v</span> <span class="n">top_level</span><span class="p">,</span><span class="n">mask</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">nc</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">nc</span>
<span class="n">ncwa</span> <span class="o">-</span><span class="n">a</span> <span class="n">t</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">nc</span> <span class="n">bdy_mask</span><span class="o">.</span><span class="n">nc</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>In ipython:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">netCDF4</span><span class="o">,</span> <span class="nn">numpy</span>
<span class="n">dset</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="s1">&#39;bdy_mask.nc&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>     <span class="c1"># Southern boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>    <span class="c1"># Northern boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>    <span class="c1"># Eastern boundary</span>
<span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>        <span class="c1"># Western boundary</span>

<span class="n">ny</span><span class="p">,</span><span class="n">nx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:])</span>

<span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="n">ny</span><span class="p">]</span>
<span class="p">[</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nx</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">nx</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">ny</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span> <span class="o">-</span><span class="n">y1</span><span class="o">*</span><span class="n">x2</span><span class="o">+</span><span class="n">y2</span><span class="o">*</span><span class="n">x1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">dset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Couldn&#8217;t find the FES data (they have moved from Tom&#8217;s work dir). Tide data source
is clumsily set in <code class="docutils literal"><span class="pre">nemo_bdy_tide3.py</span></code></p>
<dl class="docutils">
<dt>::</dt>
<dd><p class="first">vi namelist.bdy</p>
<p>!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
!! NEMO/OPA  : namelist for BDY generation tool
!!
!!             User inputs for generating open boundary conditions
!!             employed by the BDY module in NEMO. Boundary data
!!             can be set up for v3.2 NEMO and above.
!!
!!             More info here.....
!!
!!&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</p>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!   vertical coordinate
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div><p>ln_zco      = .true.   !  z-coordinate - full    steps   (T/F)
ln_zps      = .false.    !  z-coordinate - partial steps   (T/F)
ln_sco      = .false.   !  s- or hybrid z-s-coordinate    (T/F)
rn_hmin     =   -5     !  min depth of the ocean (&gt;0) or</p>
<blockquote>
<div>!  min number of ocean level (&lt;0)</div></blockquote>
</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!   s-coordinate or hybrid z-s-coordinate
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div><p>rn_sbot_min =   10.     !  minimum depth of s-bottom surface (&gt;0) (m)
rn_sbot_max = 7000.     !  maximum depth of s-bottom surface</p>
<blockquote>
<div>!  (= ocean depth) (&gt;0) (m)</div></blockquote>
<p>ln_s_sigma  = .false.   !  hybrid s-sigma coordinates
rn_hc       =  50.0    !  critical depth with s-sigma</p>
</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  grid information
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>sn_src_hgr = &#8216;./mesh_hgr_src.nc&#8217;   !  parent /grid/
sn_src_zgr = &#8216;./mesh_zgr_src.nc&#8217;   !  parent
sn_dst_hgr = &#8216;./domain_cfg.nc&#8217;
sn_dst_zgr = &#8216;./inputs_dst.ncml&#8217; ! rename output variables
sn_src_msk = &#8216;./mask_src.nc&#8217;       ! parent
sn_bathy   = &#8216;./bathy_meter.nc&#8217;</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  I/O
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>sn_src_dir = &#8216;./cut_inputs_src.ncml&#8217;       ! src_files/&#8217;
sn_dst_dir = &#8216;/work/jelt/NEMO/MASSMO5_surge/INPUTS/&#8217;
sn_fn      = &#8216;MASSMO5&#8217;                 ! prefix for output files
nn_fv      = -1e20                     !  set fill value for output files
nn_src_time_adj = 0                                    ! src time adjustment
sn_dst_metainfo = &#8216;metadata info: jelt&#8217;</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  unstructured open boundaries
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>ln_coords_file = .false.               !  =T : produce bdy coordinates files
cn_coords_file = &#8216;coordinates.bdy.nc&#8217; !  name of bdy coordinates files (if ln_coords_file=.TRUE.)
ln_mask_file   = .true.              !  =T : read mask from file
cn_mask_file   = &#8216;./bdy_mask.nc&#8217;                   !  name of mask file (if ln_mask_file=.TRUE.)
ln_dyn2d       = .false.               !  boundary conditions for barotropic fields
ln_dyn3d       = .false.               !  boundary conditions for baroclinic velocities
ln_tra         = .false.               !  boundary conditions for T and S
ln_ice         = .false.               !  ice boundary condition
nn_rimwidth    = 1                    !  width of the relaxation zone</div></blockquote>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  unstructured open boundaries tidal parameters
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<blockquote>
<div>ln_tide        = .true.               !  =T : produce bdy tidal conditions</div></blockquote>
<p>!TESTING
!               clname(1) =&#8217;M2&#8217;
!               clname(2)=&#8217;S2&#8217;
!               clname(3)=&#8217;K2&#8217;
!FES</p>
<blockquote>
<div>clname(1) =&#8216;2N2&#8217;
clname(2)=&#8217;EPS2&#8217;
clname(3)=&#8217;J1&#8217;
clname(4)=&#8217;K1&#8217;
clname(5)=&#8217;K2&#8217;
clname(6)=&#8217;L2&#8217;
clname(7)=&#8217;LA2&#8217;
clname(8)=&#8217;M2&#8217;
clname(9)=&#8217;M3&#8217;
clname(10)=&#8217;M4&#8217;
clname(11)=&#8217;M6&#8217;
clname(12)=&#8217;M8&#8217;
clname(13)=&#8217;MF&#8217;
clname(14)=&#8217;MKS2&#8217;
clname(15)=&#8217;MM&#8217;
clname(16)=&#8217;MN4&#8217;
clname(17)=&#8217;MS4&#8217;
clname(18)=&#8217;MSF&#8217;
clname(19)=&#8217;MSQM&#8217;
clname(20)=&#8217;MTM&#8217;
clname(21)=&#8217;MU2&#8217;
clname(22)=&#8217;N2&#8217;
clname(23)=&#8217;N4&#8217;
clname(24)=&#8217;NU2&#8217;
clname(25)=&#8217;O1&#8217;
clname(26)=&#8217;P1&#8217;
clname(27)=&#8217;Q1&#8217;
clname(28)=&#8217;R2&#8217;
clname(29)=&#8217;S1&#8217;
clname(30)=&#8217;S2&#8217;
clname(31)=&#8217;S4&#8217;
clname(32)=&#8217;SA&#8217;
clname(33)=&#8217;SSA&#8217;
clname(34)=&#8217;T2&#8217;</div></blockquote>
<p>ln_trans       = .false.
sn_tide_h     = &#8216;&#8217;
sn_tide_u     = &#8216;&#8217;</p>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  Time information
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
nn_year_000     = 1979        !  year start
nn_year_end     = 1979        !  year end
nn_month_000    = 11          !  month start (default = 1 is years&gt;1)
nn_month_end    = 11          !  month end (default = 12 is years&gt;1)
sn_dst_calendar = &#8216;gregorian&#8217; !  output calendar format
nn_base_year    = 1978        !  base year for time counter
sn_tide_grid    = &#8216;/work/jelt/tpxo7.2/grid_tpxo7.2.nc&#8217;</p>
<p>!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
!  Additional parameters
!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
nn_wei  = 1                   !  smoothing filter weights
rn_r0   = 0.041666666         !  decorrelation distance use in gauss</p>
<blockquote>
<div>!  smoothing onto dst points. Need to
!  make this a funct. of dlon</div></blockquote>
<dl class="docutils">
<dt>sn_history  = &#8216;bdy files produced by jelt from ORCA0083-N01&#8217;</dt>
<dd>!  history for netcdf file</dd>
</dl>
<p class="last">ln_nemo3p4  = .true.          !  else presume v3.2 or v3.3
nn_alpha    = 0               !  Euler rotation angle
nn_beta     = 0               !  Euler rotation angle
nn_gamma    = 0               !  Euler rotation angle
rn_mask_max_depth = 7000.0    !  Maximum depth to be ignored for the mask
rn_mask_shelfbreak_dist = 60    !  Distance from the shelf break</p>
</dd>
</dl>
<p>Generate the boundary conditions with PyNEMO</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module load anaconda/2.1.0  # Want python2
source activate nrct_env
cd $INPUTS
export LD_LIBRARY_PATH=/usr/lib/jvm/jre-1.7.0-openjdk.x86_64/lib/amd64/server:$LD_LIBRARY_PATH
export PYTHONPATH=/login/$USER/.conda/envs/nrct_env/lib/python2.7/site-packages/:$PYTHONPATH

pynemo -s namelist.bdy
</pre></div>
</div>
<p>This creates:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MASSMO5_bdytide_rotT_NU2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_O1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_P1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_Q1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MTM_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MU2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_N2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_N4_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_R2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_S1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_2N2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_J1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_EPS2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_K2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_K1_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_LA2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_L2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M3_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M6_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M4_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MF_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M8_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MM_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MKS2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MS4_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MN4_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MSQM_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MSF_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_S4_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_S2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_T2_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_SSA_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_SA_grid_T</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_NU2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_O1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_P1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_Q1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MTM_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MU2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_N2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_N4_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_R2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_S1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_2N2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_J1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_EPS2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_K2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_K1_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_LA2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_L2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M3_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M6_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M4_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MF_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M8_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MM_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MKS2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MS4_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MN4_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MSQM_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MSF_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_S4_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_S2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_T2_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_SSA_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_SA_grid_U</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_NU2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_O1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_P1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_Q1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MTM_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MU2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_N2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_N4_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_R2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_S1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_2N2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_J1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_EPS2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_K2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_K1_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_LA2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_L2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M3_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M6_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M4_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MF_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_M8_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MM_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MKS2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MS4_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MN4_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MSQM_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_MSF_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_S4_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_S2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_T2_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_SSA_grid_V</span><span class="o">.</span><span class="n">nc</span>
<span class="n">MASSMO5_bdytide_rotT_SA_grid_V</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Copy the new files back onto ARCHER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>livljobs4$
cd $INPUTS
rsync -utv coordinates.bdy.nc $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/coordinates.bdy.nc
#for file in $CONFIG*nc; do rsync -utv $file $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/$file ; done
for file in MASSMO5*nc; do rsync -utv $file $USER@login.archer.ac.uk:/work/n01/n01/$USER/$CONFIG/INPUTS/$file ; done
</pre></div>
</div>
</div>
<div class="section" id="running-model-with-tidal-forcing-at-the-boundaries-on-archer">
<h2>6) Running model with tidal forcing at the boundaries on ARCHER<a class="headerlink" href="#running-model-with-tidal-forcing-at-the-boundaries-on-archer" title="Permalink to this headline">¶</a></h2>
<p>Copy files to EXP directory</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP
rsync -tuv $INPUTS/bathy_meter.nc $EXP/.
rsync -tuv $INPUTS/coordinates.nc $EXP/.
rsync -tuv $INPUTS/coordinates.bdy.nc $EXP/.
</pre></div>
</div>
<p>Link to the tide data</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln -s $INPUTS $EXP/bdydta
</pre></div>
</div>
<p>Edit the namelist_cfg file. <strong>Note additions for key_diaharm_fast</strong> <cite>&lt;FES2014_NEMO.rst&gt;_</cite>
Also note additional love number <code class="docutils literal"><span class="pre">dn_love_number</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namrun        !   parameters of the run
!-----------------------------------------------------------------------
  cn_exp      =  &quot;MASSMO5_surge&quot;  !  experience name
  nn_it000    = 1   !  first time step
  nn_itend    = 7200     !  last  time step (for dt = 6 min, 240*dt = 1 day)
  nn_date0    =  20130101 !  date at nit_0000 (format yyyymmdd) used if ln_rstart=F or (ln_rstart=T and nn_rstctl=0 or 1)
  nn_time0    =       0   !  initial time of day in hhmm
  nn_leapy    =       1   !  Leap year calendar (1) or not (0)
  ln_rstart   =  .false.  !  start from rest (F) or from a restart file (T)
    nn_euler    =    1            !  = 0 : start with forward time step if ln_rstart=T
    nn_rstctl   =    2            !  restart control ==&gt; activated only if ln_rstart=T
    !                             !    = 0 nn_date0 read in namelist ; nn_it000 : read in namelist
    !                             !    = 1 nn_date0 read in namelist ; nn_it000 : check consistancy between namelist and restart
    !                             !    = 2 nn_date0 read in restart  ; nn_it000 : check consistancy between namelist and restart
    cn_ocerst_in    = &quot;MASSMO5_surge_00014400_restart&quot;   !  suffix of ocean restart name (input)
    cn_ocerst_indir = &quot;./Restart_files&quot;         !  directory from which to read input ocean restarts
    cn_ocerst_out   = &quot;restart&quot;   !  suffix of ocean restart name (output)
    cn_ocerst_outdir= &quot;./Restart_files&quot;         !  directory in which to write output ocean restarts
  nn_istate   =       0   !  output the initial state (1) or not (0)
  nn_stock    =  7200  ! 9500    !  frequency of creation of a restart file (modulo referenced to 1)
  nn_write    =  7200  ! 9500    !  frequency of write in the output file   (modulo referenced to nit000)
/
!-----------------------------------------------------------------------
&amp;namcfg        !   parameters of the configuration
!-----------------------------------------------------------------------
   ln_read_cfg = .true.   !  (=T) read the domain configuration file
                          !  (=F) user defined configuration  ==&gt;&gt;&gt;  see usrdef(_...) modules
   cn_domcfg = &quot;domain_cfg&quot;         ! domain configuration filename
/
!-----------------------------------------------------------------------
&amp;namdom        !   space and time domain (bathymetry, mesh, timestep)
!-----------------------------------------------------------------------
   ln_2d        = .true.  !  (=T) run in 2D barotropic mode (no tracer processes or vertical diffusion)
   rn_rdt      =   100.    !  time step for the dynamics (and tracer if nn_acc=0)
/

!-----------------------------------------------------------------------
&amp;namtsd    !   data : Temperature  &amp; Salinity
!-----------------------------------------------------------------------
   ln_tsd_init   = .false.   !  Initialisation of ocean T &amp; S with T &amp;S input data (T) or not (F)
   ln_tsd_tradmp = .false.   !  damping of ocean T &amp; S toward T &amp;S input data (T) or not (F)
/
!-----------------------------------------------------------------------
&amp;namsbc        !   Surface Boundary Condition (surface module)
!-----------------------------------------------------------------------
   nn_fsbc     = 1         !  frequency of surface boundary condition computation
                           !     (also = the frequency of sea-ice model call)
   ln_usr = .true.
   ln_blk =  .false.
   ln_apr_dyn  = .false.    !  Patm gradient added in ocean &amp; ice Eqs.   (T =&gt; fill namsbc_apr )
   nn_ice      = 0         !  =0 no ice boundary condition   ,
   ln_rnf      = .false.   !  Runoffs                                   (T =&gt; fill namsbc_rnf)
   ln_ssr      = .false.   !  Sea Surface Restoring on T and/or S       (T =&gt; fill namsbc_ssr)
   ln_traqsr   = .false.   !  Light penetration in the ocean            (T =&gt; fill namtra_qsr)
   nn_fwb      = 0         !  FreshWater Budget: =0 unchecked
/
!-----------------------------------------------------------------------
&amp;namsbc_usr  !   namsbc_surge   surge model fluxes
!-----------------------------------------------------------------------
   ln_use_sbc  = .false.    ! (T) to turn on surge fluxes (wind and pressure only)
                            ! (F) for no fluxes (ie tide only case)

!
!              !  file name                    ! frequency (hours) ! variable  ! time interp. !  clim  ! &#39;yearly&#39;/ ! weights  ! rotation !
!              !                               !  (if &lt;0  months)  !   name    !   (logical)  !  (T/F) ! &#39;monthly&#39; ! filename ! pairing  !
   sn_wndi     = &#39;windspd_u_amm7&#39;              ,       1           ,&#39;x_wind&#39;,   .true.     , .false. , &#39;daily&#39;  ,&#39;&#39; , &#39;&#39;
   sn_wndj     = &#39;windspd_v_amm7&#39;              ,       1           ,&#39;y_wind&#39;,   .true.     , .false. , &#39;daily&#39;  ,&#39;&#39; , &#39;&#39;
   cn_dir      = &#39;./fluxes/&#39;          !  root directory for the location of the bulk files
   rn_vfac     = 1.                   !  multiplicative factor for ocean/ice velocity
                                      !  in the calculation of the wind stress (0.=absolute winds or 1.=relative winds)
   rn_charn_const = 0.0275
/
!-----------------------------------------------------------------------
&amp;namtra_qsr    !   penetrative solar radiation
!-----------------------------------------------------------------------
   ln_traqsr   = .false.   !  Light penetration (T) or not (F)
   nn_chldta   =      0    !  RGB : Chl data (=1) or cst value (=0)
/
!-----------------------------------------------------------------------
&amp;namsbc_apr    !   Atmospheric pressure used as ocean forcing or in bulk
!-----------------------------------------------------------------------
!          !  file name  ! frequency (hours) ! variable  ! time interp. !  clim  ! &#39;yearly&#39;/ ! weights  ! rotation ! land/sea mask !
!          !             !  (if &lt;0  months)  !   name    !   (logical)  !  (T/F) ! &#39;monthly&#39; ! filename ! pairing  ! filename      !
   sn_apr= &#39;pressure_amm7&#39;,        1         ,   &#39;air_pressure_at_sea_level&#39; ,    .true.    , .false., &#39;daily&#39;   ,  &#39;&#39;      ,   &#39;&#39;     ,  &#39;&#39;
   cn_dir      = &#39;./fluxes/&#39;!  root directory for the location of the bulk files
   rn_pref     = 101200.    !  reference atmospheric pressure   [N/m2]/
   ln_ref_apr  = .false.    !  ref. pressure: global mean Patm (T) or a constant (F)
   ln_apr_obc  = .true.     !  inverse barometer added to OBC ssh data
/
!-----------------------------------------------------------------------
&amp;namlbc        !   lateral momentum boundary condition
!-----------------------------------------------------------------------
!   rn_shlat    =     0     !  shlat = 0  !  0 &lt; shlat &lt; 2  !  shlat = 2  !  2 &lt; shlat
                           !  free slip  !   partial slip  !   no slip   ! strong slip
/
!-----------------------------------------------------------------------
&amp;nam_tide      !   tide parameters
!-----------------------------------------------------------------------
   ln_tide     = .true.
   ln_tide_ramp = .true.
   rdttideramp =    0.1666  ! 4 hours
   dn_love_number = 0.69
   clname(1) =&#39;2N2&#39;
   clname(2)=&#39;EPS2&#39;
   clname(3)=&#39;J1&#39;
   clname(4)=&#39;K1&#39;
   clname(5)=&#39;K2&#39;
   clname(6)=&#39;L2&#39;
   clname(7)=&#39;LA2&#39;
   clname(8)=&#39;M2&#39;
   clname(9)=&#39;M3&#39;
   clname(10)=&#39;M4&#39;
   clname(11)=&#39;M6&#39;
   clname(12)=&#39;M8&#39;
   clname(13)=&#39;MF&#39;
   clname(14)=&#39;MKS2&#39;
   clname(15)=&#39;MM&#39;
   clname(16)=&#39;MN4&#39;
   clname(17)=&#39;MS4&#39;
   clname(18)=&#39;MSF&#39;
   clname(19)=&#39;MSQM&#39;
   clname(20)=&#39;MTM&#39;
   clname(21)=&#39;MU2&#39;
   clname(22)=&#39;N2&#39;
   clname(23)=&#39;N4&#39;
   clname(24)=&#39;NU2&#39;
   clname(25)=&#39;O1&#39;
   clname(26)=&#39;P1&#39;
   clname(27)=&#39;Q1&#39;
   clname(28)=&#39;R2&#39;
   clname(29)=&#39;S1&#39;
   clname(30)=&#39;S2&#39;
   clname(31)=&#39;S4&#39;
   clname(32)=&#39;SA&#39;
   clname(33)=&#39;SSA&#39;
   clname(34)=&#39;T2&#39;
/
!-----------------------------------------------------------------------
&amp;nambdy        !  unstructured open boundaries
!-----------------------------------------------------------------------
   ln_bdy     = .true.
   nb_bdy         = 1                    !  number of open boundary sets
   cn_coords_file = &#39;bdydta/coordinates.bdy.nc&#39; !  bdy coordinates files
   cn_dyn2d       = &#39;flather&#39;            !
   nn_dyn2d_dta   =  2                   !  = 0, bdy data are equal to the initial state
                                         !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
                                         !  = 2, use tidal harmonic forcing data from files
                                         !  = 3, use external data AND tidal harmonic forcing
   cn_tra        =  &#39;frs&#39;                !
   nn_tra_dta    =  0                    !  = 0, bdy data are equal to the initial state
                                         !  = 1, bdy data are read in &#39;bdydata   .nc&#39; files
   nn_rimwidth   = 1                    !  width of the relaxation zone
/
!-----------------------------------------------------------------------
&amp;nambdy_tide     ! tidal forcing at open boundaries
!-----------------------------------------------------------------------
   filtide      = &#39;bdydta/MASSMO5_bdytide_rotT_&#39;         !  file name root of tidal forcing files
   ln_bdytide_2ddta = .false.
/
!-----------------------------------------------------------------------
&amp;nambfr        !   bottom friction
!-----------------------------------------------------------------------
   nn_bfr      =    2      !  type of bottom friction :   = 0 : free slip,  = 1 : linear friction
                           !                              = 2 : nonlinear friction
   rn_bfri2    =    2.4e-2 !  bottom drag coefficient (non linear case)
   rn_bfeb2    =    0.0e0  !  bottom turbulent kinetic energy background  (m2/s2)
   ln_loglayer =   .false. !  loglayer bottom friction (only effect when nn_bfr = 2)
   rn_bfrz0    =    0.003  !  bottom roughness (only effect when ln_loglayer = .true.)
/
!-----------------------------------------------------------------------
&amp;nambbc        !   bottom temperature boundary condition
!-----------------------------------------------------------------------
   ln_trabbc   = .false.   !  Apply a geothermal heating at the ocean bottom
/
!-----------------------------------------------------------------------
&amp;nambbl        !   bottom boundary layer scheme
!-----------------------------------------------------------------------
   nn_bbl_ldf  =  0      !  diffusive bbl (=1)   or not (=0)
/
!-----------------------------------------------------------------------
&amp;nameos        !   ocean physical parameters
!-----------------------------------------------------------------------
   ln_teos10   = .true.         !  = Use TEOS-10 equation of state
/
!-----------------------------------------------------------------------
&amp;namdyn_vor    !   option of physics/algorithm (not control by CPP keys)
!-----------------------------------------------------------------------
   ln_dynvor_een = .true.  !  energy &amp; enstrophy scheme
/
!-----------------------------------------------------------------------
&amp;namdyn_hpg    !   Hydrostatic pressure gradient option
!-----------------------------------------------------------------------
   ln_hpg_zps  = .false.   !  z-coordinate - partial steps (interpolation)
   ln_hpg_sco  = .true.    !  s-coordinate (Standard Jacobian scheme)
/
!-----------------------------------------------------------------------
&amp;namdyn_spg    !   surface pressure gradient   (CPP key only)
!-----------------------------------------------------------------------
   ln_dynspg_ts = .true.    ! split-explicit free surface
   ln_bt_auto =    .true.           !  Set nn_baro automatically to be just below
                                       !  a user defined maximum courant number (rn_bt_cmax)
/
!-----------------------------------------------------------------------
&amp;namdyn_ldf    !   lateral diffusion on momentum
!-----------------------------------------------------------------------
   !                       !  Type of the operator :
   ln_dynldf_blp  =  .true.   !  bilaplacian operator
   ln_dynldf_lap   = .false.  !  bilaplacian operator
   !                       !  Direction of action  :
   ln_dynldf_lev  =  .true.   !  iso-level
                           !  Coefficient
   rn_ahm_0     = 60.0      !  horizontal laplacian eddy viscosity   [m2/s]
   rn_bhm_0     = -1.0e+9   !  horizontal bilaplacian eddy viscosity [m4/s]
/
!-----------------------------------------------------------------------
&amp;namzdf        !   vertical physics
!-----------------------------------------------------------------------
   rn_avm0     =   0.1e-6  !  vertical eddy viscosity   [m2/s]          (background Kz if not &quot;key_zdfcst&quot;)
   rn_avt0     =   0.1e-6  !  vertical eddy diffusivity [m2/s]          (background Kz if not &quot;key_zdfcst&quot;)
   ln_zdfevd   = .false.   !  enhanced vertical diffusion (evd) (T) or not (F)
   nn_evdm     =    1      !  evd apply on tracer (=0) or on tracer and momentum (=1)
/
!-----------------------------------------------------------------------
&amp;nam_diaharm   !   Harmonic analysis of tidal constituents (&#39;key_diaharm&#39;)
!-----------------------------------------------------------------------
    nit000_han = 1     ! First time step used for harmonic analysis
    nitend_han = 43200     ! Last time step used for harmonic analysis
    nstep_han  = 5         ! Time step frequency for harmonic analysis
    tname(1)   = &#39;M2&#39;      ! Name of tidal constituents
    tname(2)   = &#39;S2&#39;
    tname(3)   = &#39;K2&#39;
/
!-----------------------------------------------------------------------
&amp;nam_diaharm_fast   !   Harmonic analysis of tidal constituents               (&quot;key_diaharm_fast&quot;)
!-----------------------------------------------------------------------
    ln_diaharm_store = .false.
    ln_diaharm_compute = .false.
    ln_diaharm_read_restart = .false.
    ln_ana_ssh   = .true.
    ln_ana_uvbar = .false.
    ln_ana_bfric = .false.
    ln_ana_rho  = .false.
    ln_ana_uv3d = .false.
    ln_ana_w3d  = .false.
    tname(1) = &#39;M2&#39;
    tname(2) = &#39;S2&#39;
    tname(3) = &#39;K2&#39;
/
!-----------------------------------------------------------------------
&amp;namwad       !   Wetting and Drying namelist
!-----------------------------------------------------------------------
   ln_wd = .false.   !: key to turn on/off wetting/drying (T: on, F: off)
   rn_wdmin1=0.1     !: minimum water depth on dried cells
   rn_wdmin2 = 0.01  !: tolerrance of minimum water depth on dried cells
   rn_wdld   = 20.0  !: land elevation below which wetting/drying will be considered
   nn_wdit   =   10  !: maximum number of iteration for W/D limiter
/
</pre></div>
</div>
</div>
<div class="section" id="output-xml-and-running">
<h2>9) Output xml and running<a class="headerlink" href="#output-xml-and-running" title="Permalink to this headline">¶</a></h2>
<p>Edit to have 1 hr SSH output</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi file_def_nemo.xml
  ...
  &lt;file_definition type=&quot;one_file&quot; name=&quot;@expname@_@freq@_@startdate@_@enddate@&quot; sync_freq=&quot;10d&quot; min_digits=&quot;4&quot;&gt;
  ...
  &lt;file_group id=&quot;1h&quot; output_freq=&quot;1h&quot;  output_level=&quot;10&quot; enabled=&quot;.TRUE.&quot;&gt; &lt;!-- 1h files --&gt;
   &lt;file id=&quot;file120&quot; name_suffix=&quot;_SSH&quot; description=&quot;ocean T grid variables&quot; &gt;
    &lt;field field_ref=&quot;ssh&quot;          name=&quot;zos&quot; operation=&quot;instant&quot;     /&gt;
   &lt;/file&gt;
  &lt;/file_group&gt;
&lt;!--
  &lt;file_group id=&quot;tidal_harmonics&quot; output_freq=&quot;1h&quot;  output_level=&quot;10&quot; enabled=&quot;.TRUE.&quot;&gt;
  &lt;file id=&quot;tidalanalysis.grid_T&quot; name=&quot;harmonic_grid_T&quot; description=&quot;ocean T grid variables&quot;  enabled=&quot;.TRUE.&quot;&gt;
    &lt;field field_ref=&quot;S2amp_ssh&quot; name=&quot;S2amp_ssh&quot;       operation=&quot;instant&quot; enabled=&quot;.TRUE.&quot; /&gt;
    &lt;field field_ref=&quot;S2pha_ssh&quot; name=&quot;S2pha_ssh&quot;     operation=&quot;instant&quot; enabled=&quot;.TRUE.&quot; /&gt;
    &lt;field field_ref=&quot;M2amp_ssh&quot; name=&quot;M2amp_ssh&quot;       operation=&quot;instant&quot; enabled=&quot;.TRUE.&quot; /&gt;
    &lt;field field_ref=&quot;M2pha_ssh&quot; name=&quot;M2pha_ssh&quot;     operation=&quot;instant&quot; enabled=&quot;.TRUE.&quot; /&gt;
    &lt;field field_ref=&quot;K2amp_ssh&quot; name=&quot;K2amp_ssh&quot;       operation=&quot;instant&quot; enabled=&quot;.TRUE.&quot; /&gt;
    &lt;field field_ref=&quot;K2pha_ssh&quot; name=&quot;MKpha_ssh&quot;     operation=&quot;instant&quot; enabled=&quot;.TRUE.&quot; /&gt;
  &lt;/file&gt;
  &lt;file id=&quot;tidalanalysis.grid_U&quot; name=&quot;harmonic_grid_U&quot; description=&quot;ocean U grid variables&quot;  enabled=&quot;.TRUE.&quot;&gt;
        &lt;field id=&quot;S2amp_u2d&quot;    long_name=&quot;S2 u2D harmonic Amplitude&quot;     unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;S2pha_u2d&quot;    long_name=&quot;S2 u2D harmonic Phase&quot;         unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;M2amp_u2d&quot;    long_name=&quot;M2 u2D harmonic Amplitude&quot;     unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;M2pha_u2d&quot;    long_name=&quot;M2 u2D harmonic Phase&quot;         unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;K2amp_u2d&quot;    long_name=&quot;K2 u2D harmonic Amplitude&quot;     unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;K2pha_u2d&quot;    long_name=&quot;K2 u2D harmonic Phase&quot;         unit=&quot;m/s&quot;      /&gt;
  &lt;/file&gt;
  &lt;file id=&quot;tidalanalysis.grid_V&quot; name=&quot;harmonic_grid_V&quot; description=&quot;ocean V grid variables&quot;  enabled=&quot;.TRUE.&quot;&gt;
        &lt;field id=&quot;S2amp_v2d&quot;     long_name=&quot;S2 v2D harmonic Amplitude&quot;     unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;S2pha_v2d&quot;     long_name=&quot;S2 v2D harmonic Phase&quot;         unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;M2amp_v2d&quot;     long_name=&quot;M2 v2D harmonic Amplitude&quot;     unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;M2pha_v2d&quot;     long_name=&quot;M2 v2D harmonic Phase&quot;         unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;K2amp_v2d&quot;     long_name=&quot;K2 v2D harmonic Amplitude&quot;     unit=&quot;m/s&quot;      /&gt;
        &lt;field id=&quot;K2pha_v2d&quot;     long_name=&quot;K2 v2D harmonic Phase&quot;         unit=&quot;m/s&quot;      /&gt;
  &lt;/file&gt;
  &lt;/file_group&gt;
--&gt;
    ...

 &lt;/file_definition&gt;
</pre></div>
</div>
<p>Get field_def_nemo-opa.xml:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp $START_FILES/field_def_nemo-opa.xml $EXP/.
</pre></div>
</div>
<p>Ensure that file_def_nemo.xml is pointed to</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vim context_nemo.xml
...
&lt;!--
==============================================================================================
    NEMO context
==============================================================================================
--&gt;
&lt;context id=&quot;nemo&quot;&gt;
&lt;!-- $id$ --&gt;
&lt;!-- Fields definition --&gt;
    &lt;field_definition src=&quot;./field_def_nemo-opa.xml&quot;/&gt;   &lt;!--  NEMO ocean dynamics                     --&gt;

&lt;!-- Files definition --&gt;
    &lt;file_definition src=&quot;./file_def_nemo.xml&quot;/&gt;     &lt;!--  NEMO ocean dynamics                     --&gt;
    &lt;!--
...
&lt;/context&gt;
</pre></div>
</div>
<p>Create short queue runscript (Change the email address)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#!/bin/bash
# ---------------------------
#===============================================================
# CLUSTER BITS
#===============================================================
#PBS -N MASSMO5Surg
#PBS -l select=5
#PBS -l walltime=00:20:00
#PBS -A n01-ACCORD
#PBS -j oe
#PBS -r n
# mail alert at (b)eginning, (e)nd and (a)bortion of execution
#PBS -m bea
#PBS -M jelt@noc.ac.uk

module swap PrgEnv-cray PrgEnv-intel
module load cray-netcdf-hdf5parallel
module load cray-hdf5-parallel

export PBS_O_WORKDIR=$(readlink -f $PBS_O_WORKDIR)
# Change to the direcotry that the job was submitted from
cd $PBS_O_WORKDIR


# Set the number of threads to 1
#   This prevents any system libraries from automatically
#   using threading.
export OMP_NUM_THREADS=1
# Change to the directory that the job was submitted from
ulimit -s unlimited
ulimit -c unlimited

export NEMOproc=96 #550
export XIOSproc=1

#===============================================================
# LAUNCH JOB
#===============================================================
echo `date` : Launch Job
aprun -b -n 5 -N 5 ./xios_server.exe : -n $NEMOproc -N 24 ./opa
exit
</pre></div>
</div>
<p>Submit the job</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $EXP
qsub -q short runscript
</pre></div>
</div>
<p>&#8212;</p>
<div class="section" id="progress">
<h3>progress<a class="headerlink" href="#progress" title="Permalink to this headline">¶</a></h3>
<p>H = 3.3km &#8211;&gt; sqrt(g.H) = 182 m/s
dx = 3km &#8211;&gt;  rn_rdt = 16.5</p>
<p>Try
rn_rdt = 50 &#8211;&gt; blows up
rn_rdt = 15 so that 7200 is just more than 1 day (ramp length)</p>
<ul>
<li><p class="first">Spin up:</p>
<p>nn_it000    = 1   !  first time step
nn_itend    = 57600 ! 10 days
ln_restart = .false.</p>
<blockquote>
<div><p>cn_ocerst_in    = &#8220;MASSMO5_surge_00057600_restart&#8221;   !  suffix of ocean restart name (input)</p>
</div></blockquote>
<p>nn_stock    =  57600      !  frequency of creation of a restart file (modulo referenced to 1)
nn_write    =  57600      !  frequency of write in the output file   (modulo referenced to nit000)</p>
<p>ln_tide_ramp = .false.
rdttideramp =    1.
rn_bfri2 = 2.4e-2 ! increased by 10
ln_dynldf_blp  =  .true.   !  bilaplacian operator
rn_bhm_0     = -1.0e+9   !  horizontal bilaplacian eddy viscosity [m4/s]</p>
</li>
</ul>
<p>12mins 51</p>
<p><em>15 June 2018</em>
With the forcing cutting off the corner there ends up being two domains. One that
I want and a bad corner, which is water, and does its own thing. Hopefully it can be
ignored and doesn&#8217;t break the simulation. Couldn&#8217;t figure out how to mask it without
changing the bathymetry.</p>
<ul>
<li><p class="first">Production run (changes) 30 days 57600 + 172,800:</p>
<p>nn_it000    = 57601   !  first time step
nn_itend    = 230400  ! plus 30 days
ln_restart = .true.
ln_tide_ramp = .false.</p>
</li>
</ul>
<p>Submit for an 1hr. Completed in 38mins
<strong>PENDING</strong></p>
<p>Looks reasonable. Test harmonic analysis:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg_AMM60
...
nn_it000    = 230401    !  first time step
nn_itend    = 403200  ! plus 30 days
cn_ocerst_in    = &quot;MASSMO5_surge_00230400_restart&quot;   !  suffix of ocean restart name (input)
nn_stock    =  172800  ! 30 days  !  frequency of creation of a restart file (modulo referenced to 1)
nn_write    =  172800  ! 30 days  !  frequency of write in the output file   (modulo referenced to nit000)
...
!-----------------------------------------------------------------------
&amp;nam_diaharm   !   Harmonic analysis of tidal constituents (&#39;key_diaharm&#39;)
!-----------------------------------------------------------------------
    nit000_han = 230401      ! First time step used for harmonic analysis
    nitend_han = 403200 ! 30 days    ! Last time step used for harmonic analysis
    nstep_han  = 20 ! 5 mins         ! Time step frequency for harmonic analysis
    tname(1)=&#39;K1&#39;
    tname(2)=&#39;K2&#39;
    tname(3)=&#39;M2&#39;
    tname(4)=&#39;M4&#39;
    tname(5)=&#39;N2&#39;
    tname(6)=&#39;O1&#39;
    tname(7)=&#39;P1&#39;
    tname(8)=&#39;Q1&#39;
    tname(9)=&#39;S2&#39;
/
!-----------------------------------------------------------------------
&amp;nam_diaharm_fast   !   Harmonic analysis of tidal constituents               (&quot;key_diaharm_fast&quot;)
!-----------------------------------------------------------------------
    ln_diaharm_store = .true.
    ln_diaharm_compute = .true.
    ln_diaharm_read_restart = .false.
    ln_ana_ssh   = .true.
    ln_ana_uvbar = .true.
    ln_ana_bfric = .false.
    ln_ana_rho  = .false.
    ln_ana_uv3d = .false.
    ln_ana_w3d  = .false.
    tname(1)=&#39;K1&#39;
    tname(2)=&#39;K2&#39;
    tname(3)=&#39;M2&#39;
    tname(4)=&#39;M4&#39;
    tname(5)=&#39;N2&#39;
    tname(6)=&#39;O1&#39;
    tname(7)=&#39;P1&#39;
    tname(8)=&#39;Q1&#39;
    tname(9)=&#39;S2&#39;
/
</pre></div>
</div>
<p>NB more constitents is not really practical as they haven&#8217;t been added to the
field_def*xml file.</p>
<p>Change file XML output:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">file_def_nemo</span><span class="o">.</span><span class="n">xml</span>
<span class="o">..</span>

<span class="o">&lt;</span><span class="n">file_group</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;tidal_harmonics&quot;</span> <span class="n">output_freq</span><span class="o">=</span><span class="s2">&quot;1h&quot;</span>  <span class="n">output_level</span><span class="o">=</span><span class="s2">&quot;10&quot;</span> <span class="n">enabled</span><span class="o">=</span><span class="s2">&quot;.TRUE.&quot;</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">file</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;tidalanalysis.grid_T&quot;</span> <span class="n">name_suffix</span><span class="o">=</span><span class="s2">&quot;harmonic_grid_T&quot;</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ocean T grid variables&quot;</span>  <span class="n">enabled</span><span class="o">=</span><span class="s2">&quot;.TRUE.&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;O1amp_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;O1  harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;O1pha_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;O1  harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K1amp_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K1  harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K1pha_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K1  harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;Q1amp_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;Q1  harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;Q1pha_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;Q1  harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;P1amp_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;P1  harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;P1pha_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;P1  harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M2amp_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M2  harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M2pha_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M2  harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;S2amp_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;S2  harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;S2pha_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;S2  harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K2amp_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K2  harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K2pha_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K2  harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;N2amp_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;N2  harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;N2pha_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;N2  harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M4amp_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M4  harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M4pha_ssh&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M4  harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">file</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;tidalanalysis.grid_U&quot;</span> <span class="n">name_suffix</span><span class="o">=</span><span class="s2">&quot;harmonic_grid_U&quot;</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ocean U grid variables&quot;</span>  <span class="n">enabled</span><span class="o">=</span><span class="s2">&quot;.TRUE.&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;O1amp_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;O1 u2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;O1pha_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;O1 u2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K1amp_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K1 u2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K1pha_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K1 u2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;Q1amp_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;Q1 u2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;Q1pha_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;Q1 u2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;P1amp_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;P1 u2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;P1pha_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;P1 u2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M2amp_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M2 u2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M2pha_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M2 u2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;S2amp_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;S2 u2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;S2pha_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;S2 u2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K2amp_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K2 u2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K2pha_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K2 u2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;N2amp_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;N2 u2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;N2pha_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;N2 u2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M4amp_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M4 u2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M4pha_u2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M4 u2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">file</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;tidalanalysis.grid_V&quot;</span> <span class="n">name_suffix</span><span class="o">=</span><span class="s2">&quot;harmonic_grid_V&quot;</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ocean V grid variables&quot;</span>  <span class="n">enabled</span><span class="o">=</span><span class="s2">&quot;.TRUE.&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;O1amp_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;O1 v2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;O1pha_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;O1 v2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K1amp_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K1 v2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K1pha_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K1 v2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;Q1amp_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;Q1 v2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;Q1pha_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;Q1 v2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;P1amp_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;P1 v2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;P1pha_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;P1 v2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M2amp_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M2 v2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M2pha_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M2 v2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;S2amp_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;S2 v2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;S2pha_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;S2 v2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K2amp_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K2 v2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;K2pha_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;K2 v2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;N2amp_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;N2 v2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;N2pha_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;N2 v2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M4amp_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M4 v2D harmonic Amplitude&quot;</span>     <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">field</span> <span class="n">field_ref</span><span class="o">=</span><span class="s2">&quot;M4pha_v2d&quot;</span>    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;M4 v2D harmonic Phase&quot;</span>         <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;instant&quot;</span>      <span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">file_group</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Submit with 2hrs. Finished in 38mins. (which is the same speed as without harmonic analysis...)
Looks reasonable. Continue for another 30days (172,800):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg_AMM60
...
nn_it000    = 403201    !  first time step
nn_itend    = 576000  ! plus 30 days
cn_ocerst_in    = &quot;MASSMO5_surge_00403200_restart&quot;   !  suffix of ocean restart name (input)
...
!-----------------------------------------------------------------------
&amp;nam_diaharm   !   Harmonic analysis of tidal constituents (&#39;key_diaharm&#39;)
!-----------------------------------------------------------------------
    nit000_han = 403201      ! First time step used for harmonic analysis
    nitend_han = 576000 ! 30 days    ! Last time step used for harmonic analysis
...
!-----------------------------------------------------------------------
&amp;nam_diaharm_fast   !   Harmonic analysis of tidal constituents               (&quot;key_diaharm_fast&quot;)
!-----------------------------------------------------------------------
    ln_diaharm_store = .true.
    ln_diaharm_compute = .true.
    ln_diaharm_read_restart = .true.
    ...
</pre></div>
</div>
<p>Request 45mins.
38 mins</p>
<p>Try 4 months (4*172,800 = 691,200):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi namelist_cfg_AMM60
...
nn_it000   =  576001    !  first time step
nn_itend   = 1267200  ! plus 30*4 days
cn_ocerst_in    = &quot;MASSMO5_surge_00576000_restart&quot;   !  suffix of ocean restart name (input)
...
!-----------------------------------------------------------------------
&amp;nam_diaharm   !   Harmonic analysis of tidal constituents (&#39;key_diaharm&#39;)
!-----------------------------------------------------------------------
    nit000_han =  576001      ! First time step used for harmonic analysis
    nitend_han = 1267200 ! 30*4 days    ! Last time step used for harmonic analysis
...
</pre></div>
</div>
<p>Request 2hr 45mins
Took 2hrs 43mins.</p>
<p>There was an issue getting the filenames to work properly with the harmonic output
using the XML file, so I manually fixed the file names to something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MASSMO5_surge_576001_1267200_harmonic_grid_T</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p>There was an issue getting the filenames to work properly with the harmonic output
using the XML file, so I manually fixed the file names to something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MASSMO5_surge_576001_1267200_harmonic_grid_T</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<p><strong>To-Do</strong></p>
<ul class="simple">
<li>generate tiles.</li>
<li>how is the convergence.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Setting up surge model for MASSMO5 domain</a><ul>
<li><a class="reference internal" href="#a-get-and-build-met-surge-config">1a) Get and build Met Surge Config</a></li>
<li><a class="reference internal" href="#b-build-xios2-r1080">1b) Build XIOS2 &#64; r1080</a></li>
<li><a class="reference internal" href="#c-build-nemo">1c) Build NEMO</a></li>
<li><a class="reference internal" href="#generate-coordinates-file">2) Generate coordinates file</a></li>
<li><a class="reference internal" href="#generate-bathymetry-file">3) Generate bathymetry file</a></li>
<li><a class="reference internal" href="#generate-a-domain-configuration-file">4) Generate a domain configuration file</a></li>
<li><a class="reference internal" href="#generate-boundary-conditions">5) Generate boundary conditions</a></li>
<li><a class="reference internal" href="#running-model-with-tidal-forcing-at-the-boundaries-on-archer">6) Running model with tidal forcing at the boundaries on ARCHER</a></li>
<li><a class="reference internal" href="#output-xml-and-running">9) Output xml and running</a><ul>
<li><a class="reference internal" href="#progress">progress</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/MASSMO5Surge_jobs4_archer.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, NOC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/MASSMO5Surge_jobs4_archer.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>