<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Changing namelist_cfg from v3.6 to v4 &#8212; NEMO-RELOC 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="NEMO-RELOC 0.1 documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="changing-namelist-cfg-from-v3-6-to-v4">
<h1>Changing namelist_cfg from v3.6 to v4<a class="headerlink" href="#changing-namelist-cfg-from-v3-6-to-v4" title="Permalink to this headline">Â¶</a></h1>
<p>Some notes and observations about changing between namelist formats. (These were
mostly found when configuring a course Liverpool Bay test configuration).</p>
<p>In order to make a simulation with the new v4 namelist_cfg,  a number of
changes appear with its format. Some of these are noted below. But since they are
a cut down from a debug log they may not be exhaustive.</p>
<p>I might have added some tidal harmonic constituent names to the template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;nam_tide      !   tide parameters (#ifdef key_tide)
!-----------------------------------------------------------------------
clname(1)    = &#39;Q1&#39;   !  name of constituent - all tidal components must be set in namelist_cfg
clname(2)    = &#39;O1&#39;   !  name of constituent - all tidal components must be set in namelist_cfg
clname(3)    = &#39;P1&#39;   !  name of constituent - all tidal components must be set in namelist_cfg
clname(4)    = &#39;K1&#39;   !  name of constituent - all tidal components must be set in namelist_cfg
clname(5)    = &#39;N2&#39;   !  name of constituent - all tidal components must be set in namelist_cfg
clname(6)   =  &#39;M2&#39;   !  name of constituent - all tidal components must be set in namelist_cfg
clname(7)   = &#39;S2&#39;   !  name of constituent - all tidal components must be set in namelist_cfg
clname(8)   = &#39;K2&#39;   !  name of constituent - all tidal components must be set in namelist_cfg
clname(9)   = &#39;M4&#39;   !  name of constituent - all tidal components must be set in namelist_cfg
</pre></div>
</div>
<dl class="docutils">
<dt>Also noted that the sbc namelist variables have changed. Now use <code class="docutils literal"><span class="pre">ln_blk</span></code> and</dt>
<dd><code class="docutils literal"><span class="pre">ln_COARE_3p5=</span> <span class="pre">.true.</span></code> instead of <code class="docutils literal"><span class="pre">ln_blk_core</span></code>. <em>(Except that I use</em>
<em>ln_blk=F because I don&#8217;t have a SLP variable for the COARE algorithm to work...)</em></dd>
</dl>
<p>There was an extra variable in namdom. Comment out ldbletanh (which was essential in DOMAINcfg):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namdom        !   space and time domain (bathymetry, mesh, timestep)
!-----------------------------------------------------------------------
...
!    ldbletanh   =    .false.             !  Use/do not use double tanf function for vertical coordinates
</pre></div>
</div>
<p>The configuration namelist variable is simplified with the new domain_cfg.nc file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namcfg        !   parameters of the configuration
!-----------------------------------------------------------------------
   ln_read_cfg = .true.   !  (=T) read the domain configuration file
      !                   !  (=F) user defined configuration  ==&gt;&gt;&gt;  see usrdef(_...) modules
      cn_domcfg = &quot;domain_cfg&quot;         ! domain configuration filename
      !
   ln_write_cfg= .false.   !  (=T) create the domain configuration file
      cn_domcfg_out = &quot;domain_cfg_out&quot; ! newly created domain configuration filename
      !
   ln_use_jattr = .false.  !  use (T) the file attribute: open_ocean_jstart, if present
   !                       !  in netcdf input files, as the start j-row for reading
/
</pre></div>
</div>
<p>Equation of state needed fixing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;nameos        !   ocean physical parameters
!-----------------------------------------------------------------------
   ln_teos10   = .false.         !  = Use TEOS-10 equation of state
   ln_eos80    = .true.         !  = Use EOS80 equation of state
   ln_seos     = .false.         !  = Use simplified equation of state (S-EOS)
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&amp;namdom</span></code> has a new format (I think):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namdom        !   space and time domain (bathymetry, mesh, timestep)
!-----------------------------------------------------------------------
 ln_linssh   = .false.   !  =T  linear free surface  ==&gt;&gt;  model level are fixed in time
 nn_closea   =    0      !  remove (=0) or keep (=1) closed seas and lakes (ORCA)
 !
 nn_msh      =    0      !  create (&gt;0) a mesh file or not (=0)
 rn_isfhmin  =    1.00   !  treshold (m) to discriminate grounding ice to floating ice
 !
 rn_rdt      =  60.     !  time step for the dynamics (and tracer if nn_acc=0)
 rn_atfp     =    0.1    !  asselin time filter parameter
 !
 ln_crs      = .false.   !  Logical switch for coarsening module
</pre></div>
</div>
<dl class="docutils">
<dt>Note <code class="docutils literal"><span class="pre">ln_linssh</span></code> seems to have moved to <code class="docutils literal"><span class="pre">&amp;namdom</span></code>. (I think it was in <code class="docutils literal"><span class="pre">&amp;namzgr_sco</span></code></dt>
<dd>before)</dd>
</dl>
<p>I added in s-coordinate option and which seemed to have vanished from the default
namelist_cfg template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namzgr        !   vertical coordinate                                  (default: NO selection)
!-----------------------------------------------------------------------
   ln_zco      = .false.   !  z-coordinate - full    steps
   ln_zps      = .false.   !  z-coordinate - partial steps
   ln_sco      = .true.   !  s- or hybrid z-s-coordinate
   ln_isfcav   = .false.   !  ice shelf cavity
/
!-----------------------------------------------------------------------
&amp;namzgr_sco
!-----------------------------------------------------------------------
   ln_s_sf12=.true.,
   ln_s_sh94=.false.,
   ln_sigcrit=.true.,
   rn_alpha=4.4,
   rn_bb=0.8,
   rn_efold=0.0,
   rn_hc=10000.0,
   rn_rmax=1.0,
   rn_sbot_max=10000.0,
   rn_sbot_min=1.0e-5,
   rn_theta=6.0,
   rn_thetb=1.0,
   rn_zb_a=0.024,
   rn_zb_b=-0.2,
   rn_zs=1.0,
/
</pre></div>
</div>
<p>Though the fields are set up (except for SLP field), no met forcing is used:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namsbc        !   Surface Boundary Condition (surface module)
!-----------------------------------------------------------------------
   ln_usr      = .true.    !  user defined formulation                  (T =&gt; check usrdef_sbc)
   ln_flx      = .false.   !  flux formulation                          (T =&gt; fill namsbc_flx )
   ln_blk      = .false.    !  Bulk formulation                          (T =&gt; fill namsbc_blk )
</pre></div>
</div>
<p>Though the fields are ready to go I have not used inital T,S conditions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;namtsd        !   data : Temperature  &amp; Salinity
!-----------------------------------------------------------------------
!              !  file name                 ! frequency (hours) ! variable ! time interp.!  clim  ! &#39;yearly&#39;/ ! weights  ! rotation ! land/sea mask !
!              !                            !  (if &lt;0  months)  !   name   !  (logical)  !  (T/F) ! &#39;monthly&#39; ! filename ! pairing  ! filename      !
   sn_tem  = &#39;initcd_votemper&#39;,         -1        ,&#39;votemper&#39; ,    .false.    , .true. , &#39;yearly&#39;   , &#39;&#39;       ,   &#39;&#39;    ,    &#39;&#39;
   sn_sal  = &#39;initcd_vosaline&#39;,         -1        ,&#39;vosaline&#39; ,    .false.    , .true. , &#39;yearly&#39;   , &#39;&#39;       ,   &#39;&#39;    ,    &#39;&#39;
   !
   cn_dir        = &#39;../../../../INPUTS/&#39;     !  root directory for the location of the runoff files
   ln_tsd_init   = .false.   !  Initialisation of ocean T &amp; S with T &amp;S input data (T) or not (F)
   ln_tsd_tradmp = .false.   !  damping of ocean T &amp; S toward T &amp;S input data (T) or not (F)
</pre></div>
</div>
<p>No lateral diffusion in momentum:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ln_dynldf_lap =  .false.    !    laplacian operator
ln_dynldf_blp =  .false.    !  bilaplacian operator
</pre></div>
</div>
<dl class="docutils">
<dt>Don&#8217;t need a boundaries mask file. But the rimwidth must match that used in the</dt>
<dd><p class="first">PyNEMO process:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;nambdy        !  unstructured open boundaries
!-----------------------------------------------------------------------
  ...
  ln_mask_file   = .false.              !  =T : read mask from file
  cn_mask_file   = &#39;bdy_mask.nc&#39;                   !  name of mask file (if ln_mask_file=.TRUE.)
  ...
  nn_rimwidth   = 9                    !  width of the relaxation zone
</pre></div>
</div>
</dd>
</dl>
<p>Quadratic bottom friction - This means changing to nonlinear friction, with a coeff 2.5E-3, log layer and
bottom roughness as follows</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>!-----------------------------------------------------------------------
&amp;nambfr        !   bottom friction
!-----------------------------------------------------------------------
   nn_bfr      =    2      !  type of bottom friction :   = 0 : free slip,  = 1 : linear friction
                           !                              = 2 : nonlinear friction
   rn_bfri2    =    2.5e-3 !  bottom drag coefficient (non linear case)
   rn_bfeb2    =    0.0e0  !  bottom turbulent kinetic energy background  (m2/s2)
   ln_loglayer =    .true. !  loglayer bottom friction (only effect when nn_bfr = 2)
   rn_bfrz0    =    0.003  !  bottom roughness (only effect when ln_loglayer = .true.)
/
</pre></div>
</div>
<p>I also changed the rn_bfeb2 = 2.5e-3 to zero. This would depend on the tke scheme.
I am not sure what it should be...</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/updating_namelist_cfg_from_v3.6_to_v4.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, NOC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/updating_namelist_cfg_from_v3.6_to_v4.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>